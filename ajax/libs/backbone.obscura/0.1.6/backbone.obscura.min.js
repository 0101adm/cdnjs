(function(e,t){if(typeof exports==="object"){module.exports=t(require("underscore"),require("backbone"))}else if(typeof define==="function"&&define.amd){define(["underscore","backbone"],t)}else{e.Backbone.Obscura=t(e._,e.Backbone)}})(this,function(e,t){var n=function(n){return{backbone:t,underscore:e}[n]};n=function r(e,t,i){function s(u,a){if(!t[u]){if(!e[u]){var f=typeof n=="function"&&n;if(!a&&f)return f(u,!0);if(o)return o(u,!0);throw new Error("Cannot find module '"+u+"'")}var l=t[u]={exports:{}};e[u][0].call(l.exports,function(t){var n=e[u][1][t];return s(n?n:t)},l,l.exports,r,e,t,i)}return t[u].exports}var o=typeof n=="function"&&n;for(var u=0;u<i.length;u++)s(i[u]);return s}({HusaU0:[function(e,t,n){function l(e,t){this._superset=e;this._filtered=new s(e,t);this._sorted=new o(this._filtered,t);this._paginated=new u(this._sorted,t);a(this._paginated,this);f.call(this,this._filtered,p);f.call(this,this._sorted,v);f.call(this,this._paginated,g)}var r=e("underscore");var i=e("backbone");var s=e("backbone-filtered-collection");var o=e("backbone-sorted-collection");var u=e("backbone-paginated-collection");var a=e("backbone-collection-proxy");var f=e("./src/proxy-events.js");var c={superset:function(){return this._superset},getFilteredLength:function(){return this._filtered.length},removeTransforms:function(){this._filtered.resetFilters();this._sorted.removeSort();this._paginated.removePagination();return this},destroy:function(){this.stopListening();this._filtered.destroy();this._sorted.destroy();this._paginated.destroy();this.length=0;this.trigger("obscura:destroy")}};var h=["filterBy","removeFilter","resetFilters","refilter","hasFilter","getFilters"];var p=["filtered:add","filtered:remove","filtered:reset"];var d=["setSort","reverseSort","removeSort"];var v=["sorted:add","sorted:remove"];var m=["setPerPage","setPage","getPerPage","getNumPages","getPage","hasNextPage","hasPrevPage","nextPage","prevPage","movePage","removePagination","firstPage","lastPage"];var g=["paginated:change:perPage","paginated:change:page","paginated:change:numPages"];r.each(h,function(e){c[e]=function(){var t=s.prototype[e].apply(this._filtered,arguments);return t===this._filtered?this:t}});r.each(m,function(e){c[e]=function(){var t=u.prototype[e].apply(this._paginated,arguments);return t===this._paginated?this:t}});r.each(d,function(e){c[e]=function(){var t=o.prototype[e].apply(this._sorted,arguments);return t===this._sorted?this:t}});r.extend(l.prototype,c,i.Events);l.FilteredCollection=s;l.SortedCollection=o;l.PaginatedCollection=u;t.exports=l},{"./src/proxy-events.js":9,backbone:false,"backbone-collection-proxy":3,"backbone-filtered-collection":4,"backbone-paginated-collection":6,"backbone-sorted-collection":7,underscore:false}],obscura:[function(e,t,n){t.exports=e("HusaU0")},{}],3:[function(e,t,n){function u(e,t){function n(){t.length=e.length}function u(n){var i=r.toArray(arguments);var s=n==="change"||n.slice(0,7)==="change:";if(n==="reset"){t.models=e.models}if(r.contains(o,n)){if(r.contains(["add","remove","destory"],n)){i[2]=t}else if(r.contains(["reset","sort"],n)){i[1]=t}t.trigger.apply(this,i)}else if(s){if(t.contains(i[1])){t.trigger.apply(this,i)}}}var a={};r.each(r.functions(i.Collection.prototype),function(t){if(!r.contains(s,t)){a[t]=function(){return e[t].apply(e,arguments)}}});r.extend(t,i.Events,a);t.listenTo(e,"all",n);t.listenTo(e,"all",u);t.models=e.models;n();return t}var r=e("underscore");var i=e("backbone");var s=["_onModelEvent","_prepareModel","_removeReference","_reset","add","initialize","sync","remove","reset","set","push","pop","unshift","shift","sort","parse","fetch","create","model","off","on","listenTo","listenToOnce","bind","trigger","once","stopListening"];var o=["add","remove","reset","sort","destroy"];t.exports=u},{backbone:false,underscore:false}],4:[function(e,t,n){function u(){this._filterResultCache={}}function a(e){for(var t in this._filterResultCache){if(this._filterResultCache.hasOwnProperty(t)){delete this._filterResultCache[t][e]}}}function f(e,t){if(this._filters[e]){a.call(this,e)}this._filters[e]=t;this.trigger("filtered:add",e)}function l(e){delete this._filters[e];a.call(this,e);this.trigger("filtered:remove",e)}function c(e){if(!this._filterResultCache[e.cid]){this._filterResultCache[e.cid]={}}var t=this._filterResultCache[e.cid];for(var n in this._filters){if(this._filters.hasOwnProperty(n)){if(!t.hasOwnProperty(n)){t[n]=this._filters[n].fn(e)}if(!t[n]){return false}}}return true}function h(){var e=[];if(this._superset){e=this._superset.filter(r.bind(c,this))}this._collection.reset(e);this.length=this._collection.length}function p(e){this._filterResultCache[e.cid]={};if(c.call(this,e)){if(!this._collection.get(e.cid)){var t=this.superset().indexOf(e);var n=null;for(var r=t-1;r>=0;r-=1){if(this.contains(this.superset().at(r))){n=this.indexOf(this.superset().at(r))+1;break}}n=n||0;this._collection.add(e,{at:n})}}else{if(this._collection.get(e.cid)){this._collection.remove(e)}}this.length=this._collection.length}function d(e){this._filterResultCache[e.cid]={};if(!c.call(this,e)){if(this._collection.get(e.cid)){this._collection.remove(e)}}}function v(e,t,n){if(e.slice(0,7)==="change:"){d.call(this,arguments[1])}}function m(e){if(this.contains(e)){this._collection.remove(e)}this.length=this._collection.length}function g(e){this._superset=e;this._collection=new i.Collection(e.toArray());s(this._collection,this);this.resetFilters();this.listenTo(this._superset,"reset sort",h);this.listenTo(this._superset,"add change",p);this.listenTo(this._superset,"remove",m);this.listenTo(this._superset,"all",v)}var r=e("underscore");var i=e("backbone");var s=e("backbone-collection-proxy");var o=e("./src/create-filter.js");var y={defaultFilterName:"__default",filterBy:function(e,t){if(!t){t=e;e=this.defaultFilterName}f.call(this,e,o(t));h.call(this);return this},removeFilter:function(e){if(!e){e=this.defaultFilterName}l.call(this,e);h.call(this);return this},resetFilters:function(){this._filters={};u.call(this);this.trigger("filtered:reset");h.call(this);return this},superset:function(){return this._superset},refilter:function(e){if(typeof e==="object"&&e.cid){p.call(this,e)}else{u.call(this);h.call(this)}return this},getFilters:function(){return r.keys(this._filters)},hasFilter:function(e){return r.contains(this.getFilters(),e)},destroy:function(){this.stopListening();this._collection.reset([]);this._superset=this._collection;this.length=0;this.trigger("filtered:destroy")}};r.extend(g.prototype,y,i.Events);t.exports=g},{"./src/create-filter.js":5,backbone:false,"backbone-collection-proxy":3,underscore:false}],5:[function(e,t,n){function i(e,t){return function(n){return n.get(e)===t}}function s(e,t){return function(n){return t(n.get(e))}}function o(e,t){if(!r.isArray(t)){t=null}return{fn:e,keys:t}}function u(e){var t=r.keys(e);var n=r.map(t,function(t){var n=e[t];if(r.isFunction(n)){return s(t,n)}return i(t,n)});var u=function(e){for(var t=0;t<n.length;t++){if(!n[t](e)){return false}}return true};return o(u,t)}function a(e,t){if(r.isFunction(e)){return o(e,t)}if(r.isObject(e)){return u(e)}}var r=e("underscore");t.exports=a},{underscore:false}],6:[function(e,t,n){function o(){var e=this.getPage()*this.getPerPage();var t=e+this.getPerPage();return[e,t]}function u(){var e=o.call(this);this._collection.reset(this.superset().slice(e[0],e[1]))}function a(){var e=this._totalPages;var t=this.superset().length;var n=this.getPerPage();var r=t%n===0?t/n:Math.floor(t/n)+1;var i=this._totalPages!==r;this._totalPages=r;if(i){this.trigger("paginated:change:numPages",{numPages:r})}if(this.getPage()>=r){this.setPage(r-1);return true}}function f(){if(a.call(this)){return}u.call(this)}function l(e,t){var n=r.max([e.length,t.length]);for(var i=0,s=0;i<n;i+=1,s+=1){if(e[i]!==t[s]){if(t[i-1]===e[i]){s-=1}else if(t[i+1]===e[i]){s+=1}else{return e[i]}}}}function c(e,t,n){if(a.call(this)){return}var r=o.call(this);var i=r[0],s=r[1];var u=l(this.superset().slice(i,s),this._collection.toArray());var f=l(this._collection.toArray(),this.superset().slice(i,s));if(f){this._collection.remove(f)}if(u){this._collection.add(u,{at:this.superset().indexOf(u)-i})}}function h(e,t){this._superset=e;this._collection=new i.Collection(e.toArray());this._page=0;this.setPerPage(t&&t.perPage?t.perPage:null);s(this._collection,this);this.listenTo(this._superset,"add remove",c);this.listenTo(this._superset,"reset sort",f)}var r=e("underscore");var i=e("backbone");var s=e("backbone-collection-proxy");var p={removePagination:function(){this.setPerPage(null);return this},setPerPage:function(e){this._perPage=e;f.call(this);this.setPage(0);this.trigger("paginated:change:perPage",{perPage:e,numPages:this.getNumPages()});return this},setPage:function(e){var t=0;var n=this.getNumPages()-1;e=e>t?e:t;e=e<n?e:n;e=e<0?0:e;this._page=e;u.call(this);this.trigger("paginated:change:page",{page:e});return this},getPerPage:function(){return this._perPage||this.superset().length||1},getNumPages:function(){return this._totalPages},getPage:function(){return this._page},hasNextPage:function(){return this.getPage()<this.getNumPages()-1},hasPrevPage:function(){return this.getPage()>0},nextPage:function(){this.movePage(1);return this},prevPage:function(){this.movePage(-1);return this},firstPage:function(){this.setPage(0)},lastPage:function(){this.setPage(this.getNumPages()-1)},movePage:function(e){this.setPage(this.getPage()+e);return this},superset:function(){return this._superset},destroy:function(){this.stopListening();this._collection.reset([]);this._superset=this._collection;this._page=0;this._totalPages=0;this.length=0;this.trigger("paginated:destroy")}};r.extend(h.prototype,p,i.Events);t.exports=h},{backbone:false,"backbone-collection-proxy":3,underscore:false}],7:[function(e,t,n){function u(e){return r.isFunction(e)?e:function(t){return t.get(e)}}function a(e){if(!this._comparator){return this._superset.indexOf(e)}else{if(!this._reverse){return r.sortedIndex(this._collection.toArray(),e,u(this._comparator))}else{return o(this._collection.toArray(),e,u(this._comparator))}}}function f(e){var t=a.call(this,e);this._collection.add(e,{at:t})}function l(e){if(this.contains(e)){this._collection.remove(e)}}function c(e){if(this.contains(e)&&this._collection.indexOf(e)!==a.call(this,e)){this._collection.remove(e);f.call(this,e)}}function h(){if(!this._comparator){this._collection.reset(this._superset.toArray());return}var e=this._superset.sortBy(this._comparator);this._collection.reset(this._reverse?e.reverse():e)}function p(e){this._superset=e;this._reverse=false;this._comparator=null;this._collection=new i.Collection(e.toArray());s(this._collection,this);this.listenTo(this._superset,"add",f);this.listenTo(this._superset,"remove",l);this.listenTo(this._superset,"change",c);this.listenTo(this._superset,"reset",h)}var r=e("underscore");var i=e("backbone");var s=e("backbone-collection-proxy");var o=e("./src/reverse-sorted-index.js");var d={setSort:function(e,t){this._reverse=t==="desc"?true:false;this._comparator=e;h.call(this);if(!e){this.trigger("sorted:remove")}else{this.trigger("sorted:add")}return this},reverseSort:function(){this._reverse=!this._reverse;h.call(this);return this},removeSort:function(){this.setSort();return this},superset:function(){return this._superset},destroy:function(){this.stopListening();this._collection.reset([]);this._superset=this._collection;this.length=0;this.trigger("sorted:destroy")}};r.extend(p.prototype,d,i.Events);t.exports=p},{"./src/reverse-sorted-index.js":8,backbone:false,"backbone-collection-proxy":3,underscore:false}],8:[function(e,t,n){function i(e){return r.isFunction(e)?e:function(t){return t[e]}}function s(e,t,n,s){n=n==null?r.identity:i(n);var o=n.call(s,t);var u=0,a=e.length;while(u<a){var f=u+a>>>1;n.call(s,e[f])<o?a=f:u=f+1}return u}var r=e("underscore");t.exports=s},{underscore:false}],9:[function(e,t,n){function i(e,t){r.each(t,function(t){this.listenTo(e,t,function(){var e=r.toArray(arguments);e.unshift(t);this.trigger.apply(this,e)})},this)}var r=e("underscore");t.exports=i},{underscore:false}]},{},[]);return n("obscura")})
