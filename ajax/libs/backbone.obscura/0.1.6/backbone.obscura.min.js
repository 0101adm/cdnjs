(function(a,b){if(typeof exports==='object'){module.exports=b(require('underscore'),require('backbone'))}else if(typeof define==='function'&&define.amd){define(['underscore','backbone'],b)}else{a.Backbone.Obscura=b(a._,a.Backbone)}}(this,function(_,v){var w=function(a){return{"backbone":v,"underscore":_}[a]};w=(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof w=="function"&&w;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof w=="function"&&w;for(var o=0;o<r.length;o++)s(r[o]);return s})({"HusaU0":[function(c,d,e){var _=c('underscore');var f=c('backbone');var g=c('backbone-filtered-collection');var h=c('backbone-sorted-collection');var i=c('backbone-paginated-collection');var j=c('backbone-collection-proxy');var k=c('./src/proxy-events.js');function Obscura(a,b){this._superset=a;this._filtered=new g(a,b);this._sorted=new h(this._filtered,b);this._paginated=new i(this._sorted,b);j(this._paginated,this);k.call(this,this._filtered,n);k.call(this,this._sorted,p);k.call(this,this._paginated,r)}var l={superset:function(){return this._superset},getFilteredLength:function(){return this._filtered.length},removeTransforms:function(){this._filtered.resetFilters();this._sorted.removeSort();this._paginated.removePagination();return this},destroy:function(){this.stopListening();this._filtered.destroy();this._sorted.destroy();this._paginated.destroy();this.length=0;this.trigger('obscura:destroy')}};var m=['filterBy','removeFilter','resetFilters','refilter','hasFilter','getFilters'];var n=['filtered:add','filtered:remove','filtered:reset'];var o=['setSort','reverseSort','removeSort'];var p=['sorted:add','sorted:remove'];var q=['setPerPage','setPage','getPerPage','getNumPages','getPage','hasNextPage','hasPrevPage','nextPage','prevPage','movePage','removePagination','firstPage','lastPage'];var r=['paginated:change:perPage','paginated:change:page','paginated:change:numPages'];_.each(m,function(b){l[b]=function(){var a=g.prototype[b].apply(this._filtered,arguments);return a===this._filtered?this:a}});_.each(q,function(b){l[b]=function(){var a=i.prototype[b].apply(this._paginated,arguments);return a===this._paginated?this:a}});_.each(o,function(b){l[b]=function(){var a=h.prototype[b].apply(this._sorted,arguments);return a===this._sorted?this:a}});_.extend(Obscura.prototype,l,f.Events);Obscura.FilteredCollection=g;Obscura.SortedCollection=h;Obscura.PaginatedCollection=i;d.exports=Obscura},{"./src/proxy-events.js":9,"backbone":false,"backbone-collection-proxy":3,"backbone-filtered-collection":4,"backbone-paginated-collection":6,"backbone-sorted-collection":7,"underscore":false}],"obscura":[function(a,b,c){b.exports=a('HusaU0')},{}],3:[function(g,h,i){var _=g('underscore');var j=g('backbone');var k=["_onModelEvent","_prepareModel","_removeReference","_reset","add","initialize","sync","remove","reset","set","push","pop","unshift","shift","sort","parse","fetch","create","model","off","on","listenTo","listenToOnce","bind","trigger","once","stopListening"];var l=['add','remove','reset','sort','destroy'];function proxyCollection(d,e){function updateLength(){e.length=d.length}function pipeEvents(a){var b=_.toArray(arguments);var c=a==='change'||a.slice(0,7)==='change:';if(a==='reset'){e.models=d.models}if(_.contains(l,a)){if(_.contains(['add','remove','destory'],a)){b[2]=e}else if(_.contains(['reset','sort'],a)){b[1]=e}e.trigger.apply(this,b)}else if(c){if(e.contains(b[1])){e.trigger.apply(this,b)}}}var f={};_.each(_.functions(j.Collection.prototype),function(a){if(!_.contains(k,a)){f[a]=function(){return d[a].apply(d,arguments)}}});_.extend(e,j.Events,f);e.listenTo(d,'all',updateLength);e.listenTo(d,'all',pipeEvents);e.models=d.models;updateLength();return e}h.exports=proxyCollection},{"backbone":false,"underscore":false}],4:[function(d,e,f){var _=d('underscore');var g=d('backbone');var h=d('backbone-collection-proxy');var j=d('./src/create-filter.js');function invalidateCache(){this._filterResultCache={}}function invalidateCacheForFilter(a){for(var b in this._filterResultCache){if(this._filterResultCache.hasOwnProperty(b)){delete this._filterResultCache[b][a]}}}function addFilter(a,b){if(this._filters[a]){invalidateCacheForFilter.call(this,a)}this._filters[a]=b;this.trigger('filtered:add',a)}function removeFilter(a){delete this._filters[a];invalidateCacheForFilter.call(this,a);this.trigger('filtered:remove',a)}function execFilterOnModel(a){if(!this._filterResultCache[a.cid]){this._filterResultCache[a.cid]={}}var b=this._filterResultCache[a.cid];for(var c in this._filters){if(this._filters.hasOwnProperty(c)){if(!b.hasOwnProperty(c)){b[c]=this._filters[c].fn(a)}if(!b[c]){return false}}}return true}function execFilter(){var a=[];if(this._superset){a=this._superset.filter(_.bind(execFilterOnModel,this))}this._collection.reset(a);this.length=this._collection.length}function onAddChange(a){this._filterResultCache[a.cid]={};if(execFilterOnModel.call(this,a)){if(!this._collection.get(a.cid)){var b=this.superset().indexOf(a);var c=null;for(var i=b-1;i>=0;i-=1){if(this.contains(this.superset().at(i))){c=this.indexOf(this.superset().at(i))+1;break}}c=c||0;this._collection.add(a,{at:c})}}else{if(this._collection.get(a.cid)){this._collection.remove(a)}}this.length=this._collection.length}function onModelAttributeChange(a){this._filterResultCache[a.cid]={};if(!execFilterOnModel.call(this,a)){if(this._collection.get(a.cid)){this._collection.remove(a)}}}function onAll(a,b,c){if(a.slice(0,7)==="change:"){onModelAttributeChange.call(this,arguments[1])}}function onModelRemove(a){if(this.contains(a)){this._collection.remove(a)}this.length=this._collection.length}function Filtered(a){this._superset=a;this._collection=new g.Collection(a.toArray());h(this._collection,this);this.resetFilters();this.listenTo(this._superset,'reset sort',execFilter);this.listenTo(this._superset,'add change',onAddChange);this.listenTo(this._superset,'remove',onModelRemove);this.listenTo(this._superset,'all',onAll)}var k={defaultFilterName:'__default',filterBy:function(a,b){if(!b){b=a;a=this.defaultFilterName}addFilter.call(this,a,j(b));execFilter.call(this);return this},removeFilter:function(a){if(!a){a=this.defaultFilterName}removeFilter.call(this,a);execFilter.call(this);return this},resetFilters:function(){this._filters={};invalidateCache.call(this);this.trigger('filtered:reset');execFilter.call(this);return this},superset:function(){return this._superset},refilter:function(a){if(typeof a==="object"&&a.cid){onAddChange.call(this,a)}else{invalidateCache.call(this);execFilter.call(this)}return this},getFilters:function(){return _.keys(this._filters)},hasFilter:function(a){return _.contains(this.getFilters(),a)},destroy:function(){this.stopListening();this._collection.reset([]);this._superset=this._collection;this.length=0;this.trigger('filtered:destroy')}};_.extend(Filtered.prototype,k,g.Events);e.exports=Filtered},{"./src/create-filter.js":5,"backbone":false,"backbone-collection-proxy":3,"underscore":false}],5:[function(g,h,j){var _=g('underscore');function convertKeyValueToFunction(b,c){return function(a){return a.get(b)===c}}function convertKeyFunctionToFunction(b,c){return function(a){return c(a.get(b))}}function createFilterObject(a,b){if(!_.isArray(b)){b=null}return{fn:a,keys:b}}function createFilterFromObject(c){var d=_.keys(c);var e=_.map(d,function(a){var b=c[a];if(_.isFunction(b)){return convertKeyFunctionToFunction(a,b)}return convertKeyValueToFunction(a,b)});var f=function(a){for(var i=0;i<e.length;i++){if(!e[i](a)){return false}}return true};return createFilterObject(f,d)}function createFilter(a,b){if(_.isFunction(a)){return createFilterObject(a,b)}if(_.isObject(a)){return createFilterFromObject(a)}}h.exports=createFilter},{"underscore":false}],6:[function(h,k,l){var _=h('underscore');var m=h('backbone');var n=h('backbone-collection-proxy');function getPageLimits(){var a=this.getPage()*this.getPerPage();var b=a+this.getPerPage();return[a,b]}function updatePagination(){var a=getPageLimits.call(this);this._collection.reset(this.superset().slice(a[0],a[1]))}function updateNumPages(){var a=this._totalPages;var b=this.superset().length;var c=this.getPerPage();var d=b%c===0?(b/c):Math.floor(b/c)+1;var e=this._totalPages!==d;this._totalPages=d;if(e){this.trigger('paginated:change:numPages',{numPages:d})}if(this.getPage()>=d){this.setPage(d-1);return true}}function recalculatePagination(){if(updateNumPages.call(this)){return}updatePagination.call(this)}function difference(a,b){var c=_.max([a.length,b.length]);for(var i=0,j=0;i<c;i+=1,j+=1){if(a[i]!==b[j]){if(b[i-1]===a[i]){j-=1}else if(b[i+1]===a[i]){j+=1}else{return a[i]}}}}function onAddRemove(a,b,c){if(updateNumPages.call(this)){return}var d=getPageLimits.call(this);var e=d[0],end=d[1];var f=difference(this.superset().slice(e,end),this._collection.toArray());var g=difference(this._collection.toArray(),this.superset().slice(e,end));if(g){this._collection.remove(g)}if(f){this._collection.add(f,{at:this.superset().indexOf(f)-e})}}function Paginated(a,b){this._superset=a;this._collection=new m.Collection(a.toArray());this._page=0;this.setPerPage((b&&b.perPage)?b.perPage:null);n(this._collection,this);this.listenTo(this._superset,'add remove',onAddRemove);this.listenTo(this._superset,'reset sort',recalculatePagination)}var o={removePagination:function(){this.setPerPage(null);return this},setPerPage:function(a){this._perPage=a;recalculatePagination.call(this);this.setPage(0);this.trigger('paginated:change:perPage',{perPage:a,numPages:this.getNumPages()});return this},setPage:function(a){var b=0;var c=this.getNumPages()-1;a=a>b?a:b;a=a<c?a:c;a=a<0?0:a;this._page=a;updatePagination.call(this);this.trigger('paginated:change:page',{page:a});return this},getPerPage:function(){return this._perPage||this.superset().length||1},getNumPages:function(){return this._totalPages},getPage:function(){return this._page},hasNextPage:function(){return this.getPage()<this.getNumPages()-1},hasPrevPage:function(){return this.getPage()>0},nextPage:function(){this.movePage(1);return this},prevPage:function(){this.movePage(-1);return this},firstPage:function(){this.setPage(0)},lastPage:function(){this.setPage(this.getNumPages()-1)},movePage:function(a){this.setPage(this.getPage()+a);return this},superset:function(){return this._superset},destroy:function(){this.stopListening();this._collection.reset([]);this._superset=this._collection;this._page=0;this._totalPages=0;this.length=0;this.trigger('paginated:destroy')}};_.extend(Paginated.prototype,o,m.Events);k.exports=Paginated},{"backbone":false,"backbone-collection-proxy":3,"underscore":false}],7:[function(c,d,e){var _=c('underscore');var f=c('backbone');var g=c('backbone-collection-proxy');var h=c('./src/reverse-sorted-index.js');function lookupIterator(b){return _.isFunction(b)?b:function(a){return a.get(b)}}function modelInsertIndex(a){if(!this._comparator){return this._superset.indexOf(a)}else{if(!this._reverse){return _.sortedIndex(this._collection.toArray(),a,lookupIterator(this._comparator))}else{return h(this._collection.toArray(),a,lookupIterator(this._comparator))}}}function onAdd(a){var b=modelInsertIndex.call(this,a);this._collection.add(a,{at:b})}function onRemove(a){if(this.contains(a)){this._collection.remove(a)}}function onChange(a){if(this.contains(a)&&this._collection.indexOf(a)!==modelInsertIndex.call(this,a)){this._collection.remove(a);onAdd.call(this,a)}}function sort(){if(!this._comparator){this._collection.reset(this._superset.toArray());return}var a=this._superset.sortBy(this._comparator);this._collection.reset(this._reverse?a.reverse():a)}function Sorted(a){this._superset=a;this._reverse=false;this._comparator=null;this._collection=new f.Collection(a.toArray());g(this._collection,this);this.listenTo(this._superset,'add',onAdd);this.listenTo(this._superset,'remove',onRemove);this.listenTo(this._superset,'change',onChange);this.listenTo(this._superset,'reset',sort)}var i={setSort:function(a,b){this._reverse=b==='desc'?true:false;this._comparator=a;sort.call(this);if(!a){this.trigger('sorted:remove')}else{this.trigger('sorted:add')}return this},reverseSort:function(){this._reverse=!this._reverse;sort.call(this);return this},removeSort:function(){this.setSort();return this},superset:function(){return this._superset},destroy:function(){this.stopListening();this._collection.reset([]);this._superset=this._collection;this.length=0;this.trigger('sorted:destroy')}};_.extend(Sorted.prototype,i,f.Events);d.exports=Sorted},{"./src/reverse-sorted-index.js":8,"backbone":false,"backbone-collection-proxy":3,"underscore":false}],8:[function(h,i,j){var _=h('underscore');function lookupIterator(b){return _.isFunction(b)?b:function(a){return a[b]}}function reverseSortedIndex(a,b,c,d){c=c==null?_.identity:lookupIterator(c);var e=c.call(d,b);var f=0,high=a.length;while(f<high){var g=(f+high)>>>1;c.call(d,a[g])<e?high=g:f=g+1}return f}i.exports=reverseSortedIndex},{"underscore":false}],9:[function(e,f,g){var _=e('underscore');function proxyEvents(c,d){_.each(d,function(b){this.listenTo(c,b,function(){var a=_.toArray(arguments);a.unshift(b);this.trigger.apply(this,a)})},this)}f.exports=proxyEvents},{"underscore":false}]},{},[])return w('obscura')}));
