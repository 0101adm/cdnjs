define(function(d,b,e){var f=d("../lib/oop");var h=d("../lib/lang");var a=d("./text_highlight_rules").TextHighlightRules;var g=d("./html_highlight_rules").HtmlHighlightRules;var c=function(){g.call(this);var j=h.arrayToMap(("true|false|null").split("|"));var m=h.arrayToMap(("_DateTool|_DisplayTool|_EscapeTool|_FieldTool|_MathTool|_NumberTool|_SerializerTool|_SortTool|_StringTool|_XPathTool").split("|"));var n=h.arrayToMap(("$contentRoot|$foreach").split("|"));var l=h.arrayToMap(("#set|#macro|#include|#parse|#if|#elseif|#else|#foreach|#break|#end|#stop").split("|"));this.$rules.start.push({token:"comment",regex:"##.*$"},{token:"comment.block",regex:"#\\*",next:"vm_comment"},{token:"string.regexp",regex:"[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:function(i){if(l.hasOwnProperty(i)){return"keyword"}else{if(j.hasOwnProperty(i)){return"constant.language"}else{if(n.hasOwnProperty(i)){return"variable.language"}else{if(m.hasOwnProperty(i)||m.hasOwnProperty(i.substring(1))){return"support.function"}else{if(i=="debugger"){return"invalid.deprecated"}else{if(i.match(/^(\$[a-zA-Z_][a-zA-Z0-9_]*)$/)){return"variable"}}}}}}return"identifier"},regex:"[a-zA-Z$#][a-zA-Z0-9_]*\\b"},{token:"keyword.operator",regex:"!|&|\\*|\\-|\\+|=|!=|<=|>=|<|>|&&|\\|\\|"},{token:"lparen",regex:"[[({]"},{token:"rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"});this.$rules.vm_comment=[{token:"comment",regex:"\\*#|-->",next:"start"},{defaultToken:"comment"}];this.$rules.vm_start=[{token:"variable",regex:"}",next:"pop"},{token:"string.regexp",regex:"[/](?:(?:\\[(?:\\\\]|[^\\]])+\\])|(?:\\\\/|[^\\]/]))*[/]\\w*\\s*(?=[).,;]|$)"},{token:"string",regex:'["](?:(?:\\\\.)|(?:[^"\\\\]))*?["]'},{token:"string",regex:"['](?:(?:\\\\.)|(?:[^'\\\\]))*?[']"},{token:"constant.numeric",regex:"0[xX][0-9a-fA-F]+\\b"},{token:"constant.numeric",regex:"[+-]?\\d+(?:(?:\\.\\d*)?(?:[eE][+-]?\\d+)?)?\\b"},{token:"constant.language.boolean",regex:"(?:true|false)\\b"},{token:function(i){if(l.hasOwnProperty(i)){return"keyword"}else{if(j.hasOwnProperty(i)){return"constant.language"}else{if(n.hasOwnProperty(i)){return"variable.language"}else{if(m.hasOwnProperty(i)||m.hasOwnProperty(i.substring(1))){return"support.function"}else{if(i=="debugger"){return"invalid.deprecated"}else{if(i.match(/^(\$[a-zA-Z_$][a-zA-Z0-9_]*)$/)){return"variable"}}}}}}return"identifier"},regex:"[a-zA-Z_$][a-zA-Z0-9_$]*\\b"},{token:"keyword.operator",regex:"!|&|\\*|\\-|\\+|=|!=|<=|>=|<|>|&&|\\|\\|"},{token:"lparen",regex:"[[({]"},{token:"rparen",regex:"[\\])}]"},{token:"text",regex:"\\s+"}];for(var k in this.$rules){this.$rules[k].unshift({token:"variable",regex:"\\${",push:"vm_start"})}this.normalizeRules()};f.inherits(c,a);b.VelocityHighlightRules=c});