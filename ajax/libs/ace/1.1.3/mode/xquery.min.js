define(function(d,f,b){var a=d("../worker/worker_client").WorkerClient;var h=d("../lib/oop");var e=d("./text").Mode;var i=d("./xquery/XQueryLexer").XQueryLexer;var c=d("../range").Range;var g=d("./behaviour/xquery").XQueryBehaviour;var k=d("./folding/cstyle").FoldMode;var j=function(){this.$tokenizer=new i();this.$behaviour=new g();this.foldingRules=new k()};h.inherits(j,e);(function(){this.getNextLineIndent=function(p,m,o){var l=this.$getIndent(m);var n=m.match(/\s*(?:then|else|return|[{\(]|<\w+>)\s*$/);if(n){l+=o}return l};this.checkOutdent=function(n,l,m){if(!/^\s+$/.test(l)){return false}return/^\s*[\}\)]/.test(m)};this.autoOutdent=function(q,r,s){var m=r.getLine(s);var n=m.match(/^(\s*[\}\)])/);if(!n){return 0}var o=n[1].length;var p=r.findMatchingBracket({row:s,column:o});if(!p||p.row==s){return 0}var l=this.$getIndent(r.getLine(p.row));r.replace(new c(s,0,s,o-1),l)};this.toggleCommentLines=function(l,q,r,m){var n,t;var p=true;var s=/^\s*\(:(.*):\)/;for(n=r;n<=m;n++){if(!s.test(q.getLine(n))){p=false;break}}var o=new c(0,0,0,0);for(n=r;n<=m;n++){t=q.getLine(n);o.start.row=n;o.end.row=n;o.end.column=t.length;q.replace(o,p?t.match(s)[1]:"(:"+t+":)")}};this.createWorker=function(m){var n=new a(["ace"],"ace/mode/xquery_worker","XQueryWorker");var l=this;n.attachToDocument(m.getDocument());n.on("error",function(o){m.setAnnotations([o.data])});n.on("ok",function(o){m.clearAnnotations()});n.on("highlight",function(q){l.$tokenizer.tokens=q.data.tokens;l.$tokenizer.lines=m.getDocument().getAllLines();var p=Object.keys(l.$tokenizer.tokens);for(var o=0;o<p.length;o++){var r=parseInt(p[o]);delete m.bgTokenizer.lines[r];delete m.bgTokenizer.states[r];m.bgTokenizer.fireUpdateEvent(r,r)}});return n};this.$id="ace/mode/xquery"}).call(j.prototype);f.Mode=j});