define(function(aj,y,az){var ac,al,av,A,k,P,an,B,p,aD,j,ak,h,aw,b,ao,M,at,R,L,ax,aC,I,e,q,ab,H,ae,ag,au,ar,w,d,N,J,D,ah,t,a,E,s,af,m,G,aB,z,V,Y,i,x,u,ay,K,am,n,aq,r,Q,ai,v,Z,W,C,T,l,aa,ad,o,O,S,U,F,aA,f,X={}.hasOwnProperty,c=function(aH,aF){for(var aE in aF){if(X.call(aF,aE)){aH[aE]=aF[aE]}}function aG(){this.constructor=aH}aG.prototype=aF.prototype;aH.prototype=new aG();aH.__super__=aF.prototype;return aH},ap=[].indexOf||function(aG){for(var aF=0,aE=this.length;aF<aE;aF++){if(aF in this&&this[aF]===aG){return aF}}return -1},g=[].slice;Error.stackTraceLimit=Infinity;af=aj("./scope").Scope;aA=aj("./lexer"),ah=aA.RESERVED,s=aA.STRICT_PROSCRIBED;f=aj("./helpers"),n=f.compact,ai=f.flatten,Q=f.extend,l=f.merge,aq=f.del,O=f.starts,r=f.ends,C=f.last,o=f.some,am=f.addLocationDataFn,T=f.locationDataToString,S=f.throwSyntaxError;y.extend=Q;y.addLocationDataFn=am;K=function(){return true};ar=function(){return false};V=function(){return this};au=function(){this.negated=!this.negated;return this};y.CodeFragment=p=(function(){function aE(aF,aG){var aH;this.code=""+aG;this.locationData=aF!=null?aF.locationData:void 0;this.type=(aF!=null?(aH=aF.constructor)!=null?aH.name:void 0:void 0)||"unknown"}aE.prototype.toString=function(){return""+this.code+(this.locationData?": "+T(this.locationData):"")};return aE})();v=function(aE){var aF;return((function(){var aI,aH,aG;aG=[];for(aI=0,aH=aE.length;aI<aH;aI++){aF=aE[aI];aG.push(aF.code)}return aG})()).join("")};y.Base=A=(function(){function aE(){}aE.prototype.compile=function(aG,aF){return v(this.compileToFragments(aG,aF))};aE.prototype.compileToFragments=function(aH,aF){var aG;aH=Q({},aH);if(aF){aH.level=aF}aG=this.unfoldSoak(aH)||this;aG.tab=aH.indent;if(aH.level===H||!aG.isStatement(aH)){return aG.compileNode(aH)}else{return aG.compileClosure(aH)}};aE.prototype.compileClosure=function(aK){var aH,aI,aJ,aF,aG;if(aF=this.jumps()){aF.error("cannot use a pure statement in an expression")}aK.sharedScope=true;aJ=new B([],k.wrap([this]));aH=[];if((aI=this.contains(Z))||this.contains(W)){aH=[new ae("this")];if(aI){aG="apply";aH.push(new ae("arguments"))}else{aG="call"}aJ=new u(aJ,[new ac(new ae(aG))])}return(new P(aJ,aH)).compileNode(aK)};aE.prototype.cache=function(aI,aJ,aF){var aH,aG;if(!this.isComplex()){aH=aJ?this.compileToFragments(aI,aJ):this;return[aH,aH]}else{aH=new ae(aF||aI.scope.freeVariable("ref"));aG=new av(aH,this);if(aJ){return[aG.compileToFragments(aI,aJ),[this.makeCode(aH.value)]]}else{return[aG,aH]}}};aE.prototype.cacheToCodeFragments=function(aF){return[v(aF[0]),v(aF[1])]};aE.prototype.makeReturn=function(aF){var aG;aG=this.unwrapAll();if(aF){return new P(new ae(""+aF+".push"),[aG])}else{return new a(aG)}};aE.prototype.contains=function(aF){var aG;aG=void 0;this.traverseChildren(false,function(aH){if(aF(aH)){aG=aH;return false}});return aG};aE.prototype.lastNonComment=function(aG){var aF;aF=aG.length;while(aF--){if(!(aG[aF] instanceof aD)){return aG[aF]}}return null};aE.prototype.toString=function(aH,aG){var aF;if(aH==null){aH=""}if(aG==null){aG=this.constructor.name}aF="\n"+aH+aG;if(this.soak){aF+="?"}this.eachChild(function(aI){return aF+=aI.toString(aH+z)});return aF};aE.prototype.eachChild=function(aI){var aM,aG,aL,aK,aN,aF,aJ,aH;if(!this.children){return this}aJ=this.children;for(aL=0,aN=aJ.length;aL<aN;aL++){aM=aJ[aL];if(this[aM]){aH=ai([this[aM]]);for(aK=0,aF=aH.length;aK<aF;aK++){aG=aH[aK];if(aI(aG)===false){return this}}}}return this};aE.prototype.traverseChildren=function(aG,aF){return this.eachChild(function(aI){var aH;aH=aF(aI);if(aH!==false){return aI.traverseChildren(aG,aF)}})};aE.prototype.invert=function(){return new N("!",this)};aE.prototype.unwrapAll=function(){var aF;aF=this;while(aF!==(aF=aF.unwrap())){continue}return aF};aE.prototype.children=[];aE.prototype.isStatement=ar;aE.prototype.jumps=ar;aE.prototype.isComplex=K;aE.prototype.isChainable=ar;aE.prototype.isAssignable=ar;aE.prototype.unwrap=V;aE.prototype.unfoldSoak=ar;aE.prototype.assigns=ar;aE.prototype.updateLocationDataIfMissing=function(aF){if(this.locationData){return this}this.locationData=aF;return this.eachChild(function(aG){return aG.updateLocationDataIfMissing(aF)})};aE.prototype.error=function(aF){return S(aF,this.locationData)};aE.prototype.makeCode=function(aF){return new p(this,aF)};aE.prototype.wrapInBraces=function(aF){return[].concat(this.makeCode("("),aF,this.makeCode(")"))};aE.prototype.joinFragmentArrays=function(aL,aH){var aK,aF,aI,aJ,aG;aK=[];for(aI=aJ=0,aG=aL.length;aJ<aG;aI=++aJ){aF=aL[aI];if(aI){aK.push(this.makeCode(aH))}aK=aK.concat(aF)}return aK};return aE})();y.Block=k=(function(aF){c(aE,aF);function aE(aG){this.expressions=n(ai(aG||[]))}aE.prototype.children=["expressions"];aE.prototype.push=function(aG){this.expressions.push(aG);return this};aE.prototype.pop=function(){return this.expressions.pop()};aE.prototype.unshift=function(aG){this.expressions.unshift(aG);return this};aE.prototype.unwrap=function(){if(this.expressions.length===1){return this.expressions[0]}else{return this}};aE.prototype.isEmpty=function(){return !this.expressions.length};aE.prototype.isStatement=function(aJ){var aI,aH,aG,aK;aK=this.expressions;for(aH=0,aG=aK.length;aH<aG;aH++){aI=aK[aH];if(aI.isStatement(aJ)){return true}}return false};aE.prototype.jumps=function(aK){var aJ,aG,aI,aH,aL;aL=this.expressions;for(aI=0,aH=aL.length;aI<aH;aI++){aJ=aL[aI];if(aG=aJ.jumps(aK)){return aG}}};aE.prototype.makeReturn=function(aH){var aI,aG;aG=this.expressions.length;while(aG--){aI=this.expressions[aG];if(!(aI instanceof aD)){this.expressions[aG]=aI.makeReturn(aH);if(aI instanceof a&&!aI.expression){this.expressions.splice(aG,1)}break}}return this};aE.prototype.compileToFragments=function(aG,aH){if(aG==null){aG={}}if(aG.scope){return aE.__super__.compileToFragments.call(this,aG,aH)}else{return this.compileRoot(aG)}};aE.prototype.compileNode=function(aH){var aP,aG,aM,aL,aI,aN,aK,aO,aJ;this.tab=aH.indent;aN=aH.level===H;aG=[];aJ=this.expressions;for(aL=aK=0,aO=aJ.length;aK<aO;aL=++aK){aI=aJ[aL];aI=aI.unwrapAll();aI=aI.unfoldSoak(aH)||aI;if(aI instanceof aE){aG.push(aI.compileNode(aH))}else{if(aN){aI.front=true;aM=aI.compileToFragments(aH);if(!aI.isStatement(aH)){aM.unshift(this.makeCode(""+this.tab));aM.push(this.makeCode(";"))}aG.push(aM)}else{aG.push(aI.compileToFragments(aH,e))}}}if(aN){if(this.spaced){return[].concat(this.joinFragmentArrays(aG,"\n\n"),this.makeCode("\n"))}else{return this.joinFragmentArrays(aG,"\n")}}if(aG.length){aP=this.joinFragmentArrays(aG,", ")}else{aP=[this.makeCode("void 0")]}if(aG.length>1&&aH.level>=e){return this.wrapInBraces(aP)}else{return aP}};aE.prototype.compileRoot=function(aH){var aK,aO,aN,aG,aQ,aM,aI,aL,aP,aJ;aH.indent=aH.bare?"":z;aH.level=H;this.spaced=true;aH.scope=new af(null,this,null);aJ=aH.locals||[];for(aL=0,aP=aJ.length;aL<aP;aL++){aG=aJ[aL];aH.scope.parameter(aG)}aQ=[];if(!aH.bare){aM=(function(){var aT,aS,aU,aR;aU=this.expressions;aR=[];for(aN=aT=0,aS=aU.length;aT<aS;aN=++aT){aK=aU[aN];if(!(aK.unwrap() instanceof aD)){break}aR.push(aK)}return aR}).call(this);aI=this.expressions.slice(aM.length);this.expressions=aM;if(aM.length){aQ=this.compileNode(l(aH,{indent:""}));aQ.push(this.makeCode("\n"))}this.expressions=aI}aO=this.compileWithDeclarations(aH);if(aH.bare){return aO}return[].concat(aQ,this.makeCode("(function() {\n"),aO,this.makeCode("\n}).call(this);\n"))};aE.prototype.compileWithDeclarations=function(aG){var aP,aS,aM,aQ,aO,aT,aH,aU,aK,aN,aR,aL,aJ,aI;aQ=[];aT=[];aL=this.expressions;for(aO=aN=0,aR=aL.length;aN<aR;aO=++aN){aM=aL[aO];aM=aM.unwrap();if(!(aM instanceof aD||aM instanceof ae)){break}}aG=l(aG,{level:H});if(aO){aH=this.expressions.splice(aO,9000000000);aJ=[this.spaced,false],aK=aJ[0],this.spaced=aJ[1];aI=[this.compileNode(aG),aK],aQ=aI[0],this.spaced=aI[1];this.expressions=aH}aT=this.compileNode(aG);aU=aG.scope;if(aU.expressions===this){aS=aG.scope.hasDeclarations();aP=aU.hasAssignments;if(aS||aP){if(aO){aQ.push(this.makeCode("\n"))}aQ.push(this.makeCode(""+this.tab+"var "));if(aS){aQ.push(this.makeCode(aU.declaredVariables().join(", ")))}if(aP){if(aS){aQ.push(this.makeCode(",\n"+(this.tab+z)))}aQ.push(this.makeCode(aU.assignedVariables().join(",\n"+(this.tab+z))))}aQ.push(this.makeCode(";\n"+(this.spaced?"\n":"")))}else{if(aQ.length&&aT.length){aQ.push(this.makeCode("\n"))}}}return aQ.concat(aT)};aE.wrap=function(aG){if(aG.length===1&&aG[0] instanceof aE){return aG[0]}return new aE(aG)};return aE})(A);y.Literal=ae=(function(aF){c(aE,aF);function aE(aG){this.value=aG}aE.prototype.makeReturn=function(){if(this.isStatement()){return this}else{return aE.__super__.makeReturn.apply(this,arguments)}};aE.prototype.isAssignable=function(){return b.test(this.value)};aE.prototype.isStatement=function(){var aG;return(aG=this.value)==="break"||aG==="continue"||aG==="debugger"};aE.prototype.isComplex=ar;aE.prototype.assigns=function(aG){return aG===this.value};aE.prototype.jumps=function(aG){if(this.value==="break"&&!((aG!=null?aG.loop:void 0)||(aG!=null?aG.block:void 0))){return this}if(this.value==="continue"&&!(aG!=null?aG.loop:void 0)){return this}};aE.prototype.compileNode=function(aI){var aH,aG,aJ;aG=this.value==="this"?((aJ=aI.scope.method)!=null?aJ.bound:void 0)?aI.scope.method.context:this.value:this.value.reserved?'"'+this.value+'"':this.value;aH=this.isStatement()?""+this.tab+aG+";":aG;return[this.makeCode(aH)]};aE.prototype.toString=function(){return' "'+this.value+'"'};return aE})(A);y.Undefined=(function(aE){c(aF,aE);function aF(){return aF.__super__.constructor.apply(this,arguments)}aF.prototype.isAssignable=ar;aF.prototype.isComplex=ar;aF.prototype.compileNode=function(aG){return[this.makeCode(aG.level>=aC?"(void 0)":"void 0")]};return aF})(A);y.Null=(function(aE){c(aF,aE);function aF(){return aF.__super__.constructor.apply(this,arguments)}aF.prototype.isAssignable=ar;aF.prototype.isComplex=ar;aF.prototype.compileNode=function(){return[this.makeCode("null")]};return aF})(A);y.Bool=(function(aE){c(aF,aE);aF.prototype.isAssignable=ar;aF.prototype.isComplex=ar;aF.prototype.compileNode=function(){return[this.makeCode(this.val)]};function aF(aG){this.val=aG}return aF})(A);y.Return=a=(function(aF){c(aE,aF);function aE(aG){if(aG&&!aG.unwrap().isUndefined){this.expression=aG}}aE.prototype.children=["expression"];aE.prototype.isStatement=K;aE.prototype.makeReturn=V;aE.prototype.jumps=V;aE.prototype.compileToFragments=function(aH,aJ){var aG,aI;aG=(aI=this.expression)!=null?aI.makeReturn():void 0;if(aG&&!(aG instanceof aE)){return aG.compileToFragments(aH,aJ)}else{return aE.__super__.compileToFragments.call(this,aH,aJ)}};aE.prototype.compileNode=function(aH){var aG;aG=[];aG.push(this.makeCode(this.tab+("return"+(this.expression?" ":""))));if(this.expression){aG=aG.concat(this.expression.compileToFragments(aH,ab))}aG.push(this.makeCode(";"));return aG};return aE})(A);y.Value=u=(function(aF){c(aE,aF);function aE(aI,aH,aG){if(!aH&&aI instanceof aE){return aI}this.base=aI;this.properties=aH||[];if(aG){this[aG]=true}return this}aE.prototype.children=["base","properties"];aE.prototype.add=function(aG){this.properties=this.properties.concat(aG);return this};aE.prototype.hasProperties=function(){return !!this.properties.length};aE.prototype.bareLiteral=function(aG){return !this.properties.length&&this.base instanceof aG};aE.prototype.isArray=function(){return this.bareLiteral(al)};aE.prototype.isRange=function(){return this.bareLiteral(t)};aE.prototype.isComplex=function(){return this.hasProperties()||this.base.isComplex()};aE.prototype.isAssignable=function(){return this.hasProperties()||this.base.isAssignable()};aE.prototype.isSimpleNumber=function(){return this.bareLiteral(ae)&&E.test(this.base.value)};aE.prototype.isString=function(){return this.bareLiteral(ae)&&at.test(this.base.value)};aE.prototype.isRegex=function(){return this.bareLiteral(ae)&&M.test(this.base.value)};aE.prototype.isAtomic=function(){var aH,aI,aG,aJ;aJ=this.properties.concat(this.base);for(aI=0,aG=aJ.length;aI<aG;aI++){aH=aJ[aI];if(aH.soak||aH instanceof P){return false}}return true};aE.prototype.isNotCallable=function(){return this.isSimpleNumber()||this.isString()||this.isRegex()||this.isArray()||this.isRange()||this.isSplice()||this.isObject()};aE.prototype.isStatement=function(aG){return !this.properties.length&&this.base.isStatement(aG)};aE.prototype.assigns=function(aG){return !this.properties.length&&this.base.assigns(aG)};aE.prototype.jumps=function(aG){return !this.properties.length&&this.base.jumps(aG)};aE.prototype.isObject=function(aG){if(this.properties.length){return false}return(this.base instanceof d)&&(!aG||this.base.generated)};aE.prototype.isSplice=function(){return C(this.properties) instanceof m};aE.prototype.looksStatic=function(aG){var aH;return this.base.value===aG&&this.properties.length&&((aH=this.properties[0].name)!=null?aH.value:void 0)!=="prototype"};aE.prototype.unwrap=function(){if(this.properties.length){return this}else{return this.base}};aE.prototype.cacheReference=function(aK){var aI,aJ,aG,aH;aG=C(this.properties);if(this.properties.length<2&&!this.base.isComplex()&&!(aG!=null?aG.isComplex():void 0)){return[this,this]}aI=new aE(this.base,this.properties.slice(0,-1));if(aI.isComplex()){aJ=new ae(aK.scope.freeVariable("base"));aI=new aE(new D(new av(aJ,aI)))}if(!aG){return[aI,aJ]}if(aG.isComplex()){aH=new ae(aK.scope.freeVariable("name"));aG=new ax(new av(aH,aG.index));aH=new ax(aH)}return[aI.add(aG),new aE(aJ||aI.base,[aH||aG])]};aE.prototype.compileNode=function(aK){var aG,aL,aI,aJ,aH;this.base.front=this.front;aI=this.properties;aG=this.base.compileToFragments(aK,(aI.length?aC:null));if((this.base instanceof D||aI.length)&&E.test(v(aG))){aG.push(this.makeCode("."))}for(aJ=0,aH=aI.length;aJ<aH;aJ++){aL=aI[aJ];aG.push.apply(aG,aL.compileToFragments(aK))}return aG};aE.prototype.unfoldSoak=function(aG){return this.unfoldedSoak!=null?this.unfoldedSoak:this.unfoldedSoak=(function(aH){return function(){var aJ,aP,aQ,aI,aK,aO,aN,aR,aM,aL;if(aQ=aH.base.unfoldSoak(aG)){(aM=aQ.body.properties).push.apply(aM,aH.properties);return aQ}aL=aH.properties;for(aP=aN=0,aR=aL.length;aN<aR;aP=++aN){aI=aL[aP];if(!aI.soak){continue}aI.soak=false;aJ=new aE(aH.base,aH.properties.slice(0,aP));aO=new aE(aH.base,aH.properties.slice(aP));if(aJ.isComplex()){aK=new ae(aG.scope.freeVariable("ref"));aJ=new D(new av(aK,aJ));aO.base=aK}return new R(new j(aJ),aO,{soak:true})}return false}})(this)()};return aE})(A);y.Comment=aD=(function(aE){c(aF,aE);function aF(aG){this.comment=aG}aF.prototype.isStatement=K;aF.prototype.makeReturn=V;aF.prototype.compileNode=function(aH,aJ){var aG,aI;aI=this.comment.replace(/^(\s*)#/gm,"$1 *");aG="/*"+(aa(aI,this.tab))+(ap.call(aI,"\n")>=0?"\n"+this.tab:"")+" */";if((aJ||aH.level)===H){aG=aH.indent+aG}return[this.makeCode("\n"),this.makeCode(aG)]};return aF})(A);y.Call=P=(function(aF){c(aE,aF);function aE(aI,aH,aG){this.args=aH!=null?aH:[];this.soak=aG;this.isNew=false;this.isSuper=aI==="super";this.variable=this.isSuper?null:aI;if(aI instanceof u&&aI.isNotCallable()){aI.error("literal is not a function")}}aE.prototype.children=["variable","args"];aE.prototype.newInstance=function(){var aG,aH;aG=((aH=this.variable)!=null?aH.base:void 0)||this.variable;if(aG instanceof aE&&!aG.isNew){aG.newInstance()}else{this.isNew=true}return this};aE.prototype.superReference=function(aH){var aG,aI;aI=aH.scope.namedMethod();if(aI!=null?aI.klass:void 0){aG=[new ac(new ae("__super__"))];if(aI["static"]){aG.push(new ac(new ae("constructor")))}aG.push(new ac(new ae(aI.name)));return(new u(new ae(aI.klass),aG)).compile(aH)}else{if(aI!=null?aI.ctor:void 0){return""+aI.name+".__super__.constructor"}else{return this.error("cannot call super outside of an instance method.")}}};aE.prototype.superThis=function(aG){var aH;aH=aG.scope.method;return(aH&&!aH.klass&&aH.context)||"this"};aE.prototype.unfoldSoak=function(aG){var aP,aM,aI,aN,aK,aL,aO,aJ,aH;if(this.soak){if(this.variable){if(aM=U(aG,this,"variable")){return aM}aJ=new u(this.variable).cacheReference(aG),aI=aJ[0],aK=aJ[1]}else{aI=new ae(this.superReference(aG));aK=new u(aI)}aK=new aE(aK,this.args);aK.isNew=this.isNew;aI=new ae("typeof "+(aI.compile(aG))+' === "function"');return new R(aI,new u(aK),{soak:true})}aP=this;aN=[];while(true){if(aP.variable instanceof aE){aN.push(aP);aP=aP.variable;continue}if(!(aP.variable instanceof u)){break}aN.push(aP);if(!((aP=aP.variable.base) instanceof aE)){break}}aH=aN.reverse();for(aL=0,aO=aH.length;aL<aO;aL++){aP=aH[aL];if(aM){if(aP.variable instanceof aE){aP.variable=aM}else{aP.variable.base=aM}}aM=U(aG,aP,"variable")}return aM};aE.prototype.compileNode=function(aG){var aQ,aK,aP,aM,aN,aL,aJ,aO,aI,aH;if((aI=this.variable)!=null){aI.front=this.front}aM=G.compileSplattedArray(aG,this.args,true);if(aM.length){return this.compileSplat(aG,aM)}aP=[];aH=this.args;for(aK=aJ=0,aO=aH.length;aJ<aO;aK=++aJ){aQ=aH[aK];if(aK){aP.push(this.makeCode(", "))}aP.push.apply(aP,aQ.compileToFragments(aG,e))}aN=[];if(this.isSuper){aL=this.superReference(aG)+(".call("+(this.superThis(aG)));if(aP.length){aL+=", "}aN.push(this.makeCode(aL))}else{if(this.isNew){aN.push(this.makeCode("new "))}aN.push.apply(aN,this.variable.compileToFragments(aG,aC));aN.push(this.makeCode("("))}aN.push.apply(aN,aP);aN.push(this.makeCode(")"));return aN};aE.prototype.compileSplat=function(aN,aJ){var aM,aL,aG,aI,aH,aK;if(this.isSuper){return[].concat(this.makeCode(""+(this.superReference(aN))+".apply("+(this.superThis(aN))+", "),aJ,this.makeCode(")"))}if(this.isNew){aI=this.tab+z;return[].concat(this.makeCode("(function(func, args, ctor) {\n"+aI+"ctor.prototype = func.prototype;\n"+aI+"var child = new ctor, result = func.apply(child, args);\n"+aI+"return Object(result) === result ? result : child;\n"+this.tab+"})("),this.variable.compileToFragments(aN,e),this.makeCode(", "),aJ,this.makeCode(", function(){})"))}aM=[];aL=new u(this.variable);if((aH=aL.properties.pop())&&aL.isComplex()){aK=aN.scope.freeVariable("ref");aM=aM.concat(this.makeCode("("+aK+" = "),aL.compileToFragments(aN,e),this.makeCode(")"),aH.compileToFragments(aN))}else{aG=aL.compileToFragments(aN,aC);if(E.test(v(aG))){aG=this.wrapInBraces(aG)}if(aH){aK=v(aG);aG.push.apply(aG,aH.compileToFragments(aN))}else{aK="null"}aM=aM.concat(aG)}return aM=aM.concat(this.makeCode(".apply("+aK+", "),aJ,this.makeCode(")"))};return aE})(A);y.Extends=ak=(function(aF){c(aE,aF);function aE(aH,aG){this.child=aH;this.parent=aG}aE.prototype.children=["child","parent"];aE.prototype.compileToFragments=function(aG){return new P(new u(new ae(F("extends"))),[this.child,this.parent]).compileToFragments(aG)};return aE})(A);y.Access=ac=(function(aE){c(aF,aE);function aF(aH,aG){this.name=aH;this.name.asKey=true;this.soak=aG==="soak"}aF.prototype.children=["name"];aF.prototype.compileToFragments=function(aH){var aG;aG=this.name.compileToFragments(aH);if(b.test(v(aG))){aG.unshift(this.makeCode("."))}else{aG.unshift(this.makeCode("["));aG.push(this.makeCode("]"))}return aG};aF.prototype.isComplex=ar;return aF})(A);y.Index=ax=(function(aE){c(aF,aE);function aF(aG){this.index=aG}aF.prototype.children=["index"];aF.prototype.compileToFragments=function(aG){return[].concat(this.makeCode("["),this.index.compileToFragments(aG,ab),this.makeCode("]"))};aF.prototype.isComplex=function(){return this.index.isComplex()};return aF})(A);y.Range=t=(function(aE){c(aF,aE);aF.prototype.children=["from","to"];function aF(aI,aH,aG){this.from=aI;this.to=aH;this.exclusive=aG==="exclusive";this.equals=this.exclusive?"":"="}aF.prototype.compileVariables=function(aK){var aG,aL,aJ,aI,aH;aK=l(aK,{top:true});aL=this.cacheToCodeFragments(this.from.cache(aK,e)),this.fromC=aL[0],this.fromVar=aL[1];aJ=this.cacheToCodeFragments(this.to.cache(aK,e)),this.toC=aJ[0],this.toVar=aJ[1];if(aG=aq(aK,"step")){aI=this.cacheToCodeFragments(aG.cache(aK,e)),this.step=aI[0],this.stepVar=aI[1]}aH=[this.fromVar.match(w),this.toVar.match(w)],this.fromNum=aH[0],this.toNum=aH[1];if(this.stepVar){return this.stepNum=this.stepVar.match(w)}};aF.prototype.compileNode=function(aH){var aO,aS,aQ,aG,aR,aN,aT,aL,aK,aU,aP,aM,aJ,aI;if(!this.fromVar){this.compileVariables(aH)}if(!aH.index){return this.compileArray(aH)}aT=this.fromNum&&this.toNum;aR=aq(aH,"index");aN=aq(aH,"name");aK=aN&&aN!==aR;aM=""+aR+" = "+this.fromC;if(this.toC!==this.toVar){aM+=", "+this.toC}if(this.step!==this.stepVar){aM+=", "+this.step}aJ=[""+aR+" <"+this.equals,""+aR+" >"+this.equals],aL=aJ[0],aG=aJ[1];aS=this.stepNum?ad(this.stepNum[0])>0?""+aL+" "+this.toVar:""+aG+" "+this.toVar:aT?((aI=[ad(this.fromNum[0]),ad(this.toNum[0])],aQ=aI[0],aP=aI[1],aI),aQ<=aP?""+aL+" "+aP:""+aG+" "+aP):(aO=this.stepVar?""+this.stepVar+" > 0":""+this.fromVar+" <= "+this.toVar,""+aO+" ? "+aL+" "+this.toVar+" : "+aG+" "+this.toVar);aU=this.stepVar?""+aR+" += "+this.stepVar:aT?aK?aQ<=aP?"++"+aR:"--"+aR:aQ<=aP?""+aR+"++":""+aR+"--":aK?""+aO+" ? ++"+aR+" : --"+aR:""+aO+" ? "+aR+"++ : "+aR+"--";if(aK){aM=""+aN+" = "+aM}if(aK){aU=""+aN+" = "+aU}return[this.makeCode(""+aM+"; "+aS+"; "+aU)]};aF.prototype.compileArray=function(aG){var aR,aP,aS,aH,aN,aV,aT,aK,aO,aU,aQ,aM,aJ,aI,aL;if(this.fromNum&&this.toNum&&Math.abs(this.fromNum-this.toNum)<=20){aO=(function(){aL=[];for(var aW=aJ=+this.fromNum,aX=+this.toNum;aJ<=aX?aW<=aX:aW>=aX;aJ<=aX?aW++:aW--){aL.push(aW)}return aL}).apply(this);if(this.exclusive){aO.pop()}return[this.makeCode("["+(aO.join(", "))+"]")]}aV=this.tab+z;aN=aG.scope.freeVariable("i");aU=aG.scope.freeVariable("results");aK="\n"+aV+aU+" = [];";if(this.fromNum&&this.toNum){aG.index=aN;aP=v(this.compileNode(aG))}else{aQ=(""+aN+" = "+this.fromC)+(this.toC!==this.toVar?", "+this.toC:"");aS=""+this.fromVar+" <= "+this.toVar;aP="var "+aQ+"; "+aS+" ? "+aN+" <"+this.equals+" "+this.toVar+" : "+aN+" >"+this.equals+" "+this.toVar+"; "+aS+" ? "+aN+"++ : "+aN+"--"}aT="{ "+aU+".push("+aN+"); }\n"+aV+"return "+aU+";\n"+aG.indent;aH=function(aW){return aW!=null?aW.contains(Z):void 0};if(aH(this.from)||aH(this.to)){aR=", arguments"}return[this.makeCode("(function() {"+aK+"\n"+aV+"for ("+aP+")"+aT+"}).apply(this"+(aR!=null?aR:"")+")")]};return aF})(A);y.Slice=m=(function(aF){c(aE,aF);aE.prototype.children=["range"];function aE(aG){this.range=aG;aE.__super__.constructor.call(this)}aE.prototype.compileNode=function(aK){var aJ,aH,aN,aG,aM,aI,aL;aL=this.range,aM=aL.to,aN=aL.from;aG=aN&&aN.compileToFragments(aK,ab)||[this.makeCode("0")];if(aM){aJ=aM.compileToFragments(aK,ab);aH=v(aJ);if(!(!this.range.exclusive&&+aH===-1)){aI=", "+(this.range.exclusive?aH:E.test(aH)?""+(+aH+1):(aJ=aM.compileToFragments(aK,aC),"+"+(v(aJ))+" + 1 || 9e9"))}}return[this.makeCode(".slice("+(v(aG))+(aI||"")+")")]};return aE})(A);y.Obj=d=(function(aF){c(aE,aF);function aE(aH,aG){this.generated=aG!=null?aG:false;this.objects=this.properties=aH||[]}aE.prototype.children=["properties"];aE.prototype.compileNode=function(aI){var aS,aP,aT,aK,aJ,aL,aM,aG,aQ,aO,aN,aR,aH;aQ=this.properties;if(!aQ.length){return[this.makeCode(this.front?"({})":"{}")]}if(this.generated){for(aO=0,aR=aQ.length;aO<aR;aO++){aM=aQ[aO];if(aM instanceof u){aM.error("cannot have an implicit value in an implicit object")}}}aT=aI.indent+=z;aL=this.lastNonComment(this.properties);aS=[];for(aP=aN=0,aH=aQ.length;aN<aH;aP=++aN){aG=aQ[aP];aJ=aP===aQ.length-1?"":aG===aL||aG instanceof aD?"\n":",\n";aK=aG instanceof aD?"":aT;if(aG instanceof av&&aG.variable instanceof u&&aG.variable.hasProperties()){aG.variable.error("Invalid object key")}if(aG instanceof u&&aG["this"]){aG=new av(aG.properties[0].name,aG,"object")}if(!(aG instanceof aD)){if(!(aG instanceof av)){aG=new av(aG,aG,"object")}(aG.variable.base||aG.variable).asKey=true}if(aK){aS.push(this.makeCode(aK))}aS.push.apply(aS,aG.compileToFragments(aI,H));if(aJ){aS.push(this.makeCode(aJ))}}aS.unshift(this.makeCode("{"+(aQ.length&&"\n")));aS.push(this.makeCode(""+(aQ.length&&"\n"+this.tab)+"}"));if(this.front){return this.wrapInBraces(aS)}else{return aS}};aE.prototype.assigns=function(aH){var aK,aI,aG,aJ;aJ=this.properties;for(aI=0,aG=aJ.length;aI<aG;aI++){aK=aJ[aI];if(aK.assigns(aH)){return true}}return false};return aE})(A);y.Arr=al=(function(aE){c(aF,aE);function aF(aG){this.objects=aG||[]}aF.prototype.children=["objects"];aF.prototype.compileNode=function(aN){var aL,aI,aG,aJ,aM,aK,aH;if(!this.objects.length){return[this.makeCode("[]")]}aN.indent+=z;aL=G.compileSplattedArray(aN,this.objects);if(aL.length){return aL}aL=[];aI=(function(){var aQ,aP,aR,aO;aR=this.objects;aO=[];for(aQ=0,aP=aR.length;aQ<aP;aQ++){aM=aR[aQ];aO.push(aM.compileToFragments(aN,e))}return aO}).call(this);for(aJ=aK=0,aH=aI.length;aK<aH;aJ=++aK){aG=aI[aJ];if(aJ){aL.push(this.makeCode(", "))}aL.push.apply(aL,aG)}if(v(aL).indexOf("\n")>=0){aL.unshift(this.makeCode("[\n"+aN.indent));aL.push(this.makeCode("\n"+this.tab+"]"))}else{aL.unshift(this.makeCode("["));aL.push(this.makeCode("]"))}return aL};aF.prototype.assigns=function(aH){var aJ,aI,aG,aK;aK=this.objects;for(aI=0,aG=aK.length;aI<aG;aI++){aJ=aK[aI];if(aJ.assigns(aH)){return true}}return false};return aF})(A);y.Class=an=(function(aF){c(aE,aF);function aE(aH,aI,aG){this.variable=aH;this.parent=aI;this.body=aG!=null?aG:new k;this.boundFuncs=[];this.body.classBody=true}aE.prototype.children=["variable","parent","body"];aE.prototype.determineName=function(){var aG,aH;if(!this.variable){return null}aG=(aH=C(this.variable.properties))?aH instanceof ac&&aH.name.value:this.variable.base.value;if(ap.call(s,aG)>=0){this.variable.error("class variable name may not be "+aG)}return aG&&(aG=b.test(aG)&&aG)};aE.prototype.setContext=function(aG){return this.body.traverseChildren(false,function(aH){if(aH.classBody){return false}if(aH instanceof ae&&aH.value==="this"){return aH.value=aG}else{if(aH instanceof B){aH.klass=aG;if(aH.bound){return aH.context=aG}}}})};aE.prototype.addBoundFunctions=function(aK){var aI,aH,aJ,aG,aL;aL=this.boundFuncs;for(aJ=0,aG=aL.length;aJ<aG;aJ++){aI=aL[aJ];aH=(new u(new ae("this"),[new ac(aI)])).compile(aK);this.ctor.body.unshift(new ae(""+aH+" = "+(F("bind"))+"("+aH+", this)"))}};aE.prototype.addProperties=function(aK,aH,aN){var aG,aL,aM,aJ,aI;aI=aK.base.properties.slice(0);aM=(function(){var aO;aO=[];while(aG=aI.shift()){if(aG instanceof av){aL=aG.variable.base;delete aG.context;aJ=aG.value;if(aL.value==="constructor"){if(this.ctor){aG.error("cannot define more than one constructor in a class")}if(aJ.bound){aG.error("cannot define a constructor as a bound function")}if(aJ instanceof B){aG=this.ctor=aJ}else{this.externalCtor=aN.classScope.freeVariable("class");aG=new av(new ae(this.externalCtor),aJ)}}else{if(aG.variable["this"]){aJ["static"]=true}else{aG.variable=new u(new ae(aH),[new ac(new ae("prototype")),new ac(aL)]);if(aJ instanceof B&&aJ.bound){this.boundFuncs.push(aL);aJ.bound=false}}}}aO.push(aG)}return aO}).call(this);return n(aM)};aE.prototype.walkBody=function(aG,aH){return this.traverseChildren(false,(function(aI){return function(aQ){var aJ,aO,aL,aM,aN,aK,aP;aJ=true;if(aQ instanceof aE){return false}if(aQ instanceof k){aP=aO=aQ.expressions;for(aL=aN=0,aK=aP.length;aN<aK;aL=++aN){aM=aP[aL];if(aM instanceof av&&aM.variable.looksStatic(aG)){aM.value["static"]=true}else{if(aM instanceof u&&aM.isObject(true)){aJ=false;aO[aL]=aI.addProperties(aM,aG,aH)}}}aQ.expressions=aO=ai(aO)}return aJ&&!(aQ instanceof aE)}})(this))};aE.prototype.hoistDirectivePrologue=function(){var aI,aG,aH;aG=0;aI=this.body.expressions;while((aH=aI[aG])&&aH instanceof aD||aH instanceof u&&aH.isString()){++aG}return this.directives=aI.splice(0,aG)};aE.prototype.ensureConstructor=function(aG){if(!this.ctor){this.ctor=new B;if(this.externalCtor){this.ctor.body.push(new ae(""+this.externalCtor+".apply(this, arguments)"))}else{if(this.parent){this.ctor.body.push(new ae(""+aG+".__super__.constructor.apply(this, arguments)"))}}this.ctor.body.makeReturn();this.body.expressions.unshift(this.ctor)}this.ctor.ctor=this.ctor.name=aG;this.ctor.klass=null;return this.ctor.noReturn=true};aE.prototype.compileNode=function(aH){var aL,aP,aI,aM,aK,aO,aG,aN,aJ;if(aM=this.body.jumps()){aM.error("Class bodies cannot contain pure statements")}if(aP=this.body.contains(Z)){aP.error("Class bodies shouldn't reference arguments")}aG=this.determineName()||"_Class";if(aG.reserved){aG="_"+aG}aO=new ae(aG);aI=new B([],k.wrap([this.body]));aL=[];aH.classScope=aI.makeScope(aH.scope);this.hoistDirectivePrologue();this.setContext(aG);this.walkBody(aG,aH);this.ensureConstructor(aG);this.addBoundFunctions(aH);this.body.spaced=true;this.body.expressions.push(aO);if(this.parent){aN=new ae(aH.classScope.freeVariable("super",false));this.body.expressions.unshift(new ak(aO,aN));aI.params.push(new J(aN));aL.push(this.parent)}(aJ=this.body.expressions).unshift.apply(aJ,this.directives);aK=new D(new P(aI,aL));if(this.variable){aK=new av(this.variable,aK)}return aK.compileToFragments(aH)};return aE})(A);y.Assign=av=(function(aE){c(aF,aE);function aF(aJ,aL,aK,aI){var aH,aG,aM;this.variable=aJ;this.value=aL;this.context=aK;this.param=aI&&aI.param;this.subpattern=aI&&aI.subpattern;aH=(aM=(aG=this.variable.unwrapAll().value),ap.call(s,aM)>=0);if(aH&&this.context!=="object"){this.variable.error('variable name may not be "'+aG+'"')}}aF.prototype.children=["variable","value"];aF.prototype.isStatement=function(aG){return(aG!=null?aG.level:void 0)===H&&(this.context!=null)&&ap.call(this.context,"?")>=0};aF.prototype.assigns=function(aG){return this[this.context==="object"?"value":"variable"].assigns(aG)};aF.prototype.unfoldSoak=function(aG){return U(aG,this,"variable")};aF.prototype.compileNode=function(aH){var aQ,aM,aP,aO,aG,aJ,aN,aL,aK,aI;if(aP=this.variable instanceof u){if(this.variable.isArray()||this.variable.isObject()){return this.compilePatternMatch(aH)}if(this.variable.isSplice()){return this.compileSplice(aH)}if((aL=this.context)==="||="||aL==="&&="||aL==="?="){return this.compileConditional(aH)}}aM=this.variable.compileToFragments(aH,e);aG=v(aM);if(!this.context){aN=this.variable.unwrapAll();if(!aN.isAssignable()){this.variable.error('"'+(this.variable.compile(aH))+'" cannot be assigned')}if(!(typeof aN.hasProperties==="function"?aN.hasProperties():void 0)){if(this.param){aH.scope.add(aG,"var")}else{aH.scope.find(aG)}}}if(this.value instanceof B&&(aO=ag.exec(aG))){if(aO[2]){this.value.klass=aO[1]}this.value.name=(aK=(aI=aO[3])!=null?aI:aO[4])!=null?aK:aO[5]}aJ=this.value.compileToFragments(aH,e);if(this.context==="object"){return aM.concat(this.makeCode(": "),aJ)}aQ=aM.concat(this.makeCode(" "+(this.context||"=")+" "),aJ);if(aH.level<=e){return aQ}else{return this.wrapInBraces(aQ)}};aF.prototype.compilePatternMatch=function(a1){var aP,aV,aJ,a7,a3,aZ,aU,aW,a8,aX,aI,aS,aR,aY,a5,a0,a6,a2,aT,aQ,aN,a4,aO,aM,aL,aK,aH,aG;a0=a1.level===H;a2=this.value;aI=this.variable.base.objects;if(!(aS=aI.length)){aJ=a2.compileToFragments(a1);if(a1.level>=q){return this.wrapInBraces(aJ)}else{return aJ}}aU=this.variable.isObject();if(a0&&aS===1&&!((aX=aI[0]) instanceof G)){if(aX instanceof aF){aO=aX,(aM=aO.variable,aZ=aM.base),aX=aO.value}else{aZ=aU?aX["this"]?aX.properties[0].name:aX:new ae(0)}aP=b.test(aZ.unwrap().value||0);a2=new u(a2);a2.properties.push(new (aP?ac:ax)(aZ));if(aL=aX.unwrap().value,ap.call(ah,aL)>=0){aX.error("assignment to a reserved word: "+(aX.compile(a1)))}return new aF(aX,a2,null,{param:this.param}).compileToFragments(a1,H)}aT=a2.compileToFragments(a1,e);aQ=v(aT);aV=[];a5=false;if(!b.test(aQ)||this.variable.assigns(aQ)){aV.push([this.makeCode(""+(aR=a1.scope.freeVariable("ref"))+" = ")].concat(g.call(aT)));aT=[this.makeCode(aR)];aQ=aR}for(a3=aN=0,a4=aI.length;aN<a4;a3=++aN){aX=aI[a3];aZ=a3;if(aU){if(aX instanceof aF){aK=aX,(aH=aK.variable,aZ=aH.base),aX=aK.value}else{if(aX.base instanceof D){aG=new u(aX.unwrapAll()).cacheReference(a1),aX=aG[0],aZ=aG[1]}else{aZ=aX["this"]?aX.properties[0].name:aX}}}if(!a5&&aX instanceof G){a8=aX.name.unwrap().value;aX=aX.unwrap();a6=""+aS+" <= "+aQ+".length ? "+(F("slice"))+".call("+aQ+", "+a3;if(aY=aS-a3-1){aW=a1.scope.freeVariable("i");a6+=", "+aW+" = "+aQ+".length - "+aY+") : ("+aW+" = "+a3+", [])"}else{a6+=") : []"}a6=new ae(a6);a5=""+aW+"++"}else{a8=aX.unwrap().value;if(aX instanceof G){aX.error("multiple splats are disallowed in an assignment")}if(typeof aZ==="number"){aZ=new ae(a5||aZ);aP=false}else{aP=aU&&b.test(aZ.unwrap().value||0)}a6=new u(new ae(aQ),[new (aP?ac:ax)(aZ)])}if((a8!=null)&&ap.call(ah,a8)>=0){aX.error("assignment to a reserved word: "+(aX.compile(a1)))}aV.push(new aF(aX,a6,null,{param:this.param,subpattern:true}).compileToFragments(a1,e))}if(!(a0||this.subpattern)){aV.push(aT)}a7=this.joinFragmentArrays(aV,", ");if(a1.level<e){return a7}else{return this.wrapInBraces(a7)}};aF.prototype.compileConditional=function(aJ){var aG,aI,aH,aK;aK=this.variable.cacheReference(aJ),aI=aK[0],aH=aK[1];if(!aI.properties.length&&aI.base instanceof ae&&aI.base.value!=="this"&&!aJ.scope.check(aI.base.value)){this.variable.error('the variable "'+aI.base.value+"\" can't be assigned with "+this.context+" because it has not been declared before")}if(ap.call(this.context,"?")>=0){aJ.isExistentialEquals=true;return new R(new j(aI),aH,{type:"if"}).addElse(new aF(aH,this.value,"=")).compileToFragments(aJ)}else{aG=new N(this.context.slice(0,-1),aI,new aF(aH,this.value,"=")).compileToFragments(aJ);if(aJ.level<=e){return aG}else{return this.wrapInBraces(aG)}}};aF.prototype.compileSplice=function(aI){var aS,aH,aQ,aK,aN,aG,aR,aO,aP,aM,aL,aJ;aM=this.variable.properties.pop().range,aQ=aM.from,aR=aM.to,aH=aM.exclusive;aG=this.variable.compile(aI);if(aQ){aL=this.cacheToCodeFragments(aQ.cache(aI,q)),aK=aL[0],aN=aL[1]}else{aK=aN="0"}if(aR){if(aQ instanceof u&&aQ.isSimpleNumber()&&aR instanceof u&&aR.isSimpleNumber()){aR=aR.compile(aI)-aN;if(!aH){aR+=1}}else{aR=aR.compile(aI,aC)+" - "+aN;if(!aH){aR+=" + 1"}}}else{aR="9e9"}aJ=this.value.cache(aI,e),aO=aJ[0],aP=aJ[1];aS=[].concat(this.makeCode("[].splice.apply("+aG+", ["+aK+", "+aR+"].concat("),aO,this.makeCode(")), "),aP);if(aI.level>H){return this.wrapInBraces(aS)}else{return aS}};return aF})(A);y.Code=B=(function(aF){c(aE,aF);function aE(aI,aH,aG){this.params=aI||[];this.body=aH||new k;this.bound=aG==="boundfunc"}aE.prototype.children=["params","body"];aE.prototype.isStatement=function(){return !!this.ctor};aE.prototype.jumps=ar;aE.prototype.makeScope=function(aG){return new af(aG,this.body,this)};aE.prototype.compileNode=function(a0){var aY,ba,aM,aX,a2,aI,aZ,aW,a4,aU,aJ,a1,bd,a9,aV,aS,aQ,aO,aL,a7,bb,a8,a6,a5,a3,aH,bc,aT,aR,aP,aN,aK,aG;if(this.bound&&((aT=a0.scope.method)!=null?aT.bound:void 0)){this.context=a0.scope.method.context}if(this.bound&&!this.context){this.context="_this";aV=new aE([new J(new ae(this.context))],new k([this]));ba=new P(aV,[new ae("this")]);ba.updateLocationDataIfMissing(this.locationData);return ba.compileNode(a0)}a0.scope=aq(a0,"classScope")||this.makeScope(a0.scope);a0.scope.shared=aq(a0,"sharedScope");a0.indent+=z;delete a0.bare;delete a0.isExistentialEquals;a4=[];aX=[];aR=this.params;for(aS=0,a7=aR.length;aS<a7;aS++){aW=aR[aS];a0.scope.parameter(aW.asReference(a0))}aP=this.params;for(aQ=0,bb=aP.length;aQ<bb;aQ++){aW=aP[aQ];if(!aW.splat){continue}aN=this.params;for(aO=0,a8=aN.length;aO<a8;aO++){aZ=aN[aO].name;if(aZ["this"]){aZ=aZ.properties[0].name}if(aZ.value){a0.scope.add(aZ.value,"var",true)}}aJ=new av(new u(new al((function(){var bf,bh,bg,be;bg=this.params;be=[];for(bf=0,bh=bg.length;bf<bh;bf++){aZ=bg[bf];be.push(aZ.asReference(a0))}return be}).call(this))),new u(new ae("arguments")));break}aK=this.params;for(aL=0,a6=aK.length;aL<a6;aL++){aW=aK[aL];if(aW.isComplex()){bd=aU=aW.asReference(a0);if(aW.value){bd=new N("?",aU,aW.value)}aX.push(new av(new u(aW.name),bd,"=",{param:true}))}else{aU=aW;if(aW.value){aI=new ae(aU.name.value+" == null");bd=new av(new u(aW.name),aW.value,"=");aX.push(new R(aI,bd))}}if(!aJ){a4.push(aU)}}a9=this.body.isEmpty();if(aJ){aX.unshift(aJ)}if(aX.length){(aG=this.body.expressions).unshift.apply(aG,aX)}for(a2=aH=0,a5=a4.length;aH<a5;a2=++aH){aZ=a4[a2];a4[a2]=aZ.compileToFragments(a0);a0.scope.parameter(v(a4[a2]))}a1=[];this.eachParamName(function(be,bf){if(ap.call(a1,be)>=0){bf.error("multiple parameters named '"+be+"'")}return a1.push(be)});if(!(a9||this.noReturn)){this.body.makeReturn()}aM="function";if(this.ctor){aM+=" "+this.name}aM+="(";aY=[this.makeCode(aM)];for(a2=bc=0,a3=a4.length;bc<a3;a2=++bc){aZ=a4[a2];if(a2){aY.push(this.makeCode(", "))}aY.push.apply(aY,aZ)}aY.push(this.makeCode(") {"));if(!this.body.isEmpty()){aY=aY.concat(this.makeCode("\n"),this.body.compileWithDeclarations(a0),this.makeCode("\n"+this.tab))}aY.push(this.makeCode("}"));if(this.ctor){return[this.makeCode(this.tab)].concat(g.call(aY))}if(this.front||(a0.level>=aC)){return this.wrapInBraces(aY)}else{return aY}};aE.prototype.eachParamName=function(aI){var aK,aJ,aH,aL,aG;aL=this.params;aG=[];for(aJ=0,aH=aL.length;aJ<aH;aJ++){aK=aL[aJ];aG.push(aK.eachName(aI))}return aG};aE.prototype.traverseChildren=function(aH,aG){if(aH){return aE.__super__.traverseChildren.call(this,aH,aG)}};return aE})(A);y.Param=J=(function(aF){c(aE,aF);function aE(aG,aH,aJ){var aI;this.name=aG;this.value=aH;this.splat=aJ;if(aI=(aG=this.name.unwrapAll().value),ap.call(s,aI)>=0){this.name.error('parameter name "'+aG+'" is not allowed')}}aE.prototype.children=["name","value"];aE.prototype.compileToFragments=function(aG){return this.name.compileToFragments(aG,e)};aE.prototype.asReference=function(aH){var aG;if(this.reference){return this.reference}aG=this.name;if(aG["this"]){aG=aG.properties[0].name;if(aG.value.reserved){aG=new ae(aH.scope.freeVariable(aG.value))}}else{if(aG.isComplex()){aG=new ae(aH.scope.freeVariable("arg"))}}aG=new u(aG);if(this.splat){aG=new G(aG)}aG.updateLocationDataIfMissing(this.locationData);return this.reference=aG};aE.prototype.isComplex=function(){return this.name.isComplex()};aE.prototype.eachName=function(aI,aH){var aN,aJ,aL,aK,aG,aM;if(aH==null){aH=this.name}aN=function(aP){var aO;aO=aP.properties[0].name;if(!aO.value.reserved){return aI(aO.value,aO)}};if(aH instanceof ae){return aI(aH.value,aH)}if(aH instanceof u){return aN(aH)}aM=aH.objects;for(aK=0,aG=aM.length;aK<aG;aK++){aL=aM[aK];if(aL instanceof av){this.eachName(aI,aL.value.unwrap())}else{if(aL instanceof G){aJ=aL.name.unwrap();aI(aJ.value,aJ)}else{if(aL instanceof u){if(aL.isArray()||aL.isObject()){this.eachName(aI,aL.base)}else{if(aL["this"]){aN(aL)}else{aI(aL.base.value,aL.base)}}}else{aL.error("illegal parameter "+(aL.compile()))}}}}};return aE})(A);y.Splat=G=(function(aF){c(aE,aF);aE.prototype.children=["name"];aE.prototype.isAssignable=K;function aE(aG){this.name=aG.compile?aG:new ae(aG)}aE.prototype.assigns=function(aG){return this.name.assigns(aG)};aE.prototype.compileToFragments=function(aG){return this.name.compileToFragments(aG)};aE.prototype.unwrap=function(){return this.name};aE.compileSplattedArray=function(aH,aN,aR){var aO,aG,aM,aS,aP,aK,aL,aI,aJ,aQ;aL=-1;while((aI=aN[++aL])&&!(aI instanceof aE)){continue}if(aL>=aN.length){return[]}if(aN.length===1){aI=aN[0];aP=aI.compileToFragments(aH,e);if(aR){return aP}return[].concat(aI.makeCode(""+(F("slice"))+".call("),aP,aI.makeCode(")"))}aO=aN.slice(aL);for(aK=aJ=0,aQ=aO.length;aJ<aQ;aK=++aJ){aI=aO[aK];aM=aI.compileToFragments(aH,e);aO[aK]=aI instanceof aE?[].concat(aI.makeCode(""+(F("slice"))+".call("),aM,aI.makeCode(")")):[].concat(aI.makeCode("["),aM,aI.makeCode("]"))}if(aL===0){aI=aN[0];aS=aI.joinFragmentArrays(aO.slice(1),", ");return aO[0].concat(aI.makeCode(".concat("),aS,aI.makeCode(")"))}aG=(function(){var aV,aU,aW,aT;aW=aN.slice(0,aL);aT=[];for(aV=0,aU=aW.length;aV<aU;aV++){aI=aW[aV];aT.push(aI.compileToFragments(aH,e))}return aT})();aG=aN[0].joinFragmentArrays(aG,", ");aS=aN[aL].joinFragmentArrays(aO,", ");return[].concat(aN[0].makeCode("["),aG,aN[aL].makeCode("].concat("),aS,(C(aN)).makeCode(")"))};return aE})(A);y.While=ay=(function(aF){c(aE,aF);function aE(aH,aG){this.condition=(aG!=null?aG.invert:void 0)?aH.invert():aH;this.guard=aG!=null?aG.guard:void 0}aE.prototype.children=["condition","guard","body"];aE.prototype.isStatement=K;aE.prototype.makeReturn=function(aG){if(aG){return aE.__super__.makeReturn.apply(this,arguments)}else{this.returns=!this.jumps({loop:true});return this}};aE.prototype.addBody=function(aG){this.body=aG;return this};aE.prototype.jumps=function(){var aJ,aG,aI,aK,aH;aJ=this.body.expressions;if(!aJ.length){return false}for(aK=0,aH=aJ.length;aK<aH;aK++){aI=aJ[aK];if(aG=aI.jumps({loop:true})){return aG}}return false};aE.prototype.compileNode=function(aJ){var aI,aG,aH,aK;aJ.indent+=z;aK="";aG=this.body;if(aG.isEmpty()){aG=this.makeCode("")}else{if(this.returns){aG.makeReturn(aH=aJ.scope.freeVariable("results"));aK=""+this.tab+aH+" = [];\n"}if(this.guard){if(aG.expressions.length>1){aG.expressions.unshift(new R((new D(this.guard)).invert(),new ae("continue")))}else{if(this.guard){aG=k.wrap([new R(this.guard,aG)])}}}aG=[].concat(this.makeCode("\n"),aG.compileToFragments(aJ,H),this.makeCode("\n"+this.tab))}aI=[].concat(this.makeCode(aK+this.tab+"while ("),this.condition.compileToFragments(aJ,ab),this.makeCode(") {"),aG,this.makeCode("}"));if(this.returns){aI.push(this.makeCode("\n"+this.tab+"return "+aH+";"))}return aI};return aE})(A);y.Op=N=(function(aG){var aH,aF;c(aE,aG);function aE(aL,aK,aI,aJ){if(aL==="in"){return new L(aK,aI)}if(aL==="do"){return this.generateDo(aK)}if(aL==="new"){if(aK instanceof P&&!aK["do"]&&!aK.isNew){return aK.newInstance()}if(aK instanceof B&&aK.bound||aK["do"]){aK=new D(aK)}}this.operator=aH[aL]||aL;this.first=aK;this.second=aI;this.flip=!!aJ;return this}aH={"==":"===","!=":"!==",of:"in"};aF={"!==":"===","===":"!=="};aE.prototype.children=["first","second"];aE.prototype.isSimpleNumber=ar;aE.prototype.isUnary=function(){return !this.second};aE.prototype.isComplex=function(){var aI;return !(this.isUnary()&&((aI=this.operator)==="+"||aI==="-"))||this.first.isComplex()};aE.prototype.isChainable=function(){var aI;return(aI=this.operator)==="<"||aI===">"||aI===">="||aI==="<="||aI==="==="||aI==="!=="};aE.prototype.invert=function(){var aJ,aK,aI,aM,aL;if(this.isChainable()&&this.first.isChainable()){aJ=true;aK=this;while(aK&&aK.operator){aJ&&(aJ=aK.operator in aF);aK=aK.first}if(!aJ){return new D(this).invert()}aK=this;while(aK&&aK.operator){aK.invert=!aK.invert;aK.operator=aF[aK.operator];aK=aK.first}return this}else{if(aM=aF[this.operator]){this.operator=aM;if(this.first.unwrap() instanceof aE){this.first.invert()}return this}else{if(this.second){return new D(this).invert()}else{if(this.operator==="!"&&(aI=this.first.unwrap()) instanceof aE&&((aL=aI.operator)==="!"||aL==="in"||aL==="instanceof")){return aI}else{return new aE("!",this)}}}}};aE.prototype.unfoldSoak=function(aI){var aJ;return((aJ=this.operator)==="++"||aJ==="--"||aJ==="delete")&&U(aI,this,"first")};aE.prototype.generateDo=function(aM){var aQ,aK,aJ,aN,aI,aO,aP,aL;aN=[];aK=aM instanceof av&&(aI=aM.value.unwrap()) instanceof B?aI:aM;aL=aK.params||[];for(aO=0,aP=aL.length;aO<aP;aO++){aJ=aL[aO];if(aJ.value){aN.push(aJ.value);delete aJ.value}else{aN.push(aJ)}}aQ=new P(aM,aN);aQ["do"]=true;return aQ};aE.prototype.compileNode=function(aL){var aJ,aI,aM,aK;aI=this.isChainable()&&this.first.isChainable();if(!aI){this.first.front=this.front}if(this.operator==="delete"&&aL.scope.check(this.first.unwrapAll().value)){this.error("delete operand may not be argument or var")}if(((aM=this.operator)==="--"||aM==="++")&&(aK=this.first.unwrapAll().value,ap.call(s,aK)>=0)){this.error('cannot increment/decrement "'+(this.first.unwrapAll().value)+'"')}if(this.isUnary()){return this.compileUnary(aL)}if(aI){return this.compileChain(aL)}if(this.operator==="?"){return this.compileExistence(aL)}aJ=[].concat(this.first.compileToFragments(aL,q),this.makeCode(" "+this.operator+" "),this.second.compileToFragments(aL,q));if(aL.level<=q){return aJ}else{return this.wrapInBraces(aJ)}};aE.prototype.compileChain=function(aL){var aI,aJ,aK,aM;aM=this.first.second.cache(aL),this.first.second=aM[0],aK=aM[1];aJ=this.first.compileToFragments(aL,q);aI=aJ.concat(this.makeCode(" "+(this.invert?"&&":"||")+" "),aK.compileToFragments(aL),this.makeCode(" "+this.operator+" "),this.second.compileToFragments(aL,q));return this.wrapInBraces(aI)};aE.prototype.compileExistence=function(aK){var aI,aJ;if(this.first.isComplex()){aJ=new ae(aK.scope.freeVariable("ref"));aI=new D(new av(aJ,this.first))}else{aI=this.first;aJ=aI}return new R(new j(aI),aJ,{type:"if"}).addElse(this.second).compileToFragments(aK)};aE.prototype.compileUnary=function(aK){var aL,aJ,aI;aJ=[];aL=this.operator;aJ.push([this.makeCode(aL)]);if(aL==="!"&&this.first instanceof j){this.first.negated=!this.first.negated;return this.first.compileToFragments(aK)}if(aK.level>=aC){return(new D(this)).compileToFragments(aK)}aI=aL==="+"||aL==="-";if((aL==="new"||aL==="typeof"||aL==="delete")||aI&&this.first instanceof aE&&this.first.operator===aL){aJ.push([this.makeCode(" ")])}if((aI&&this.first instanceof aE)||(aL==="new"&&this.first.isStatement(aK))){this.first=new D(this.first)}aJ.push(this.first.compileToFragments(aK,q));if(this.flip){aJ.reverse()}return this.joinFragmentArrays(aJ,"")};aE.prototype.toString=function(aI){return aE.__super__.toString.call(this,aI,this.constructor.name+" "+this.operator)};return aE})(A);y.In=L=(function(aF){c(aE,aF);function aE(aG,aH){this.object=aG;this.array=aH}aE.prototype.children=["object","array"];aE.prototype.invert=au;aE.prototype.compileNode=function(aK){var aI,aJ,aH,aG,aL;if(this.array instanceof u&&this.array.isArray()){aL=this.array.base.objects;for(aH=0,aG=aL.length;aH<aG;aH++){aJ=aL[aH];if(!(aJ instanceof G)){continue}aI=true;break}if(!aI){return this.compileOrTest(aK)}}return this.compileLoopTest(aK)};aE.prototype.compileOrTest=function(aH){var aQ,aP,aO,aS,aJ,aG,aK,aN,aR,aM,aL,aI;if(this.array.base.objects.length===0){return[this.makeCode(""+(!!this.negated))]}aM=this.object.cache(aH,q),aG=aM[0],aJ=aM[1];aL=this.negated?[" !== "," && "]:[" === "," || "],aQ=aL[0],aP=aL[1];aK=[];aI=this.array.base.objects;for(aO=aN=0,aR=aI.length;aN<aR;aO=++aN){aS=aI[aO];if(aO){aK.push(this.makeCode(aP))}aK=aK.concat((aO?aJ:aG),this.makeCode(aQ),aS.compileToFragments(aH,aC))}if(aH.level<q){return aK}else{return this.wrapInBraces(aK)}};aE.prototype.compileLoopTest=function(aJ){var aG,aI,aH,aK;aK=this.object.cache(aJ,e),aH=aK[0],aI=aK[1];aG=[].concat(this.makeCode(F("indexOf")+".call("),this.array.compileToFragments(aJ,e),this.makeCode(", "),aI,this.makeCode(") "+(this.negated?"< 0":">= 0")));if(v(aH)===v(aI)){return aG}aG=aH.concat(this.makeCode(", "),aG);if(aJ.level<e){return aG}else{return this.wrapInBraces(aG)}};aE.prototype.toString=function(aG){return aE.__super__.toString.call(this,aG,this.constructor.name+(this.negated?"!":""))};return aE})(A);y.Try=i=(function(aF){c(aE,aF);function aE(aG,aJ,aH,aI){this.attempt=aG;this.errorVariable=aJ;this.recovery=aH;this.ensure=aI}aE.prototype.children=["attempt","recovery","ensure"];aE.prototype.isStatement=K;aE.prototype.jumps=function(aG){var aH;return this.attempt.jumps(aG)||((aH=this.recovery)!=null?aH.jumps(aG):void 0)};aE.prototype.makeReturn=function(aG){if(this.attempt){this.attempt=this.attempt.makeReturn(aG)}if(this.recovery){this.recovery=this.recovery.makeReturn(aG)}return this};aE.prototype.compileNode=function(aK){var aG,aI,aJ,aH;aK.indent+=z;aH=this.attempt.compileToFragments(aK,H);aG=this.recovery?(aJ=new ae("_error"),this.errorVariable?this.recovery.unshift(new av(this.errorVariable,aJ)):void 0,[].concat(this.makeCode(" catch ("),aJ.compileToFragments(aK),this.makeCode(") {\n"),this.recovery.compileToFragments(aK,H),this.makeCode("\n"+this.tab+"}"))):!(this.ensure||this.recovery)?[this.makeCode(" catch (_error) {}")]:[];aI=this.ensure?[].concat(this.makeCode(" finally {\n"),this.ensure.compileToFragments(aK,H),this.makeCode("\n"+this.tab+"}")):[];return[].concat(this.makeCode(""+this.tab+"try {\n"),aH,this.makeCode("\n"+this.tab+"}"),aG,aI)};return aE})(A);y.Throw=Y=(function(aF){c(aE,aF);function aE(aG){this.expression=aG}aE.prototype.children=["expression"];aE.prototype.isStatement=K;aE.prototype.jumps=ar;aE.prototype.makeReturn=V;aE.prototype.compileNode=function(aG){return[].concat(this.makeCode(this.tab+"throw "),this.expression.compileToFragments(aG),this.makeCode(";"))};return aE})(A);y.Existence=j=(function(aE){c(aF,aE);function aF(aG){this.expression=aG}aF.prototype.children=["expression"];aF.prototype.invert=au;aF.prototype.compileNode=function(aJ){var aI,aG,aH,aK;this.expression.front=this.front;aH=this.expression.compile(aJ,q);if(b.test(aH)&&!aJ.scope.check(aH)){aK=this.negated?["===","||"]:["!==","&&"],aI=aK[0],aG=aK[1];aH="typeof "+aH+" "+aI+' "undefined" '+aG+" "+aH+" "+aI+" null"}else{aH=""+aH+" "+(this.negated?"==":"!=")+" null"}return[this.makeCode(aJ.level<=I?aH:"("+aH+")")]};return aF})(A);y.Parens=D=(function(aF){c(aE,aF);function aE(aG){this.body=aG}aE.prototype.children=["body"];aE.prototype.unwrap=function(){return this.body};aE.prototype.isComplex=function(){return this.body.isComplex()};aE.prototype.compileNode=function(aJ){var aH,aI,aG;aI=this.body.unwrap();if(aI instanceof u&&aI.isAtomic()){aI.front=this.front;return aI.compileToFragments(aJ)}aG=aI.compileToFragments(aJ,ab);aH=aJ.level<q&&(aI instanceof N||aI instanceof P||(aI instanceof h&&aI.returns));if(aH){return aG}else{return this.wrapInBraces(aG)}};return aE})(A);y.For=h=(function(aF){c(aE,aF);function aE(aG,aH){var aI;this.source=aH.source,this.guard=aH.guard,this.step=aH.step,this.name=aH.name,this.index=aH.index;this.body=k.wrap([aG]);this.own=!!aH.own;this.object=!!aH.object;if(this.object){aI=[this.index,this.name],this.name=aI[0],this.index=aI[1]}if(this.index instanceof u){this.index.error("index cannot be a pattern matching expression")}this.range=this.source instanceof u&&this.source.base instanceof t&&!this.source.properties.length;this.pattern=this.name instanceof u;if(this.range&&this.index){this.index.error("indexes do not apply to range loops")}if(this.range&&this.pattern){this.name.error("cannot pattern match over range loops")}if(this.own&&!this.object){this.name.error("cannot use own with for-in")}this.returns=false}aE.prototype.children=["body","source","guard","step"];aE.prototype.compileNode=function(aY){var aV,a5,bc,aX,a6,aQ,aK,aS,aU,aJ,aP,aR,a7,aO,aW,a2,a1,aN,ba,be,a0,aL,a3,a9,a4,aG,aZ,aM,aT,bb,bd,a8,aI,aH;aV=k.wrap([this.body]);aN=(aI=C(aV.expressions))!=null?aI.jumps():void 0;if(aN&&aN instanceof a){this.returns=false}aZ=this.range?this.source.base:this.source;aG=aY.scope;be=this.name&&(this.name.compile(aY,e));aO=this.index&&(this.index.compile(aY,e));if(be&&!this.pattern){aG.find(be)}if(aO){aG.find(aO)}if(this.returns){a4=aG.freeVariable("results")}aW=(this.object&&aO)||aG.freeVariable("i");a2=(this.range&&be)||aO||aW;a1=a2!==aW?""+a2+" = ":"";if(this.step&&!this.range){aH=this.cacheToCodeFragments(this.step.cache(aY,e)),aM=aH[0],bb=aH[1];aT=bb.match(w)}if(this.pattern){be=aW}a8="";aP="";aK="";aR=this.tab+z;if(this.range){aJ=aZ.compileToFragments(l(aY,{index:aW,name:be,step:this.step}))}else{bd=this.source.compile(aY,e);if((be||this.own)&&!b.test(bd)){aK+=""+this.tab+(aL=aG.freeVariable("ref"))+" = "+bd+";\n";bd=aL}if(be&&!this.pattern){a0=""+be+" = "+bd+"["+a2+"]"}if(!this.object){if(aM!==bb){aK+=""+this.tab+aM+";\n"}if(!(this.step&&aT&&(aU=ad(aT[0])<0))){ba=aG.freeVariable("len")}a6=""+a1+aW+" = 0, "+ba+" = "+bd+".length";aQ=""+a1+aW+" = "+bd+".length - 1";bc=""+aW+" < "+ba;aX=""+aW+" >= 0";if(this.step){if(aT){if(aU){bc=aX;a6=aQ}}else{bc=""+bb+" > 0 ? "+bc+" : "+aX;a6="("+bb+" > 0 ? ("+a6+") : "+aQ+")"}a7=""+aW+" += "+bb}else{a7=""+(a2!==aW?"++"+aW:""+aW+"++")}aJ=[this.makeCode(""+a6+"; "+bc+"; "+a1+a7)]}}if(this.returns){a3=""+this.tab+a4+" = [];\n";a9="\n"+this.tab+"return "+a4+";";aV.makeReturn(a4)}if(this.guard){if(aV.expressions.length>1){aV.expressions.unshift(new R((new D(this.guard)).invert(),new ae("continue")))}else{if(this.guard){aV=k.wrap([new R(this.guard,aV)])}}}if(this.pattern){aV.expressions.unshift(new av(this.name,new ae(""+bd+"["+a2+"]")))}aS=[].concat(this.makeCode(aK),this.pluckDirectCall(aY,aV));if(a0){a8="\n"+aR+a0+";"}if(this.object){aJ=[this.makeCode(""+a2+" in "+bd)];if(this.own){aP="\n"+aR+"if (!"+(F("hasProp"))+".call("+bd+", "+a2+")) continue;"}}a5=aV.compileToFragments(l(aY,{indent:aR}),H);if(a5&&(a5.length>0)){a5=[].concat(this.makeCode("\n"),a5,this.makeCode("\n"))}return[].concat(aS,this.makeCode(""+(a3||"")+this.tab+"for ("),aJ,this.makeCode(") {"+aP+a8),a5,this.makeCode(""+this.tab+"}"+(a9||"")))};aE.prototype.pluckDirectCall=function(aU,aS){var aP,aH,aN,aR,aT,aQ,aX,aL,aV,aO,aM,aK,aJ,aI,aG,aW;aH=[];aO=aS.expressions;for(aT=aL=0,aV=aO.length;aL<aV;aT=++aL){aN=aO[aT];aN=aN.unwrapAll();if(!(aN instanceof P)){continue}aX=(aM=aN.variable)!=null?aM.unwrapAll():void 0;if(!((aX instanceof B)||(aX instanceof u&&((aK=aX.base)!=null?aK.unwrapAll():void 0) instanceof B&&aX.properties.length===1&&((aJ=(aI=aX.properties[0].name)!=null?aI.value:void 0)==="call"||aJ==="apply")))){continue}aR=((aG=aX.base)!=null?aG.unwrapAll():void 0)||aX;aQ=new ae(aU.scope.freeVariable("fn"));aP=new u(aQ);if(aX.base){aW=[aP,aX],aX.base=aW[0],aP=aW[1]}aS.expressions[aT]=new P(aP,aN.args);aH=aH.concat(this.makeCode(this.tab),new av(aQ,aR).compileToFragments(aU,H),this.makeCode(";\n"))}return aH};return aE})(ay);y.Switch=aB=(function(aF){c(aE,aF);function aE(aH,aI,aG){this.subject=aH;this.cases=aI;this.otherwise=aG}aE.prototype.children=["subject","cases","otherwise"];aE.prototype.isStatement=K;aE.prototype.jumps=function(aG){var aK,aM,aN,aL,aO,aJ,aI,aH;if(aG==null){aG={block:true}}aJ=this.cases;for(aL=0,aO=aJ.length;aL<aO;aL++){aI=aJ[aL],aM=aI[0],aK=aI[1];if(aN=aK.jumps(aG)){return aN}}return(aH=this.otherwise)!=null?aH.jumps(aG):void 0};aE.prototype.makeReturn=function(aH){var aK,aI,aG,aL,aJ;aL=this.cases;for(aI=0,aG=aL.length;aI<aG;aI++){aK=aL[aI];aK[1].makeReturn(aH)}if(aH){this.otherwise||(this.otherwise=new k([new ae("void 0")]))}if((aJ=this.otherwise)!=null){aJ.makeReturn(aH)}return this};aE.prototype.compileNode=function(aH){var aM,aP,aQ,aT,aV,aR,aO,aW,aU,aN,aL,aS,aG,aK,aJ,aI;aW=aH.indent+z;aU=aH.indent=aW+z;aR=[].concat(this.makeCode(this.tab+"switch ("),(this.subject?this.subject.compileToFragments(aH,ab):this.makeCode("false")),this.makeCode(") {\n"));aK=this.cases;for(aO=aN=0,aS=aK.length;aN<aS;aO=++aN){aJ=aK[aO],aT=aJ[0],aM=aJ[1];aI=ai([aT]);for(aL=0,aG=aI.length;aL<aG;aL++){aQ=aI[aL];if(!this.subject){aQ=aQ.invert()}aR=aR.concat(this.makeCode(aW+"case "),aQ.compileToFragments(aH,ab),this.makeCode(":\n"))}if((aP=aM.compileToFragments(aH,H)).length>0){aR=aR.concat(aP,this.makeCode("\n"))}if(aO===this.cases.length-1&&!this.otherwise){break}aV=this.lastNonComment(aM.expressions);if(aV instanceof a||(aV instanceof ae&&aV.jumps()&&aV.value!=="debugger")){continue}aR.push(aQ.makeCode(aU+"break;\n"))}if(this.otherwise&&this.otherwise.expressions.length){aR.push.apply(aR,[this.makeCode(aW+"default:\n")].concat(g.call(this.otherwise.compileToFragments(aH,H)),[this.makeCode("\n")]))}aR.push(this.makeCode(this.tab+"}"));return aR};return aE})(A);y.If=R=(function(aE){c(aF,aE);function aF(aI,aG,aH){this.body=aG;if(aH==null){aH={}}this.condition=aH.type==="unless"?aI.invert():aI;this.elseBody=null;this.isChain=false;this.soak=aH.soak}aF.prototype.children=["condition","body","elseBody"];aF.prototype.bodyNode=function(){var aG;return(aG=this.body)!=null?aG.unwrap():void 0};aF.prototype.elseBodyNode=function(){var aG;return(aG=this.elseBody)!=null?aG.unwrap():void 0};aF.prototype.addElse=function(aG){if(this.isChain){this.elseBodyNode().addElse(aG)}else{this.isChain=aG instanceof aF;this.elseBody=this.ensureBlock(aG);this.elseBody.updateLocationDataIfMissing(aG.locationData)}return this};aF.prototype.isStatement=function(aG){var aH;return(aG!=null?aG.level:void 0)===H||this.bodyNode().isStatement(aG)||((aH=this.elseBodyNode())!=null?aH.isStatement(aG):void 0)};aF.prototype.jumps=function(aG){var aH;return this.body.jumps(aG)||((aH=this.elseBody)!=null?aH.jumps(aG):void 0)};aF.prototype.compileNode=function(aG){if(this.isStatement(aG)){return this.compileStatement(aG)}else{return this.compileExpression(aG)}};aF.prototype.makeReturn=function(aG){if(aG){this.elseBody||(this.elseBody=new k([new ae("void 0")]))}this.body&&(this.body=new k([this.body.makeReturn(aG)]));this.elseBody&&(this.elseBody=new k([this.elseBody.makeReturn(aG)]));return this};aF.prototype.ensureBlock=function(aG){if(aG instanceof k){return aG}else{return new k([aG])}};aF.prototype.compileStatement=function(aM){var aK,aH,aN,aJ,aL,aI,aG;aN=aq(aM,"chainChild");aL=aq(aM,"isExistentialEquals");if(aL){return new aF(this.condition.invert(),this.elseBodyNode(),{type:"if"}).compileToFragments(aM)}aG=aM.indent+z;aJ=this.condition.compileToFragments(aM,ab);aH=this.ensureBlock(this.body).compileToFragments(l(aM,{indent:aG}));aI=[].concat(this.makeCode("if ("),aJ,this.makeCode(") {\n"),aH,this.makeCode("\n"+this.tab+"}"));if(!aN){aI.unshift(this.makeCode(this.tab))}if(!this.elseBody){return aI}aK=aI.concat(this.makeCode(" else "));if(this.isChain){aM.chainChild=true;aK=aK.concat(this.elseBody.unwrap().compileToFragments(aM,H))}else{aK=aK.concat(this.makeCode("{\n"),this.elseBody.compileToFragments(l(aM,{indent:aG}),H),this.makeCode("\n"+this.tab+"}"))}return aK};aF.prototype.compileExpression=function(aK){var aJ,aH,aI,aG;aI=this.condition.compileToFragments(aK,I);aH=this.bodyNode().compileToFragments(aK,e);aJ=this.elseBodyNode()?this.elseBodyNode().compileToFragments(aK,e):[this.makeCode("void 0")];aG=aI.concat(this.makeCode(" ? "),aH,this.makeCode(" : "),aJ);if(aK.level>=I){return this.wrapInBraces(aG)}else{return aG}};aF.prototype.unfoldSoak=function(){return this.soak&&this};return aF})(A);x={"extends":function(){return"function(child, parent) { for (var key in parent) { if ("+(F("hasProp"))+".call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; }"},bind:function(){return"function(fn, me){ return function(){ return fn.apply(me, arguments); }; }"},indexOf:function(){return"[].indexOf || function(item) { for (var i = 0, l = this.length; i < l; i++) { if (i in this && this[i] === item) return i; } return -1; }"},hasProp:function(){return"{}.hasOwnProperty"},slice:function(){return"[].slice"}};H=1;ab=2;e=3;I=4;q=5;aC=6;z="  ";ao="[$A-Za-z_\\x7f-\\uffff][$\\w\\x7f-\\uffff]*";b=RegExp("^"+ao+"$");E=/^[+-]?\d+$/;aw=/^[+-]?0x[\da-f]+/i;w=/^[+-]?(?:0x[\da-f]+|\d*\.?\d+(?:e[+-]?\d+)?)$/i;ag=RegExp("^("+ao+")(\\.prototype)?(?:\\.("+ao+")|\\[(\"(?:[^\\\\\"\\r\\n]|\\\\.)*\"|'(?:[^\\\\'\\r\\n]|\\\\.)*')\\]|\\[(0x[\\da-fA-F]+|\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\])$");at=/^['"]/;M=/^\//;F=function(aE){var aF;aF="__"+aE;af.root.assign(aF,x[aE]());return aF};aa=function(aF,aE){aF=aF.replace(/\n/g,"$&"+aE);return aF.replace(/\s+$/,"")};ad=function(aE){if(aE==null){return 0}else{if(aE.match(aw)){return parseInt(aE,16)}else{return parseFloat(aE)}}};Z=function(aE){return aE instanceof ae&&aE.value==="arguments"&&!aE.asKey};W=function(aE){return(aE instanceof ae&&aE.value==="this"&&!aE.asKey)||(aE instanceof B&&aE.bound)||(aE instanceof P&&aE.isSuper)};U=function(aH,aG,aF){var aE;if(!(aE=aG[aF].unfoldSoak(aH))){return}aG[aF]=aE.body;aE.body=new u(aG);return aE}});