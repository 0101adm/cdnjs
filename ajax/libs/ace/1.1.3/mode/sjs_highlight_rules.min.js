define(function(c,b,d){var f=c("../lib/oop");var e=c("./javascript_highlight_rules").JavaScriptHighlightRules;var a=c("./text_highlight_rules").TextHighlightRules;var g=function(){var o=new e();var j="\\\\(?:x[0-9a-fA-F]{2}|u[0-9a-fA-F]{4}|[0-2][0-7]{0,2}|3[0-6][0-7]?|37[0-7]?|[4-7][0-7]?|.)";var p=function(i){i.isContextAware=true;return i};var q=function(i){return{token:i.token,regex:i.regex,next:p(function(s,r){if(r.length===0){r.unshift(s)}r.unshift(i.next);return i.next}),}};var l=function(i){return{token:i.token,regex:i.regex,next:p(function(s,r){r.shift();return r[0]||"start"}),}};this.$rules=o.$rules;this.$rules.no_regex=[{token:"keyword",regex:"(waitfor|or|and|collapse|spawn|retract)\\b"},{token:"keyword.operator",regex:"(->|=>|\\.\\.)"},{token:"variable.language",regex:"(hold|default)\\b"},q({token:"string",regex:"`",next:"bstring"}),q({token:"string",regex:'"',next:"qqstring"}),q({token:"string",regex:'"',next:"qqstring"}),{token:["paren.lparen","text","paren.rparen"],regex:"(\\{)(\\s*)(\\|)",next:"block_arguments",}].concat(this.$rules.no_regex);this.$rules.block_arguments=[{token:"paren.rparen",regex:"\\|",next:"no_regex",}].concat(this.$rules.function_arguments);this.$rules.bstring=[{token:"constant.language.escape",regex:j},{token:"string",regex:"\\\\$",next:"bstring"},q({token:"paren.lparen",regex:"\\$\\{",next:"string_interp"}),q({token:"paren.lparen",regex:"\\$",next:"bstring_interp_single"}),l({token:"string",regex:"`",}),{defaultToken:"string"}];this.$rules.qqstring=[{token:"constant.language.escape",regex:j},{token:"string",regex:"\\\\$",next:"qqstring",},q({token:"paren.lparen",regex:"#\\{",next:"string_interp"}),l({token:"string",regex:'"',}),{defaultToken:"string"}];var h=[];for(var m=0;m<this.$rules.no_regex.length;m++){var n=this.$rules.no_regex[m];var k=String(n.token);if(k.indexOf("paren")==-1&&(!n.next||n.next.isContextAware)){h.push(n)}}this.$rules.string_interp=[l({token:"paren.rparen",regex:"\\}"}),q({token:"paren.lparen",regex:"{",next:"string_interp"})].concat(h);this.$rules.bstring_interp_single=[{token:["identifier","paren.lparen"],regex:"(\\w+)(\\()",next:"bstring_interp_single_call"},l({token:"identifier",regex:"\\w*",})];this.$rules.bstring_interp_single_call=[q({token:"paren.lparen",regex:"\\(",next:"bstring_interp_single_call"}),l({token:"paren.rparen",regex:"\\)"})].concat(h)};f.inherits(g,a);b.SJSHighlightRules=g});