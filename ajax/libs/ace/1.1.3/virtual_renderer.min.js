define(function(e,g,b){var k=e("./lib/oop");var f=e("./lib/dom");var d=e("./config");var p=e("./layer/gutter").Gutter;var n=e("./layer/marker").Marker;var c=e("./layer/text").Text;var o=e("./layer/cursor").Cursor;var l=e("./scrollbar").HScrollBar;var i=e("./scrollbar").VScrollBar;var m=e("./renderloop").RenderLoop;var h=e("./layer/font_metrics").FontMetrics;var q=e("./lib/event_emitter").EventEmitter;var j=e("./requirejs/text!./css/editor.css");f.importCssString(j,"ace_editor");var a=function(s,u){var r=this;this.container=s||f.createElement("div");this.$keepTextAreaAtCursor=true;f.addCssClass(this.container,"ace_editor");this.setTheme(u);this.$gutter=f.createElement("div");this.$gutter.className="ace_gutter";this.container.appendChild(this.$gutter);this.scroller=f.createElement("div");this.scroller.className="ace_scroller";this.container.appendChild(this.scroller);this.content=f.createElement("div");this.content.className="ace_content";this.scroller.appendChild(this.content);this.$gutterLayer=new p(this.$gutter);this.$gutterLayer.on("changeGutterWidth",this.onGutterResize.bind(this));this.$markerBack=new n(this.content);var t=this.$textLayer=new c(this.content);this.canvas=t.element;this.$markerFront=new n(this.content);this.$cursorLayer=new o(this.content);this.$horizScroll=false;this.$vScroll=false;this.scrollBar=this.scrollBarV=new i(this.container,this);this.scrollBarH=new l(this.container,this);this.scrollBarV.addEventListener("scroll",function(v){if(!r.$scrollAnimation){r.session.setScrollTop(v.data-r.scrollMargin.top)}});this.scrollBarH.addEventListener("scroll",function(v){if(!r.$scrollAnimation){r.session.setScrollLeft(v.data-r.scrollMargin.left)}});this.scrollTop=0;this.scrollLeft=0;this.cursorPos={row:0,column:0};this.$fontMetrics=new h(this.container,500);this.$textLayer.$setFontMetrics(this.$fontMetrics);this.$textLayer.addEventListener("changeCharacterSize",function(v){r.updateCharacterSize();r.onResize(true,r.gutterWidth,r.$size.width,r.$size.height);r._signal("changeCharacterSize",v)});this.$size={width:0,height:0,scrollerHeight:0,scrollerWidth:0,$dirty:true};this.layerConfig={width:1,padding:0,firstRow:0,firstRowScreen:0,lastRow:0,lineHeight:0,characterWidth:0,minHeight:1,maxHeight:1,offset:0,height:1,gutterOffset:1};this.scrollMargin={left:0,right:0,top:0,bottom:0,v:0,h:0};this.$loop=new m(this.$renderChanges.bind(this),this.container.ownerDocument.defaultView);this.$loop.schedule(this.CHANGE_FULL);this.updateCharacterSize();this.setPadding(4);d.resetOptions(this);d._emit("renderer",this)};(function(){this.CHANGE_CURSOR=1;this.CHANGE_MARKER=2;this.CHANGE_GUTTER=4;this.CHANGE_SCROLL=8;this.CHANGE_LINES=16;this.CHANGE_TEXT=32;this.CHANGE_SIZE=64;this.CHANGE_MARKER_BACK=128;this.CHANGE_MARKER_FRONT=256;this.CHANGE_FULL=512;this.CHANGE_H_SCROLL=1024;k.implement(this,q);this.updateCharacterSize=function(){if(this.$textLayer.allowBoldFonts!=this.$allowBoldFonts){this.$allowBoldFonts=this.$textLayer.allowBoldFonts;this.setStyle("ace_nobold",!this.$allowBoldFonts)}this.layerConfig.characterWidth=this.characterWidth=this.$textLayer.getCharacterWidth();this.layerConfig.lineHeight=this.lineHeight=this.$textLayer.getLineHeight();this.$updatePrintMargin()};this.setSession=function(r){if(this.session){this.session.doc.off("changeNewLineMode",this.onChangeNewLineMode)}this.session=r;if(!r){return}if(this.scrollMargin.top&&r.getScrollTop()<=0){r.setScrollTop(-this.scrollMargin.top)}this.$cursorLayer.setSession(r);this.$markerBack.setSession(r);this.$markerFront.setSession(r);this.$gutterLayer.setSession(r);this.$textLayer.setSession(r);this.$loop.schedule(this.CHANGE_FULL);this.session.$setFontMetrics(this.$fontMetrics);this.onChangeNewLineMode=this.onChangeNewLineMode.bind(this);this.onChangeNewLineMode();this.session.doc.on("changeNewLineMode",this.onChangeNewLineMode)};this.updateLines=function(s,r){if(r===undefined){r=Infinity}if(!this.$changedLines){this.$changedLines={firstRow:s,lastRow:r}}else{if(this.$changedLines.firstRow>s){this.$changedLines.firstRow=s}if(this.$changedLines.lastRow<r){this.$changedLines.lastRow=r}}if(this.$changedLines.firstRow>this.layerConfig.lastRow||this.$changedLines.lastRow<this.layerConfig.firstRow){return}this.$loop.schedule(this.CHANGE_LINES)};this.onChangeNewLineMode=function(){this.$loop.schedule(this.CHANGE_TEXT);this.$textLayer.$updateEolChar()};this.onChangeTabSize=function(){this.$loop.schedule(this.CHANGE_TEXT|this.CHANGE_MARKER);this.$textLayer.onChangeTabSize()};this.updateText=function(){this.$loop.schedule(this.CHANGE_TEXT)};this.updateFull=function(r){if(r){this.$renderChanges(this.CHANGE_FULL,true)}else{this.$loop.schedule(this.CHANGE_FULL)}};this.updateFontSize=function(){this.$textLayer.checkForSizeChanges()};this.$changes=0;this.$updateSizeAsync=function(){if(this.$loop.pending){this.$size.$dirty=true}else{this.onResize()}};this.onResize=function(w,s,v,r){if(this.resizing>2){return}else{if(this.resizing>0){this.resizing++}else{this.resizing=w?1:0}}var u=this.container;if(!r){r=u.clientHeight||u.scrollHeight}if(!v){v=u.clientWidth||u.scrollWidth}var t=this.$updateCachedSize(w,s,v,r);if(!this.$size.scrollerHeight||(!v&&!r)){return this.resizing=0}if(w){this.$gutterLayer.$padding=null}if(w){this.$renderChanges(t|this.$changes,true)}else{this.$loop.schedule(t|this.$changes)}if(this.resizing){this.resizing=0}};this.$updateCachedSize=function(x,t,v,r){r-=(this.$extraHeight||0);var u=0;var s=this.$size;var w={width:s.width,height:s.height,scrollerHeight:s.scrollerHeight,scrollerWidth:s.scrollerWidth};if(r&&(x||s.height!=r)){s.height=r;u|=this.CHANGE_SIZE;s.scrollerHeight=s.height;if(this.$horizScroll){s.scrollerHeight-=this.scrollBarH.getHeight()}this.scrollBarV.element.style.bottom=this.scrollBarH.getHeight()+"px";u=u|this.CHANGE_SCROLL}if(v&&(x||s.width!=v)){u|=this.CHANGE_SIZE;s.width=v;if(t==null){t=this.$showGutter?this.$gutter.offsetWidth:0}this.gutterWidth=t;this.scrollBarH.element.style.left=this.scroller.style.left=t+"px";s.scrollerWidth=Math.max(0,v-t-this.scrollBarV.getWidth());this.scrollBarH.element.style.right=this.scroller.style.right=this.scrollBarV.getWidth()+"px";this.scroller.style.bottom=this.scrollBarH.getHeight()+"px";if(this.session&&this.session.getUseWrapMode()&&this.adjustWrapLimit()||x){u|=this.CHANGE_FULL}}s.$dirty=!v||!r;if(u){this._signal("resize",w)}return u};this.onGutterResize=function(){var r=this.$showGutter?this.$gutter.offsetWidth:0;if(r!=this.gutterWidth){this.$changes|=this.$updateCachedSize(true,r,this.$size.width,this.$size.height)}if(this.session.getUseWrapMode()&&this.adjustWrapLimit()){this.$loop.schedule(this.CHANGE_FULL)}else{if(this.$size.$dirty){this.$loop.schedule(this.CHANGE_FULL)}else{this.$computeLayerConfig();this.$loop.schedule(this.CHANGE_MARKER)}}};this.adjustWrapLimit=function(){var s=this.$size.scrollerWidth-this.$padding*2;var r=Math.floor(s/this.characterWidth);return this.session.adjustWrapLimit(r,this.$showPrintMargin&&this.$printMarginColumn)};this.setAnimatedScroll=function(r){this.setOption("animatedScroll",r)};this.getAnimatedScroll=function(){return this.$animatedScroll};this.setShowInvisibles=function(r){this.setOption("showInvisibles",r)};this.getShowInvisibles=function(){return this.getOption("showInvisibles")};this.getDisplayIndentGuides=function(){return this.getOption("displayIndentGuides")};this.setDisplayIndentGuides=function(r){this.setOption("displayIndentGuides",r)};this.setShowPrintMargin=function(r){this.setOption("showPrintMargin",r)};this.getShowPrintMargin=function(){return this.getOption("showPrintMargin")};this.setPrintMarginColumn=function(r){this.setOption("printMarginColumn",r)};this.getPrintMarginColumn=function(){return this.getOption("printMarginColumn")};this.getShowGutter=function(){return this.getOption("showGutter")};this.setShowGutter=function(r){return this.setOption("showGutter",r)};this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")};this.setFadeFoldWidgets=function(r){this.setOption("fadeFoldWidgets",r)};this.setHighlightGutterLine=function(r){this.setOption("highlightGutterLine",r)};this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")};this.$updateGutterLineHighlight=function(){var t=this.$cursorLayer.$pixelPos;var r=this.layerConfig.lineHeight;if(this.session.getUseWrapMode()){var s=this.session.selection.getCursor();s.column=0;t=this.$cursorLayer.getPixelPosition(s,true);r*=this.session.getRowLength(s.row)}this.$gutterLineHighlight.style.top=t.top-this.layerConfig.offset+"px";this.$gutterLineHighlight.style.height=r+"px"};this.$updatePrintMargin=function(){if(!this.$showPrintMargin&&!this.$printMarginEl){return}if(!this.$printMarginEl){var s=f.createElement("div");s.className="ace_layer ace_print-margin-layer";this.$printMarginEl=f.createElement("div");this.$printMarginEl.className="ace_print-margin";s.appendChild(this.$printMarginEl);this.content.insertBefore(s,this.content.firstChild)}var r=this.$printMarginEl.style;r.left=((this.characterWidth*this.$printMarginColumn)+this.$padding)+"px";r.visibility=this.$showPrintMargin?"visible":"hidden";if(this.session&&this.session.$wrap==-1){this.adjustWrapLimit()}};this.getContainerElement=function(){return this.container};this.getMouseEventTarget=function(){return this.content};this.getTextAreaContainer=function(){return this.container};this.$moveTextAreaToCursor=function(){if(!this.$keepTextAreaAtCursor){return}var t=this.layerConfig;var v=this.$cursorLayer.$pixelPos.top;var r=this.$cursorLayer.$pixelPos.left;v-=t.offset;var u=this.lineHeight;if(v<0||v>t.height-u){return}var s=this.characterWidth;if(this.$composition){var x=this.textarea.value.replace(/^\x01+/,"");s*=(this.session.$getStringScreenWidth(x)[0]+2);u+=2;v-=1}r-=this.scrollLeft;if(r>this.$size.scrollerWidth-s){r=this.$size.scrollerWidth-s}r-=this.scrollBar.width;this.textarea.style.height=u+"px";this.textarea.style.width=s+"px";this.textarea.style.right=Math.max(0,this.$size.scrollerWidth-r-s)+"px";this.textarea.style.bottom=Math.max(0,this.$size.height-v-u)+"px"};this.getFirstVisibleRow=function(){return this.layerConfig.firstRow};this.getFirstFullyVisibleRow=function(){return this.layerConfig.firstRow+(this.layerConfig.offset===0?0:1)};this.getLastFullyVisibleRow=function(){var r=Math.floor((this.layerConfig.height+this.layerConfig.offset)/this.layerConfig.lineHeight);return this.layerConfig.firstRow-1+r};this.getLastVisibleRow=function(){return this.layerConfig.lastRow};this.$padding=null;this.setPadding=function(r){this.$padding=r;this.$textLayer.setPadding(r);this.$cursorLayer.setPadding(r);this.$markerFront.setPadding(r);this.$markerBack.setPadding(r);this.$loop.schedule(this.CHANGE_FULL);this.$updatePrintMargin()};this.setScrollMargin=function(u,r,t,s){var v=this.scrollMargin;v.top=u|0;v.bottom=r|0;v.right=s|0;v.left=t|0;v.v=v.top+v.bottom;v.h=v.left+v.right;if(v.top&&this.scrollTop<=0&&this.session){this.session.setScrollTop(-v.top)}this.updateFull()};this.getHScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible};this.setHScrollBarAlwaysVisible=function(r){this.setOption("hScrollBarAlwaysVisible",r)};this.getVScrollBarAlwaysVisible=function(){return this.$hScrollBarAlwaysVisible};this.setVScrollBarAlwaysVisible=function(r){this.setOption("vScrollBarAlwaysVisible",r)};this.$updateScrollBarV=function(){this.scrollBarV.setScrollHeight(this.layerConfig.maxHeight+this.scrollMargin.v);this.scrollBarV.setScrollTop(this.scrollTop+this.scrollMargin.top)};this.$updateScrollBarH=function(){this.scrollBarH.setScrollWidth(this.layerConfig.width+2*this.$padding+this.scrollMargin.h);this.scrollBarH.setScrollLeft(this.scrollLeft+this.scrollMargin.left)};this.$frozen=false;this.freeze=function(){this.$frozen=true};this.unfreeze=function(){this.$frozen=false};this.$renderChanges=function(s,t){if(this.$changes){s|=this.$changes;this.$changes=0}if((!this.session||!this.container.offsetWidth||this.$frozen)||(!s&&!t)){this.$changes|=s;return}if(this.$size.$dirty){this.$changes|=s;return this.onResize(true)}if(!this.lineHeight){this.$textLayer.checkForSizeChanges()}this._signal("beforeRender");var r=this.layerConfig;if(s&this.CHANGE_FULL||s&this.CHANGE_SIZE||s&this.CHANGE_TEXT||s&this.CHANGE_LINES||s&this.CHANGE_SCROLL||s&this.CHANGE_H_SCROLL){s|=this.$computeLayerConfig();r=this.layerConfig;this.$updateScrollBarV();if(s&this.CHANGE_H_SCROLL){this.$updateScrollBarH()}this.$gutterLayer.element.style.marginTop=(-r.offset)+"px";this.content.style.marginTop=(-r.offset)+"px";this.content.style.width=r.width+2*this.$padding+"px";this.content.style.height=r.minHeight+"px"}if(s&this.CHANGE_H_SCROLL){this.content.style.marginLeft=-this.scrollLeft+"px";this.scroller.className=this.scrollLeft<=0?"ace_scroller":"ace_scroller ace_scroll-left"}if(s&this.CHANGE_FULL){this.$textLayer.update(r);if(this.$showGutter){this.$gutterLayer.update(r)}this.$markerBack.update(r);this.$markerFront.update(r);this.$cursorLayer.update(r);this.$moveTextAreaToCursor();this.$highlightGutterLine&&this.$updateGutterLineHighlight();this._signal("afterRender");return}if(s&this.CHANGE_SCROLL){if(s&this.CHANGE_TEXT||s&this.CHANGE_LINES){this.$textLayer.update(r)}else{this.$textLayer.scrollLines(r)}if(this.$showGutter){this.$gutterLayer.update(r)}this.$markerBack.update(r);this.$markerFront.update(r);this.$cursorLayer.update(r);this.$highlightGutterLine&&this.$updateGutterLineHighlight();this.$moveTextAreaToCursor();this._signal("afterRender");return}if(s&this.CHANGE_TEXT){this.$textLayer.update(r);if(this.$showGutter){this.$gutterLayer.update(r)}}else{if(s&this.CHANGE_LINES){if(this.$updateLines()||(s&this.CHANGE_GUTTER)&&this.$showGutter){this.$gutterLayer.update(r)}}else{if(s&this.CHANGE_TEXT||s&this.CHANGE_GUTTER){if(this.$showGutter){this.$gutterLayer.update(r)}}}}if(s&this.CHANGE_CURSOR){this.$cursorLayer.update(r);this.$moveTextAreaToCursor();this.$highlightGutterLine&&this.$updateGutterLineHighlight()}if(s&(this.CHANGE_MARKER|this.CHANGE_MARKER_FRONT)){this.$markerFront.update(r)}if(s&(this.CHANGE_MARKER|this.CHANGE_MARKER_BACK)){this.$markerBack.update(r)}this._signal("afterRender")};this.$autosize=function(){var r=this.session.getScreenLength()*this.lineHeight;var v=this.$maxLines*this.lineHeight;var u=Math.max((this.$minLines||1)*this.lineHeight,Math.min(v,r))+this.scrollMargin.v+(this.$extraHeight||0);var t=r>v;if(u!=this.desiredHeight||this.$size.height!=this.desiredHeight||t!=this.$vScroll){if(t!=this.$vScroll){this.$vScroll=t;this.scrollBarV.setVisible(t)}var s=this.container.clientWidth;this.container.style.height=u+"px";this.$updateCachedSize(true,this.$gutterWidth,s,u);this.desiredHeight=u}};this.$computeLayerConfig=function(){if(this.$maxLines&&this.lineHeight>1){this.$autosize()}var s=this.session;var B=this.$size;var G=B.height<=2*this.lineHeight;var t=this.session.getScreenLength();var D=t*this.lineHeight;var v=this.scrollTop%this.lineHeight;var x=B.scrollerHeight+this.lineHeight;var I=this.$getLongestLine();var w=!G&&(this.$hScrollBarAlwaysVisible||B.scrollerWidth-I-2*this.$padding<0);var J=this.$horizScroll!==w;if(J){this.$horizScroll=w;this.scrollBarH.setVisible(w)}if(!this.$maxLines&&this.$scrollPastEnd){if(this.scrollTop>D-B.scrollerHeight){D+=Math.min((B.scrollerHeight-this.lineHeight)*this.$scrollPastEnd,this.scrollTop-D+B.scrollerHeight)}}var y=!G&&(this.$vScrollBarAlwaysVisible||B.scrollerHeight-D<0);var z=this.$vScroll!==y;if(z){this.$vScroll=y;this.scrollBarV.setVisible(y)}this.session.setScrollTop(Math.max(-this.scrollMargin.top,Math.min(this.scrollTop,D-B.scrollerHeight+this.scrollMargin.bottom)));this.session.setScrollLeft(Math.max(-this.scrollMargin.left,Math.min(this.scrollLeft,I+2*this.$padding-B.scrollerWidth+this.scrollMargin.right)));var E=Math.ceil(x/this.lineHeight)-1;var r=Math.max(0,Math.round((this.scrollTop-v)/this.lineHeight));var F=r+E;var A,C;var u=this.lineHeight;r=s.screenToDocumentRow(r,0);var H=s.getFoldLine(r);if(H){r=H.start.row}A=s.documentToScreenRow(r,0);C=s.getRowLength(r)*u;F=Math.min(s.screenToDocumentRow(F,0),s.getLength()-1);x=B.scrollerHeight+s.getRowLength(F)*u+C;v=this.scrollTop-A*u;var K=0;if(this.layerConfig.width!=I){K=this.CHANGE_H_SCROLL}if(J||z){K=this.$updateCachedSize(true,this.gutterWidth,B.width,B.height);this._signal("scrollbarVisibilityChanged");if(z){I=this.$getLongestLine()}}this.layerConfig={width:I,padding:this.$padding,firstRow:r,firstRowScreen:A,lastRow:F,lineHeight:u,characterWidth:this.characterWidth,minHeight:x,maxHeight:D,offset:v,gutterOffset:Math.max(0,Math.ceil((v+B.height-B.scrollerHeight)/u)),height:this.$size.scrollerHeight};return K};this.$updateLines=function(){var t=this.$changedLines.firstRow;var s=this.$changedLines.lastRow;this.$changedLines=null;var r=this.layerConfig;if(t>r.lastRow+1){return}if(s<r.firstRow){return}if(s===Infinity){if(this.$showGutter){this.$gutterLayer.update(r)}this.$textLayer.update(r);return}this.$textLayer.updateLines(r,t,s);return true};this.$getLongestLine=function(){var r=this.session.getScreenWidth();if(this.showInvisibles&&!this.session.$useWrapMode){r+=1}return Math.max(this.$size.scrollerWidth-2*this.$padding,Math.round(r*this.characterWidth))};this.updateFrontMarkers=function(){this.$markerFront.setMarkers(this.session.getMarkers(true));this.$loop.schedule(this.CHANGE_MARKER_FRONT)};this.updateBackMarkers=function(){this.$markerBack.setMarkers(this.session.getMarkers());this.$loop.schedule(this.CHANGE_MARKER_BACK)};this.addGutterDecoration=function(s,r){this.$gutterLayer.addGutterDecoration(s,r)};this.removeGutterDecoration=function(s,r){this.$gutterLayer.removeGutterDecoration(s,r)};this.updateBreakpoints=function(r){this.$loop.schedule(this.CHANGE_GUTTER)};this.setAnnotations=function(r){this.$gutterLayer.setAnnotations(r);this.$loop.schedule(this.CHANGE_GUTTER)};this.updateCursor=function(){this.$loop.schedule(this.CHANGE_CURSOR)};this.hideCursor=function(){this.$cursorLayer.hideCursor()};this.showCursor=function(){this.$cursorLayer.showCursor()};this.scrollSelectionIntoView=function(s,r,t){this.scrollCursorIntoView(s,t);this.scrollCursorIntoView(r,t)};this.scrollCursorIntoView=function(A,w,v){if(this.$size.scrollerHeight===0){return}var y=this.$cursorLayer.getPixelPosition(A);var t=y.left;var z=y.top;var x=v&&v.top||0;var r=v&&v.bottom||0;var s=this.$scrollAnimation?this.session.getScrollTop():this.scrollTop;if(s+x>z){if(w){z-=w*this.$size.scrollerHeight}if(z===0){z=-this.scrollMargin.top}this.session.setScrollTop(z)}else{if(s+this.$size.scrollerHeight-r<z+this.lineHeight){if(w){z+=w*this.$size.scrollerHeight}this.session.setScrollTop(z+this.lineHeight-this.$size.scrollerHeight)}}var u=this.scrollLeft;if(u>t){if(t<this.$padding+2*this.layerConfig.characterWidth){t=-this.scrollMargin.left}this.session.setScrollLeft(t)}else{if(u+this.$size.scrollerWidth<t+this.characterWidth){this.session.setScrollLeft(Math.round(t+this.characterWidth-this.$size.scrollerWidth))}else{if(u<=this.$padding&&t-u<this.characterWidth){this.session.setScrollLeft(0)}}}};this.getScrollTop=function(){return this.session.getScrollTop()};this.getScrollLeft=function(){return this.session.getScrollLeft()};this.getScrollTopRow=function(){return this.scrollTop/this.lineHeight};this.getScrollBottomRow=function(){return Math.max(0,Math.floor((this.scrollTop+this.$size.scrollerHeight)/this.lineHeight)-1)};this.scrollToRow=function(r){this.session.setScrollTop(r*this.lineHeight)};this.alignCursor=function(t,v){if(typeof t=="number"){t={row:t,column:0}}var u=this.$cursorLayer.getPixelPosition(t);var r=this.$size.scrollerHeight-this.lineHeight;var s=u.top-r*(v||0);this.session.setScrollTop(s);return s};this.STEPS=8;this.$calcSteps=function(w,s){var u=0;var r=this.STEPS;var t=[];var v=function(y,z,x){return x*(Math.pow(y-1,3)+1)+z};for(u=0;u<r;++u){t.push(v(u/this.STEPS,w,s-w))}return t};this.scrollToLine=function(s,r,t,x){var w=this.$cursorLayer.getPixelPosition({row:s,column:0});var v=w.top;if(r){v-=this.$size.scrollerHeight/2}var u=this.scrollTop;this.session.setScrollTop(v);if(t!==false){this.animateScrolling(u,x)}};this.animateScrolling=function(v,w){var s=this.scrollTop;if(!this.$animatedScroll){return}var r=this;if(v==s){return}if(this.$scrollAnimation){var u=this.$scrollAnimation.steps;if(u.length){v=u[0];if(v==s){return}}}var t=r.$calcSteps(v,s);this.$scrollAnimation={from:v,to:s,steps:t};clearInterval(this.$timer);r.session.setScrollTop(t.shift());r.session.$scrollTop=s;this.$timer=setInterval(function(){if(t.length){r.session.setScrollTop(t.shift());r.session.$scrollTop=s}else{if(s!=null){r.session.$scrollTop=-1;r.session.setScrollTop(s);s=null}else{r.$timer=clearInterval(r.$timer);r.$scrollAnimation=null;w&&w()}}},10)};this.scrollToY=function(r){if(this.scrollTop!==r){this.$loop.schedule(this.CHANGE_SCROLL);this.scrollTop=r}};this.scrollToX=function(r){if(this.scrollLeft!==r){this.scrollLeft=r}this.$loop.schedule(this.CHANGE_H_SCROLL)};this.scrollTo=function(r,s){this.session.setScrollTop(s);this.session.setScrollLeft(s)};this.scrollBy=function(s,r){r&&this.session.setScrollTop(this.session.getScrollTop()+r);s&&this.session.setScrollLeft(this.session.getScrollLeft()+s)};this.isScrollableBy=function(s,r){if(r<0&&this.session.getScrollTop()>=1-this.scrollMargin.top){return true}if(r>0&&this.session.getScrollTop()+this.$size.scrollerHeight-this.layerConfig.maxHeight-(this.$size.scrollerHeight-this.lineHeight)*this.$scrollPastEnd<-1+this.scrollMargin.bottom){return true}if(s<0&&this.session.getScrollLeft()>=1-this.scrollMargin.left){return true}if(s>0&&this.session.getScrollLeft()+this.$size.scrollerWidth-this.layerConfig.width<-1+this.scrollMargin.right){return true}};this.pixelToScreenCoordinates=function(r,w){var t=this.scroller.getBoundingClientRect();var v=(r+this.scrollLeft-t.left-this.$padding)/this.characterWidth;var u=Math.floor((w+this.scrollTop-t.top)/this.lineHeight);var s=Math.round(v);return{row:u,column:s,side:v-s>0?1:-1}};this.screenToTextCoordinates=function(r,v){var t=this.scroller.getBoundingClientRect();var s=Math.round((r+this.scrollLeft-t.left-this.$padding)/this.characterWidth);var u=(v+this.scrollTop-t.top)/this.lineHeight;return this.session.screenToDocumentPosition(u,Math.max(s,0))};this.textToScreenCoordinates=function(u,t){var s=this.scroller.getBoundingClientRect();var w=this.session.documentToScreenPosition(u,t);var r=this.$padding+Math.round(w.column*this.characterWidth);var v=w.row*this.lineHeight;return{pageX:s.left+r-this.scrollLeft,pageY:s.top+v-this.scrollTop}};this.visualizeFocus=function(){f.addCssClass(this.container,"ace_focus")};this.visualizeBlur=function(){f.removeCssClass(this.container,"ace_focus")};this.showComposition=function(r){if(!this.$composition){this.$composition={keepTextAreaAtCursor:this.$keepTextAreaAtCursor,cssText:this.textarea.style.cssText}}this.$keepTextAreaAtCursor=true;f.addCssClass(this.textarea,"ace_composition");this.textarea.style.cssText="";this.$moveTextAreaToCursor()};this.setCompositionText=function(r){this.$moveTextAreaToCursor()};this.hideComposition=function(){if(!this.$composition){return}f.removeCssClass(this.textarea,"ace_composition");this.$keepTextAreaAtCursor=this.$composition.keepTextAreaAtCursor;this.textarea.style.cssText=this.$composition.cssText;this.$composition=null};this.setTheme=function(u,s){var r=this;this.$themeId=u;r._dispatchEvent("themeChange",{theme:u});if(!u||typeof u=="string"){var t=u||this.$options.theme.initialValue;d.loadModule(["theme",t],v)}else{v(u)}function v(w){if(r.$themeId!=u){return s&&s()}if(!w.cssClass){return}f.importCssString(w.cssText,w.cssClass,r.container.ownerDocument);if(r.theme){f.removeCssClass(r.container,r.theme.cssClass)}var x="padding" in w?w.padding:"padding" in (r.theme||{})?4:r.$padding;if(r.$padding&&x!=r.$padding){r.setPadding(x)}r.$theme=w.cssClass;r.theme=w;f.addCssClass(r.container,w.cssClass);f.setCssClass(r.container,"ace_dark",w.isDark);if(r.$size){r.$size.width=0;r.$updateSizeAsync()}r._dispatchEvent("themeLoaded",{theme:w});s&&s()}};this.getTheme=function(){return this.$themeId};this.setStyle=function(s,r){f.setCssClass(this.container,s,r!==false)};this.unsetStyle=function(r){f.removeCssClass(this.container,r)};this.setCursorStyle=function(r){if(this.content.style.cursor!=r){this.content.style.cursor=r}};this.setMouseCursor=function(r){this.content.style.cursor=r};this.destroy=function(){this.$textLayer.destroy();this.$cursorLayer.destroy()}}).call(a.prototype);d.defineOptions(a.prototype,"renderer",{animatedScroll:{initialValue:false},showInvisibles:{set:function(r){if(this.$textLayer.setShowInvisibles(r)){this.$loop.schedule(this.CHANGE_TEXT)}},initialValue:false},showPrintMargin:{set:function(){this.$updatePrintMargin()},initialValue:true},printMarginColumn:{set:function(){this.$updatePrintMargin()},initialValue:80},printMargin:{set:function(r){if(typeof r=="number"){this.$printMarginColumn=r}this.$showPrintMargin=!!r;this.$updatePrintMargin()},get:function(){return this.$showPrintMargin&&this.$printMarginColumn}},showGutter:{set:function(r){this.$gutter.style.display=r?"block":"none";this.$loop.schedule(this.CHANGE_FULL);this.onGutterResize()},initialValue:true},fadeFoldWidgets:{set:function(r){f.setCssClass(this.$gutter,"ace_fade-fold-widgets",r)},initialValue:false},showFoldWidgets:{set:function(r){this.$gutterLayer.setShowFoldWidgets(r)},initialValue:true},showLineNumbers:{set:function(r){this.$gutterLayer.setShowLineNumbers(r);this.$loop.schedule(this.CHANGE_GUTTER)},initialValue:true},displayIndentGuides:{set:function(r){if(this.$textLayer.setDisplayIndentGuides(r)){this.$loop.schedule(this.CHANGE_TEXT)}},initialValue:true},highlightGutterLine:{set:function(r){if(!this.$gutterLineHighlight){this.$gutterLineHighlight=f.createElement("div");this.$gutterLineHighlight.className="ace_gutter-active-line";this.$gutter.appendChild(this.$gutterLineHighlight);return}this.$gutterLineHighlight.style.display=r?"":"none";if(this.$cursorLayer.$pixelPos){this.$updateGutterLineHighlight()}},initialValue:false,value:true},hScrollBarAlwaysVisible:{set:function(r){if(!this.$hScrollBarAlwaysVisible||!this.$horizScroll){this.$loop.schedule(this.CHANGE_SCROLL)}},initialValue:false},vScrollBarAlwaysVisible:{set:function(r){if(!this.$vScrollBarAlwaysVisible||!this.$vScroll){this.$loop.schedule(this.CHANGE_SCROLL)}},initialValue:false},fontSize:{set:function(r){if(typeof r=="number"){r=r+"px"}this.container.style.fontSize=r;this.updateFontSize()},initialValue:12},fontFamily:{set:function(r){this.container.style.fontFamily=r;this.updateFontSize()}},maxLines:{set:function(r){this.updateFull()}},minLines:{set:function(r){this.updateFull()}},scrollPastEnd:{set:function(r){r=+r||0;if(this.$scrollPastEnd==r){return}this.$scrollPastEnd=r;this.$loop.schedule(this.CHANGE_SCROLL)},initialValue:0,handlesSet:true},fixedWidthGutter:{set:function(r){this.$gutterLayer.$fixedWidth=!!r;this.$loop.schedule(this.CHANGE_GUTTER)}},theme:{set:function(r){this.setTheme(r)},get:function(){return this.$themeId||this.theme},initialValue:"./theme/textmate",handlesSet:true}});g.VirtualRenderer=a});