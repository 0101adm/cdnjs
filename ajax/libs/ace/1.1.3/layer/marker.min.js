define(function(c,b,d){var e=c("../range").Range;var f=c("../lib/dom");var a=function(g){this.element=f.createElement("div");this.element.className="ace_layer ace_marker-layer";g.appendChild(this.element)};(function(){this.$padding=0;this.setPadding=function(g){this.$padding=g};this.setSession=function(g){this.session=g};this.setMarkers=function(g){this.markers=g};this.update=function(i){var i=i||this.config;if(!i){return}this.config=i;var k=[];for(var j in this.markers){var g=this.markers[j];if(!g.range){g.update(k,this,this.session,i);continue}var h=g.range.clipRows(i.firstRow,i.lastRow);if(h.isEmpty()){continue}h=h.toScreenRange(this.session);if(g.renderer){var m=this.$getTop(h.start.row,i);var l=this.$padding+h.start.column*i.characterWidth;g.renderer(k,h,l,m,i)}else{if(g.type=="fullLine"){this.drawFullLineMarker(k,h,g.clazz,i)}else{if(g.type=="screenLine"){this.drawScreenLineMarker(k,h,g.clazz,i)}else{if(h.isMultiLine()){if(g.type=="text"){this.drawTextMarker(k,h,g.clazz,i)}else{this.drawMultiLineMarker(k,h,g.clazz,i)}}else{this.drawSingleLineMarker(k,h,g.clazz+" ace_start",i)}}}}}this.element=f.setInnerHtml(this.element,k.join(""))};this.$getTop=function(h,g){return(h-g.firstRowScreen)*g.lineHeight};this.drawTextMarker=function(j,h,i,g,l){var m=h.start.row;var k=new e(m,h.start.column,m,this.session.getScreenLastRowColumn(m));this.drawSingleLineMarker(j,k,i+" ace_start",g,1,l);m=h.end.row;k=new e(m,0,m,h.end.column);this.drawSingleLineMarker(j,k,i,g,0,l);for(m=h.start.row+1;m<h.end.row;m++){k.start.row=m;k.end.row=m;k.end.column=this.session.getScreenLastRowColumn(m);this.drawSingleLineMarker(j,k,i,g,1,l)}};this.drawMultiLineMarker=function(i,l,m,j,g){var o=this.$padding;var p=j.lineHeight;var n=this.$getTop(l.start.row,j);var k=o+l.start.column*j.characterWidth;g=g||"";i.push("<div class='",m," ace_start' style='","height:",p,"px;","right:0;","top:",n,"px;","left:",k,"px;",g,"'></div>");n=this.$getTop(l.end.row,j);var h=l.end.column*j.characterWidth;i.push("<div class='",m,"' style='","height:",p,"px;","width:",h,"px;","top:",n,"px;","left:",o,"px;",g,"'></div>");p=(l.end.row-l.start.row-1)*j.lineHeight;if(p<0){return}n=this.$getTop(l.start.row+1,j);i.push("<div class='",m,"' style='","height:",p,"px;","right:0;","top:",n,"px;","left:",o,"px;",g,"'></div>")};this.drawSingleLineMarker=function(h,l,n,j,m,g){var p=j.lineHeight;var i=(l.end.column+(m||0)-l.start.column)*j.characterWidth;var o=this.$getTop(l.start.row,j);var k=this.$padding+l.start.column*j.characterWidth;h.push("<div class='",n,"' style='","height:",p,"px;","width:",i,"px;","top:",o,"px;","left:",k,"px;",g||"","'></div>")};this.drawFullLineMarker=function(k,h,j,i,m){var l=this.$getTop(h.start.row,i);var g=i.lineHeight;if(h.start.row!=h.end.row){g+=this.$getTop(h.end.row,i)-l}k.push("<div class='",j,"' style='","height:",g,"px;","top:",l,"px;","left:0;right:0;",m||"","'></div>")};this.drawScreenLineMarker=function(k,h,j,i,m){var l=this.$getTop(h.start.row,i);var g=i.lineHeight;k.push("<div class='",j,"' style='","height:",g,"px;","top:",l,"px;","left:0;right:0;",m||"","'></div>")}}).call(a.prototype);b.Marker=a});