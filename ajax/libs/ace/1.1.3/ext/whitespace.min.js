define(function(b,a,c){var d=b("../lib/lang");a.$detectIndentation=function(f,q){var v=[];var w=[];var o=0;var h=0;var r=Math.min(f.length,1000);for(var s=0;s<r;s++){var n=f[s];if(!/^\s*[^*+\-\s]/.test(n)){continue}var u=n.match(/^\t*/)[0].length;if(n[0]=="\t"){o++}var l=n.match(/^ */)[0].length;if(l&&n[l]!="\t"){var p=l-h;if(p>0&&!(h%p)&&!(l%p)){w[p]=(w[p]||0)+1}v[l]=(v[l]||0)+1}h=l;while(s<r&&n[n.length-1]=="\\"){n=f[s++]}}if(!v.length){return}function g(x){var z=0;for(var y=x;y<v.length;y+=x){z+=v[y]||0}return z}var m=w.reduce(function(x,i){return x+i},0);var j={score:0,length:0};var k=0;for(var s=1;s<12;s++){if(s==1){k=g(s);var t=1}else{var t=g(s)/k}if(w[s]){t+=w[s]/m}if(t>j.score){j={score:t,length:s}}}if(j.score&&j.score>1.4){var e=j.length}if(o>k+1){return{ch:"\t",length:e}}if(k+1>o){return{ch:" ",length:e}}};a.detectIndentation=function(g){var f=g.getLines(0,1000);var e=a.$detectIndentation(f)||{};if(e.ch){g.setUseSoftTabs(e.ch==" ")}if(e.length){g.setTabSize(e.length)}return e};a.trimTrailingSpace=function(k,f){var m=k.getDocument();var n=m.getAllLines();var g=f?-1:0;for(var h=0,e=n.length;h<e;h++){var o=n[h];var j=o.search(/\s+$/);if(j>g){m.removeInLine(h,j,o.length)}}};a.convertIndentation=function(f,r,x){var q=f.getTabString()[0];var m=f.getTabSize();if(!x){x=m}if(!r){r=q}var h=r=="\t"?r:d.stringRepeat(r,x);var y=f.doc;var e=y.getAllLines();var s={};var g={};for(var v=0,t=e.length;v<t;v++){var o=e[v];var n=o.match(/^\s*/)[0];if(n){var p=f.$getStringScreenWidth(n)[0];var j=Math.floor(p/m);var k=p%m;var u=s[j]||(s[j]=d.stringRepeat(h,j));u+=g[k]||(g[k]=d.stringRepeat(" ",k));if(u!=n){y.removeInLine(v,0,n.length);y.insertInLine({row:v,column:0},u)}}}f.setTabSize(x);f.setUseSoftTabs(r==" ")};a.$parseStringArg=function(g){var f={};if(/t/.test(g)){f.ch="\t"}else{if(/s/.test(g)){f.ch=" "}}var e=g.match(/\d+/);if(e){f.length=parseInt(e[0],10)}return f};a.$parseArg=function(e){if(!e){return{}}if(typeof e=="string"){return a.$parseStringArg(e)}if(typeof e.text=="string"){return a.$parseStringArg(e.text)}return e};a.commands=[{name:"detectIndentation",exec:function(e){a.detectIndentation(e.session)}},{name:"trimTrailingSpace",exec:function(e){a.trimTrailingSpace(e.session)}},{name:"convertIndentation",exec:function(g,f){var e=a.$parseArg(f);a.convertIndentation(g.session,e.ch,e.length)}},{name:"setIndentation",exec:function(g,f){var e=a.$parseArg(f);e.length&&g.session.setTabSize(e.length);e.ch&&g.session.setUseSoftTabs(e.ch==" ")}}]});