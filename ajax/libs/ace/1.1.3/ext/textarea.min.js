define(function(d,f,b){var a=d("../lib/event");var h=d("../lib/useragent");var j=d("../lib/net");var c=d("../ace");d("../theme/textmate");b.exports=f=c;var i=function(p,n,q){var o=p.style[q];if(!o){if(window.getComputedStyle){o=window.getComputedStyle(p,"").getPropertyValue(q)}else{o=p.currentStyle[q]}}if(!o||o=="auto"||o=="intrinsic"){o=n.style[q]}return o};function g(p,o){for(var n in o){p.style[n]=o[n]}}function m(r,p){if(r.type!="textarea"){throw new Error("Textarea required!")}var n=r.parentNode;var o=document.createElement("div");var s=function(){var v="position:relative;";["margin-top","margin-left","margin-right","margin-bottom"].forEach(function(w){v+=w+":"+i(r,o,w)+";"});var u=i(r,o,"width")||(r.clientWidth+"px");var t=i(r,o,"height")||(r.clientHeight+"px");v+="height:"+t+";width:"+u+";";v+="display:inline-block;";o.setAttribute("style",v)};a.addListener(window,"resize",s);s();n.insertBefore(o,r.nextSibling);while(n!==document){if(n.tagName.toUpperCase()==="FORM"){var q=n.onsubmit;n.onsubmit=function(t){r.value=p();if(q){q.call(this,t)}};break}n=n.parentNode}return o}f.transformTextarea=function(s,w){var u;var o=m(s,function(){return u.getValue()});s.style.display="none";o.style.background="white";var p=document.createElement("div");g(p,{top:"0px",left:"0px",right:"0px",bottom:"0px",border:"1px solid gray",position:"absolute"});o.appendChild(p);var q=document.createElement("div");g(q,{position:"absolute",right:"0px",bottom:"0px",background:"red",cursor:"nw-resize",borderStyle:"solid",borderWidth:"9px 8px 10px 9px",width:"2px",borderColor:"lightblue gray gray lightblue",zIndex:101});var v=document.createElement("div");var r={top:"0px",left:"20%",right:"0px",bottom:"0px",position:"absolute",padding:"5px",zIndex:100,color:"white",display:"none",overflow:"auto",fontSize:"14px",boxShadow:"-5px 2px 3px gray"};if(!h.isOldIE){r.backgroundColor="rgba(0, 0, 0, 0.6)"}else{r.backgroundColor="#333"}g(v,r);o.appendChild(v);var x={};var t=c.edit(p);u=t.getSession();u.setValue(s.value||s.innerHTML);t.focus();o.appendChild(q);l(t,p,v,c,x,w);e(v,q,t,x);var n="";a.addListener(q,"mousemove",function(B){var A=this.getBoundingClientRect();var z=B.clientX-A.left,C=B.clientY-A.top;if(z+C<(A.width+A.height)/2){this.style.cursor="pointer";n="toggle"}else{n="resize";this.style.cursor="nw-resize"}});a.addListener(q,"mousedown",function(B){if(n=="toggle"){t.setDisplaySettings();return}o.style.zIndex=100000;var A=o.getBoundingClientRect();var z=A.width+A.left-B.clientX;var y=A.height+A.top-B.clientY;a.capture(q,function(C){o.style.width=C.clientX-A.left+z+"px";o.style.height=C.clientY-A.top+y+"px";t.resize()},function(){})});return t};function k(n,o,p){j.loadScript(n,function(){d([o],p)})}function l(q,n,t,o,v,u){var s=q.getSession();var r=q.renderer;u=u||k;function p(w){return w==="true"||w==true}q.setDisplaySettings=function(x){if(x==null){x=t.style.display=="none"}if(x){t.style.display="block";t.hideButton.focus();q.on("focus",function w(){q.removeListener("focus",w);t.style.display="none"})}else{q.focus()}};q.$setOption=q.setOption;q.setOption=function(w,x){if(v[w]==x){return}switch(w){case"mode":if(x!="text"){u("mode-"+x+".js","ace/mode/"+x,function(){var y=d("../mode/"+x).Mode;s.setMode(new y())})}else{s.setMode(new (d("../mode/text").Mode))}break;case"theme":if(x!="textmate"){u("theme-"+x+".js","ace/theme/"+x,function(){q.setTheme("ace/theme/"+x)})}else{q.setTheme("ace/theme/textmate")}break;case"fontSize":n.style.fontSize=x;break;case"keybindings":switch(x){case"vim":q.setKeyboardHandler("ace/keyboard/vim");break;case"emacs":q.setKeyboardHandler("ace/keyboard/emacs");break;default:q.setKeyboardHandler(null)}break;case"softWrap":switch(x){case"off":s.setUseWrapMode(false);r.setPrintMarginColumn(80);break;case"40":s.setUseWrapMode(true);s.setWrapLimitRange(40,40);r.setPrintMarginColumn(40);break;case"80":s.setUseWrapMode(true);s.setWrapLimitRange(80,80);r.setPrintMarginColumn(80);break;case"free":s.setUseWrapMode(true);s.setWrapLimitRange(null,null);r.setPrintMarginColumn(80);break}break;default:q.$setOption(w,p(x))}v[w]=x};q.getOption=function(w){return v[w]};q.getOptions=function(){return v};q.setOptions(f.options);return q}function e(A,o,v,C){var n=null;var u={mode:"Mode:",gutter:"Display Gutter:",theme:"Theme:",fontSize:"Font Size:",softWrap:"Soft Wrap:",keybindings:"Keyboard",showPrintMargin:"Show Print Margin:",useSoftTabs:"Use Soft Tabs:",showInvisibles:"Show Invisibles"};var z={mode:{text:"Plain",javascript:"JavaScript",xml:"XML",html:"HTML",css:"CSS",scss:"SCSS",python:"Python",php:"PHP",java:"Java",ruby:"Ruby",c_cpp:"C/C++",coffee:"CoffeeScript",json:"json",perl:"Perl",clojure:"Clojure",ocaml:"OCaml",csharp:"C#",haxe:"haXe",svg:"SVG",textile:"Textile",groovy:"Groovy",liquid:"Liquid",Scala:"Scala"},theme:{clouds:"Clouds",clouds_midnight:"Clouds Midnight",cobalt:"Cobalt",crimson_editor:"Crimson Editor",dawn:"Dawn",eclipse:"Eclipse",idle_fingers:"Idle Fingers",kr_theme:"Kr Theme",merbivore:"Merbivore",merbivore_soft:"Merbivore Soft",mono_industrial:"Mono Industrial",monokai:"Monokai",pastel_on_dark:"Pastel On Dark",solarized_dark:"Solarized Dark",solarized_light:"Solarized Light",textmate:"Textmate",twilight:"Twilight",vibrant_ink:"Vibrant Ink"},gutter:n,fontSize:{"10px":"10px","11px":"11px","12px":"12px","14px":"14px","16px":"16px"},softWrap:{off:"Off",40:"40",80:"80",free:"Free"},keybindings:{ace:"ace",vim:"vim",emacs:"emacs"},showPrintMargin:n,useSoftTabs:n,showInvisibles:n};var B=[];B.push("<table><tr><th>Setting</th><th>Value</th></tr>");function p(D,F,H,E){if(!H){D.push("<input type='checkbox' title='",F,"' ",E=="true"?"checked='true'":"","'></input>");return}D.push("<select title='"+F+"'>");for(var G in H){D.push("<option value='"+G+"' ");if(E==G){D.push(" selected ")}D.push(">",H[G],"</option>")}D.push("</select>")}for(var t in C){B.push("<tr><td>",u[t],"</td>");B.push("<td>");p(B,t,z[t],C[t]);B.push("</td></tr>")}B.push("</table>");A.innerHTML=B.join("");var w=function(E){var D=E.currentTarget;v.setOption(D.title,D.value)};var y=function(E){var D=E.currentTarget;v.setOption(D.title,D.checked)};var x=A.getElementsByTagName("select");for(var r=0;r<x.length;r++){x[r].onchange=w}var q=A.getElementsByTagName("input");for(var r=0;r<q.length;r++){q[r].onclick=y}var s=document.createElement("input");s.type="button";s.value="Hide";a.addListener(s,"click",function(){v.setDisplaySettings(false)});A.appendChild(s);A.hideButton=s}f.options={mode:"text",theme:"textmate",gutter:"false",fontSize:"12px",softWrap:"off",keybindings:"ace",showPrintMargin:"false",useSoftTabs:"true",showInvisibles:"false"}});