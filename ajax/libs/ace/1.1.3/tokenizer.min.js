define(function(c,a,d){var e=1000;var b=function(p){this.states=p;this.regExps={};this.matchMappings={};for(var o in this.states){var g=this.states[o];var j=[];var q=0;var f=this.matchMappings[o]={defaultToken:"text"};var k="g";var m=[];for(var h=0;h<g.length;h++){var l=g[h];if(l.defaultToken){f.defaultToken=l.defaultToken}if(l.caseInsensitive){k="gi"}if(l.regex==null){continue}if(l.regex instanceof RegExp){l.regex=l.regex.toString().slice(1,-1)}var n=l.regex;var r=new RegExp("(?:("+n+")|(.))").exec("a").length-2;if(Array.isArray(l.token)){if(l.token.length==1||r==1){l.token=l.token[0]}else{if(r-1!=l.token.length){throw new Error("number of classes and regexp groups in '"+l.token+"'\n'"+l.regex+"' doesn't match\n"+(r-1)+"!="+l.token.length)}else{l.tokenArray=l.token;l.token=null;l.onMatch=this.$arrayTokens}}}else{if(typeof l.token=="function"&&!l.onMatch){if(r>1){l.onMatch=this.$applyToken}else{l.onMatch=l.token}}}if(r>1){if(/\\\d/.test(l.regex)){n=l.regex.replace(/\\([0-9]+)/g,function(i,s){return"\\"+(parseInt(s,10)+q+1)})}else{r=1;n=this.removeCapturingGroups(l.regex)}if(!l.splitRegex&&typeof l.token!="string"){m.push(l)}}f[q]=h;q+=r;j.push(n);if(!l.onMatch){l.onMatch=null}l.__proto__=null}m.forEach(function(i){i.splitRegex=this.createSplitterRegexp(i.regex,k)},this);this.regExps[o]=new RegExp("("+j.join(")|(")+")|($)",k)}};(function(){this.$setMaxTokenCount=function(f){e=f|0};this.$applyToken=function(m){var g=this.splitRegex.exec(m).slice(1);var j=this.token.apply(this,g);if(typeof j==="string"){return[{type:j,value:m}]}var k=[];for(var h=0,f=j.length;h<f;h++){if(g[h]){k[k.length]={type:j[h],value:g[h]}}}return k},this.$arrayTokens=function(m){if(!m){return[]}var g=this.splitRegex.exec(m);if(!g){return"text"}var k=[];var j=this.tokenArray;for(var h=0,f=j.length;h<f;h++){if(g[h+1]){k[k.length]={type:j[h],value:g[h+1]}}}return k};this.removeCapturingGroups=function(g){var f=g.replace(/\[(?:\\.|[^\]])*?\]|\\.|\(\?[:=!]|(\()/g,function(h,i){return i?"(?:":h});return f};this.createSplitterRegexp=function(i,g){if(i.indexOf("(?=")!=-1){var f=0;var j=false;var h={};i.replace(/(\\.)|(\((?:\?[=!])?)|(\))|([\[\]])/g,function(k,l,q,p,o,n){if(j){j=o!="]"}else{if(o){j=true}else{if(p){if(f==h.stack){h.end=n+1;h.stack=-1}f--}else{if(q){f++;if(q.length!=1){h.stack=f;h.start=n}}}}}return k});if(h.end!=null&&/^\)*$/.test(i.substr(h.end))){i=i.substring(0,h.start)+i.substr(h.end)}}return new RegExp(i,(g||"").replace("g",""))};this.getLineTokens=function(w,k){if(k&&typeof k!="string"){var t=k.slice(0);k=t[0]}else{var t=[]}var h=k||"start";var g=this.states[h];if(!g){h="start";g=this.states[h]}var f=this.matchMappings[h];var v=this.regExps[h];v.lastIndex=0;var m,r=[];var n=0;var j={type:null,value:""};while(m=v.exec(w)){var q=f.defaultToken;var s=null;var u=m[0];var o=v.lastIndex;if(o-u.length>n){var p=w.substring(n,o-u.length);if(j.type==q){j.value+=p}else{if(j.type){r.push(j)}j={type:q,value:p}}}for(var l=0;l<m.length-2;l++){if(m[l+1]===undefined){continue}s=g[f[l]];if(s.onMatch){q=s.onMatch(u,h,t)}else{q=s.token}if(s.next){if(typeof s.next=="string"){h=s.next}else{h=s.next(h,t)}g=this.states[h];if(!g){window.console&&console.error&&console.error(h,"doesn't exist");h="start";g=this.states[h]}f=this.matchMappings[h];n=o;v=this.regExps[h];v.lastIndex=o}break}if(u){if(typeof q=="string"){if((!s||s.merge!==false)&&j.type===q){j.value+=u}else{if(j.type){r.push(j)}j={type:q,value:u}}}else{if(q){if(j.type){r.push(j)}j={type:null,value:""};for(var l=0;l<q.length;l++){r.push(q[l])}}}}if(n==w.length){break}n=o;if(r.length>e){while(n<w.length){if(j.type){r.push(j)}j={value:w.substring(n,n+=2000),type:"overflow"}}h="start";t=[];break}}if(j.type){r.push(j)}if(t.length>1){if(t[0]!==h){t.unshift(h)}}return{tokens:r,state:t.length?t:h}}}).call(b.prototype);a.Tokenizer=b});