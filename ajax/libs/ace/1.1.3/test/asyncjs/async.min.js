/*!
 * async.js
 * Copyright(c) 2010 Fabian Jakobs <fabian.jakobs@web.de>
 * MIT Licensed
 */
define(function(b,a,d){var e=a.STOP={};a.Generator=function(f){if(typeof f=="function"){this.source={next:f}}else{this.source=f}};(function(){this.next=function(f){this.source.next(f)};this.map=function(g){if(!g){return this}g=c(1,g);var f=this.source;this.next=function(h){f.next(function(i,j){if(i){h(i)}else{g(j,function(k,l){if(k){h(k)}else{h(null,l)}})}})};return new this.constructor(this)};this.filter=function(f){if(!f){return this}f=c(1,f);var g=this.source;this.next=function(i){g.next(function h(j,k){if(j){i(j)}else{f(k,function(m,l){if(m){i(m)}else{if(l){i(null,k)}else{g.next(h)}}})}})};return new this.constructor(this)};this.slice=function(g,f){var h=-1;if(!f||f<0){var f=Infinity}var i=this.source;this.next=function(k){i.next(function j(l,m){h++;if(l){k(l)}else{if(h>=g&&h<f){k(null,m)}else{if(h>=f){k(e)}else{i.next(j)}}}})};return new this.constructor(this)};this.reduce=function(k,f){k=c(3,k);var i=0;var h=false;var g=f;var j=this.source;this.next=function(m){if(h){return m(e)}if(f===undefined){j.next(function(o,n){if(o){return m(o,g)}g=n;l()})}else{l()}function l(){j.next(function n(p,o){if(p){h=true;if(p==e){return m(null,g)}else{return(p)}}k(g,o,i++,function(q,r){g=r;j.next(n)})})}};return new this.constructor(this)};this.forEach=this.each=function(f){f=c(1,f);var g=this.source;this.next=function(i){g.next(function h(j,k){if(j){i(j)}else{f(k,function(l){i(l,k)})}})};return new this.constructor(this)};this.some=function(h){h=c(1,h);var g=this.source;var f=false;this.next=function(j){if(f){return j(e)}g.next(function i(k,l){if(k){return j(k)}h(l,function(n,m){if(n){f=true;if(n==e){j(null,false)}else{j(n)}}else{if(m){f=true;j(null,true)}else{g.next(i)}}})})};return new this.constructor(this)};this.every=function(h){h=c(1,h);var g=this.source;var f=false;this.next=function(j){if(f){return j(e)}g.next(function i(k,l){if(k){return j(k)}h(l,function(n,m){if(n){f=true;if(n==e){j(null,true)}else{j(n)}}else{if(!m){f=true;j(null,false)}else{g.next(i)}}})})};return new this.constructor(this)};this.call=function(f){var g=this.source;return this.map(function(i,h){i=c(0,i,f);i.call(f,function(j,k){h(j,k)})})};this.concat=function(i){var g=[this];g.push.apply(g,arguments);var f=0;var h=g[f++];return new this.constructor(function(k){h.next(function j(l,m){if(l){if(l==e){h=g[f++];if(!h){return k(e)}else{return h.next(j)}}else{return k(l)}}else{return k(null,m)}})})};this.zip=function(g){var f=[this];f.push.apply(f,arguments);return new this.constructor(function(h){a.list(f).map(function(j,i){j.next(i)}).toArray(h)})};this.expand=function(g,i){if(!g){return this}var g=c(1,g);var i=i||this.constructor;var j=this.source;var f=null;return new i(function h(k){if(!f){j.next(function(l,m){if(l){return k(l)}g(m,function(o,n){if(o){return k(o)}f=n;h(k)})})}else{f.next(function(l,m){if(l==e){f=null;return h(k)}else{if(l){return k(l)}}k(l,m)})}})};this.sort=function(g){var f=this;var h;this.next=function(i){if(h){return h.next(i)}f.toArray(function(k,j){if(k){i(k)}else{h=a.list(j.sort(g));h.next(i)}})};return new this.constructor(this)};this.join=function(f){return this.$arrayOp(Array.prototype.join,f!==undefined?[f]:null)};this.reverse=function(){return this.$arrayOp(Array.prototype.reverse)};this.$arrayOp=function(h,g){var f=this;var j=0;this.next=function(i){if(j++>0){return i(e)}f.toArray(function(l,k){if(l){i(l,"")}else{if(g){i(null,h.apply(k,g))}else{i(null,h.call(k))}}})};return new this.constructor(this)};this.end=function(f,k){if(!k){k=arguments[0];f=true}var i=this.source;var h;var j;i.next(function g(l,m){if(l){if(l==e){k&&k(j,h)}else{if(!f){j=l;i.next(g)}else{k&&k(l,m)}}}else{h=m;i.next(g)}})};this.toArray=function(g,k){if(!k){k=arguments[0];g=true}var f=[];var j=[];var i=this.source;i.next(function h(l,m){if(l){if(l==e){if(g){return k(null,f)}else{j.length=f.length;return k(j,f)}}else{if(g){return k(l)}else{j[f.length]=l}}}f.push(m);i.next(h)})}}).call(a.Generator.prototype);var c=a.makeAsync=function(f,h,g){if(h.length>f){return h}else{return function(){var j;var i=arguments[f];try{j=h.apply(g||this,arguments)}catch(k){return i(k)}i(null,j)}}};a.list=function(h,g){var g=g||a.Generator;var j=0;var f=h.length;return new g(function(i){if(j<f){i(null,h[j++])}else{i(e)}})};a.values=function(i,f){var g=[];for(var h in i){g.push(i[h])}return a.list(g,f)};a.keys=function(i,f){var h=[];for(var g in i){h.push(g)}return a.list(h,f)};a.range=function(j,g,h,f){var f=f||a.Generator;j=j||0;h=h||1;if(g===undefined||g===null){g=h>0?Infinity:-Infinity}var i=j;return new f(function(l){if(h>0&&i>=g||h<0&&i<=g){l(e)}else{var k=i;i+=h;l(null,k)}})};a.concat=function(g,f){if(arguments.length>1){return g.concat.apply(g,Array.prototype.slice.call(arguments,1))}else{return g}};a.zip=function(g,f){if(arguments.length>1){return g.zip.apply(g,Array.prototype.slice.call(arguments,1))}else{return g.map(function(i,h){h(null,[i])})}};a.plugin=function(f,h){if(f){for(var g in f){a.Generator.prototype[g]=f[g]}}if(h){for(var g in h){a[g]=h[g]}}}});