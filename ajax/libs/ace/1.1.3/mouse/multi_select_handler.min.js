define(function(c,a,d){var e=c("../lib/event");function b(h,g){return h.row==g.row&&h.column==g.column}function f(A){var B=A.domEvent;var D=B.altKey;var w=B.shiftKey;var r=A.getAccelKey();var g=A.getButton();if(A.editor.inMultiSelectMode&&g==2){A.editor.textInput.onContextMenu(A.domEvent);return}if(!r&&!D){if(g===0&&A.editor.inMultiSelectMode){A.editor.exitMultiSelectMode()}return}var l=A.editor;var E=l.selection;var C=l.inMultiSelectMode;var o=A.getDocumentPosition();var m=E.getCursor();var x=A.inSelection()||(E.isEmpty()&&b(o,m));var q=A.x,p=A.y;var n=function(F){q=F.clientX;p=F.clientY};var j=function(){var G=l.renderer.pixelToScreenCoordinates(q,p);var F=h.screenToDocumentPosition(G.row,G.column);if(b(u,G)&&b(F,E.selectionLead)){return}u=G;l.selection.moveToPosition(F);l.renderer.scrollCursorIntoView();l.removeSelectionMarkers(z);z=E.rectangularRangeBlock(u,k);z.forEach(l.addSelectionMarker,l);l.updateSelectionMarkers()};var h=l.session;var k=l.renderer.pixelToScreenCoordinates(q,p);var u=k;if(r&&!D&&!w&&g===0){if(!C&&x){return}if(!C){var v=E.toOrientedRange();l.addSelectionMarker(v)}var t=E.rangeList.rangeAtPoint(o);l.$blockScrolling++;l.once("mouseup",function(){var F=E.toOrientedRange();if(t&&F.isEmpty()&&b(t.cursor,F.cursor)){E.substractPoint(F.cursor)}else{if(v){l.removeSelectionMarker(v);E.addRange(v)}E.addRange(F)}l.$blockScrolling--})}else{if(D&&g===0){A.stop();if(C&&!r){E.toSingleRange()}else{if(!C&&r){E.addRange()}}var z=[];if(w){k=h.documentToScreenPosition(E.lead);j()}else{E.moveToPosition(o)}var i=function(G){clearInterval(s);l.removeSelectionMarkers(z);for(var F=0;F<z.length;F++){E.addRange(z[F])}};var y=j;e.capture(l.container,n,i);var s=setInterval(function(){y()},20);return A.preventDefault()}}}a.onMouseDown=f});