define(function(e,g,d){var f=e("../lib/dom");var h=e("../lib/oop");var a=e("../lib/event");var i=e("../tooltip").Tooltip;function b(p){var m=p.editor;var k=m.renderer.$gutterLayer;var s=new c(m.container);p.editor.setDefaultHandler("guttermousedown",function(u){if(!m.isFocused()||u.getButton()!=0){return}var w=k.getRegion(u);if(w=="foldWidgets"){return}var v=u.getDocumentPosition().row;var t=m.session.selection;if(u.getShiftKey()){t.selectTo(v,0)}else{if(u.domEvent.detail==2){m.selectAll();return u.preventDefault()}p.$clickSelection=m.selection.getLineRange(v)}p.setState("selectByLines");p.captureMouse(u);return u.preventDefault()});var r,j,l;function q(){var y=j.getDocumentPosition().row;var t=k.$annotations[y];if(!t){return o()}var A=m.session.getLength();if(y==A){var v=m.renderer.pixelToScreenCoordinates(0,j.y).row;var z=j.$pos;if(v>m.session.documentToScreenRow(z.row,z.column)){return o()}}if(l==t){return}l=t.text.join("<br/>");s.setHtml(l);s.show();m.on("mousewheel",o);if(p.$tooltipFollowsMouse){n(j)}else{var u=k.$cells[y].element;var x=u.getBoundingClientRect();var w=s.getElement().style;w.left=x.right+"px";w.top=x.bottom+"px"}}function o(){if(r){r=clearTimeout(r)}if(l){s.hide();l=null;m.removeEventListener("mousewheel",o)}}function n(t){s.setPosition(t.x,t.y)}p.editor.setDefaultHandler("guttermousemove",function(u){var t=u.domEvent.target||u.domEvent.srcElement;if(f.hasCssClass(t,"ace_fold-widget")){return o()}if(l&&p.$tooltipFollowsMouse){n(u)}j=u;if(r){return}r=setTimeout(function(){r=null;if(j&&!p.isMousePressed){q()}else{o()}},50)});a.addListener(m.renderer.$gutter,"mouseout",function(t){j=null;if(!l||r){return}r=setTimeout(function(){r=null;o()},50)});m.on("changeSession",o)}function c(j){i.call(this,j)}h.inherits(c,i);(function(){this.setPosition=function(k,o){var l=window.innerWidth||document.documentElement.clientWidth;var n=window.innerHeight||document.documentElement.clientHeight;var m=this.getWidth();var j=this.getHeight();k+=15;o+=15;if(k+m>l){k-=(k+m)-l}if(o+j>n){o-=20+j}i.prototype.setPosition.call(this,k,o)}}).call(c.prototype);g.GutterHandler=b});