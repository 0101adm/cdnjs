define(function(g,j,e){var a=g("../edit_session").EditSession;var i=g("../virtual_renderer").VirtualRenderer;var k=g("../editor").Editor;var f=g("../range").Range;var b=g("../lib/event");var d=g("../lib/lang");var h=g("../lib/dom");var c=function(n){var o=new i(n);o.$maxLines=4;var m=new k(o);m.setHighlightActiveLine(false);m.setShowPrintMargin(false);m.renderer.setShowGutter(false);m.renderer.setHighlightGutterLine(false);m.$mouseHandler.$focusWaitTimout=0;return m};var l=function(q){var o=h.createElement("div");var m=new c(o);if(q){q.appendChild(o)}o.style.display="none";m.renderer.content.style.cursor="default";m.renderer.setStyle("ace_autocomplete");m.setOption("displayIndentGuides",false);var v=function(){};m.focus=v;m.$isFocused=true;m.renderer.$cursorLayer.restartTimer=v;m.renderer.$cursorLayer.element.style.opacity=0;m.renderer.$maxLines=8;m.renderer.$keepTextAreaAtCursor=false;m.setHighlightActiveLine(false);m.session.highlight("");m.session.$searchHighlight.clazz="ace_highlight-marker";m.on("mousedown",function(w){var x=w.getDocumentPosition();m.moveCursorToPosition(x);m.selection.clearSelection();t.start.row=t.end.row=x.row;w.stop()});var n;var s=new f(-1,0,-1,Infinity);var t=new f(-1,0,-1,Infinity);t.id=m.session.addMarker(t,"ace_active-line","fullLine");m.setSelectOnHover=function(w){if(!w){s.id=m.session.addMarker(s,"ace_line-hover","fullLine")}else{if(s.id){m.session.removeMarker(s.id);s.id=null}}};m.setSelectOnHover(false);m.on("mousemove",function(w){if(!n){n=w;return}if(n.x==w.x&&n.y==w.y){return}n=w;n.scrollTop=m.renderer.scrollTop;var x=n.getDocumentPosition().row;if(s.start.row!=x){if(!s.id){m.setRow(x)}p(x)}});m.renderer.on("beforeRender",function(){if(n&&s.start.row!=-1){n.$pos=null;var w=n.getDocumentPosition().row;if(!s.id){m.setRow(w)}p(w,true)}});m.renderer.on("afterRender",function(){var y=m.getRow();var w=m.renderer.$textLayer;var x=w.element.childNodes[y-w.config.firstRow];if(x==w.selectedNode){return}if(w.selectedNode){h.removeCssClass(w.selectedNode,"ace_selected")}w.selectedNode=x;if(x){h.addCssClass(x,"ace_selected")}});var u=function(){p(-1)};var p=function(x,w){if(x!==s.start.row){s.start.row=s.end.row=x;if(!w){m.session._emit("changeBackMarker")}m._emit("changeHoverMarker")}};m.getHoveredRow=function(){return s.start.row};b.addListener(m.container,"mouseout",u);m.on("hide",u);m.on("changeSelection",u);m.session.doc.getLength=function(){return m.data.length};m.session.doc.getLine=function(w){var x=m.data[w];if(typeof x=="string"){return x}return(x&&x.value)||""};var r=m.session.bgTokenizer;r.$tokenizeRow=function(x){var z=m.data[x];var A=[];if(!z){return A}if(typeof z=="string"){z={value:z}}if(!z.caption){z.caption=z.value}var y=-1;var w,C;for(var x=0;x<z.caption.length;x++){C=z.caption[x];w=z.matchMask&(1<<x)?1:0;if(y!==w){A.push({type:z.className||""+(w?"completion-highlight":""),value:C});y=w}else{A[A.length-1].value+=C}}if(z.meta){var B=m.renderer.$size.scrollerWidth/m.renderer.layerConfig.characterWidth;if(z.meta.length+z.caption.length<B-2){A.push({type:"rightAlignedText",value:z.meta})}}return A};r.$updateOnChange=v;r.start=v;m.session.$computeWidth=function(){return this.screenWidth=0};m.isOpen=false;m.isTopdown=false;m.data=[];m.setData=function(w){m.data=w||[];m.setValue(d.stringRepeat("\n",w.length),-1);m.setRow(0)};m.getData=function(w){return m.data[w]};m.getRow=function(){return t.start.row};m.setRow=function(w){w=Math.max(-1,Math.min(this.data.length,w));if(t.start.row!=w){m.selection.clearSelection();t.start.row=t.end.row=w||0;m.session._emit("changeBackMarker");m.moveCursorTo(w||0,0);if(m.isOpen){m._signal("select")}}};m.on("changeSelection",function(){if(m.isOpen){m.setRow(m.selection.lead.row)}});m.hide=function(){this.container.style.display="none";this._signal("hide");m.isOpen=false};m.show=function(D,F,A){var y=this.container;var x=window.innerHeight;var w=window.innerWidth;var B=this.renderer;var E=B.$maxLines*F*1.4;var C=D.top+this.$borderSize;if(C+E>x-F&&!A){y.style.top="";y.style.bottom=x-C+"px";m.isTopdown=false}else{C+=F;y.style.top=C+"px";y.style.bottom="";m.isTopdown=true}y.style.display="";this.renderer.$textLayer.checkForSizeChanges();var z=D.left;if(z+y.offsetWidth>w){z=w-y.offsetWidth}y.style.left=z+"px";this._signal("show");n=null;m.isOpen=true};m.getTextLeftOffset=function(){return this.$borderSize+this.renderer.$padding+this.$imageSize};m.$imageSize=0;m.$borderSize=1;return m};h.importCssString(".ace_autocomplete.ace-tm .ace_marker-layer .ace_active-line {    background-color: #CAD6FA;    z-index: 1;}.ace_autocomplete.ace-tm .ace_line-hover {    border: 1px solid #abbffe;    margin-top: -1px;    background: rgba(233,233,253,0.4);}.ace_autocomplete .ace_line-hover {    position: absolute;    z-index: 2;}.ace_rightAlignedText {    color: gray;    display: inline-block;    position: absolute;    right: 4px;    text-align: right;    z-index: -1;}.ace_autocomplete .ace_completion-highlight{    color: #000;    text-shadow: 0 0 0.01em;}.ace_autocomplete {    width: 280px;    z-index: 200000;    background: #fbfbfb;    color: #444;    border: 1px lightgray solid;    position: fixed;    box-shadow: 2px 3px 5px rgba(0,0,0,.2);    line-height: 1.4;}");j.AcePopup=l});