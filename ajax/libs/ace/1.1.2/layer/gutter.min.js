define(function(b,a,c){var h=b("../lib/dom");var f=b("../lib/oop");var g=b("../lib/lang");var e=b("../lib/event_emitter").EventEmitter;var d=function(i){this.element=h.createElement("div");this.element.className="ace_layer ace_gutter-layer";i.appendChild(this.element);this.setShowFoldWidgets(this.$showFoldWidgets);this.gutterWidth=0;this.$annotations=[];this.$updateAnnotations=this.$updateAnnotations.bind(this);this.$cells=[]};(function(){f.implement(this,e);this.setSession=function(i){if(this.session){this.session.removeEventListener("change",this.$updateAnnotations)}this.session=i;i.on("change",this.$updateAnnotations)};this.addGutterDecoration=function(j,i){if(window.console){console.warn&&console.warn("deprecated use session.addGutterDecoration")}this.session.addGutterDecoration(j,i)};this.removeGutterDecoration=function(j,i){if(window.console){console.warn&&console.warn("deprecated use session.removeGutterDecoration")}this.session.removeGutterDecoration(j,i)};this.setAnnotations=function(o){this.$annotations=[];for(var l=0;l<o.length;l++){var j=o[l];var p=j.row;var n=this.$annotations[p];if(!n){n=this.$annotations[p]={text:[]}}var k=j.text;k=k?g.escapeHTML(k):j.html||"";if(n.text.indexOf(k)===-1){n.text.push(k)}var m=j.type;if(m=="error"){n.className=" ace_error"}else{if(m=="warning"&&n.className!=" ace_error"){n.className=" ace_warning"}else{if(m=="info"&&(!n.className)){n.className=" ace_info"}}}}};this.$updateAnnotations=function(l){if(!this.$annotations.length){return}var n=l.data;var j=n.range;var m=j.start.row;var i=j.end.row-m;if(i===0){}else{if(n.action=="removeText"||n.action=="removeLines"){this.$annotations.splice(m,i+1,null)}else{var k=new Array(i+1);k.unshift(m,1);this.$annotations.splice.apply(this.$annotations,k)}}};this.update=function(C){var i=C.firstRow;var y=C.lastRow;var j=this.session;var n=j.getNextFoldLine(i);var m=n?n.start.row:Infinity;var x=this.$showFoldWidgets&&j.foldWidgets;var t=j.$breakpoints;var o=j.$decorations;var A=j.$firstLineNumber;var s=0;var r=j.gutterRenderer;var k=null;var q=-1;var p=i;while(true){if(p>m){p=n.end.row+1;n=j.getNextFoldLine(p,n);m=n?n.start.row:Infinity}if(p>y){while(this.$cells.length>q+1){k=this.$cells.pop();this.element.removeChild(k.element)}break}k=this.$cells[++q];if(!k){k={element:null,textNode:null,foldWidget:null};k.element=h.createElement("div");k.textNode=document.createTextNode("");k.element.appendChild(k.textNode);this.element.appendChild(k.element);this.$cells[q]=k}var l="ace_gutter-cell ";if(t[p]){l+=t[p]}if(o[p]){l+=o[p]}if(this.$annotations[p]){l+=this.$annotations[p].className}if(k.element.className!=l){k.element.className=l}var w=j.getRowLength(p)*C.lineHeight+"px";if(w!=k.element.style.height){k.element.style.height=w}if(x){var B=x[p];if(B==null){B=x[p]=j.getFoldWidget(p)}}if(B){if(!k.foldWidget){k.foldWidget=h.createElement("span");k.element.appendChild(k.foldWidget)}var l="ace_fold-widget ace_"+B;if(B=="start"&&p==m&&p<n.end.row){l+=" ace_closed"}else{l+=" ace_open"}if(k.foldWidget.className!=l){k.foldWidget.className=l}var w=C.lineHeight+"px";if(k.foldWidget.style.height!=w){k.foldWidget.style.height=w}}else{if(k.foldWidget){k.element.removeChild(k.foldWidget);k.foldWidget=null}}var u=s=r?r.getText(j,p):p+A;if(u!=k.textNode.data){k.textNode.data=u}p++}this.element.style.height=C.minHeight+"px";if(this.$fixedWidth||j.$useWrapMode){s=j.getLength()+A}var z=r?r.getWidth(j,s,C):s.toString().length*C.characterWidth;var v=this.$padding||this.$computePadding();z+=v.left+v.right;if(z!==this.gutterWidth&&!isNaN(z)){this.gutterWidth=z;this.element.style.width=Math.ceil(this.gutterWidth)+"px";this._emit("changeGutterWidth",z)}};this.$fixedWidth=false;this.$showFoldWidgets=true;this.setShowFoldWidgets=function(i){if(i){h.addCssClass(this.element,"ace_folding-enabled")}else{h.removeCssClass(this.element,"ace_folding-enabled")}this.$showFoldWidgets=i;this.$padding=null};this.getShowFoldWidgets=function(){return this.$showFoldWidgets};this.$computePadding=function(){if(!this.element.firstChild){return{left:0,right:0}}var i=h.computedStyle(this.element.firstChild);this.$padding={};this.$padding.left=parseInt(i.paddingLeft)+1||0;this.$padding.right=parseInt(i.paddingRight)||0;return this.$padding};this.getRegion=function(i){var k=this.$padding||this.$computePadding();var j=this.element.getBoundingClientRect();if(i.x<k.left+j.left){return"markers"}if(this.$showFoldWidgets&&i.x>j.right-k.right){return"foldWidgets"}}}).call(d.prototype);a.Gutter=d});