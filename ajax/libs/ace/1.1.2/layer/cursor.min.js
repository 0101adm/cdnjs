define(function(b,a,c){var e=b("../lib/dom");var d=function(f){this.element=e.createElement("div");this.element.className="ace_layer ace_cursor-layer";f.appendChild(this.element);this.isVisible=false;this.isBlinking=true;this.blinkInterval=1000;this.smoothBlinking=false;this.cursors=[];this.cursor=this.addCursor();e.addCssClass(this.element,"ace_hidden-cursors")};(function(){this.$padding=0;this.setPadding=function(f){this.$padding=f};this.setSession=function(f){this.session=f};this.setBlinking=function(f){if(f!=this.isBlinking){this.isBlinking=f;this.restartTimer()}};this.setBlinkInterval=function(f){if(f!=this.blinkInterval){this.blinkInterval=f;this.restartTimer()}};this.setSmoothBlinking=function(f){if(f!=this.smoothBlinking){this.smoothBlinking=f;if(f){e.addCssClass(this.element,"ace_smooth-blinking")}else{e.removeCssClass(this.element,"ace_smooth-blinking")}this.restartTimer()}};this.addCursor=function(){var f=e.createElement("div");f.className="ace_cursor";this.element.appendChild(f);this.cursors.push(f);return f};this.removeCursor=function(){if(this.cursors.length>1){var f=this.cursors.pop();f.parentNode.removeChild(f);return f}};this.hideCursor=function(){this.isVisible=false;e.addCssClass(this.element,"ace_hidden-cursors");this.restartTimer()};this.showCursor=function(){this.isVisible=true;e.removeCssClass(this.element,"ace_hidden-cursors");this.restartTimer()};this.restartTimer=function(){clearInterval(this.intervalId);clearTimeout(this.timeoutId);if(this.smoothBlinking){e.removeCssClass(this.element,"ace_smooth-blinking")}for(var g=this.cursors.length;g--;){this.cursors[g].style.opacity=""}if(!this.isBlinking||!this.blinkInterval||!this.isVisible){return}if(this.smoothBlinking){setTimeout(function(){e.addCssClass(this.element,"ace_smooth-blinking")}.bind(this))}var f=function(){this.timeoutId=setTimeout(function(){for(var h=this.cursors.length;h--;){this.cursors[h].style.opacity=0}}.bind(this),0.6*this.blinkInterval)}.bind(this);this.intervalId=setInterval(function(){for(var h=this.cursors.length;h--;){this.cursors[h].style.opacity=""}f()}.bind(this),this.blinkInterval);f()};this.getPixelPosition=function(f,g){if(!this.config||!this.session){return{left:0,top:0}}if(!f){f=this.session.selection.getCursor()}var j=this.session.documentToScreenPosition(f);var h=this.$padding+j.column*this.config.characterWidth;var i=(j.row-(g?this.config.firstRowScreen:0))*this.config.lineHeight;return{left:h,top:i}};this.update=function(g){this.config=g;var k=this.session.$selectionMarkers;var h=0,m=0;if(k===undefined||k.length===0){k=[{cursor:null}]}for(var h=0,o=k.length;h<o;h++){var l=this.getPixelPosition(k[h].cursor,true);if((l.top>g.height+g.offset||l.top<-g.offset)&&h>1){continue}var j=(this.cursors[m++]||this.addCursor()).style;j.left=l.left+"px";j.top=l.top+"px";j.width=g.characterWidth+"px";j.height=g.lineHeight+"px"}while(this.cursors.length>m){this.removeCursor()}var f=this.session.getOverwrite();this.$setOverwrite(f);this.$pixelPos=l;this.restartTimer()};this.$setOverwrite=function(f){if(f!=this.overwrite){this.overwrite=f;if(f){e.addCssClass(this.element,"ace_overwrite-cursors")}else{e.removeCssClass(this.element,"ace_overwrite-cursors")}}};this.destroy=function(){clearInterval(this.intervalId);clearTimeout(this.timeoutId)}}).call(d.prototype);a.Cursor=d});