define(function(h,r,c){h("./lib/fixoldbrowsers");var n=h("./lib/oop");var m=h("./lib/dom");var s=h("./lib/lang");var l=h("./lib/useragent");var b=h("./keyboard/textinput").TextInput;var p=h("./mouse/mouse_handler").MouseHandler;var d=h("./mouse/fold_handler").FoldHandler;var f=h("./keyboard/keybinding").KeyBinding;var a=h("./edit_session").EditSession;var g=h("./search").Search;var o=h("./range").Range;var e=h("./lib/event_emitter").EventEmitter;var j=h("./commands/command_manager").CommandManager;var i=h("./commands/default_commands").commands;var q=h("./config");var k=function(u,v){var t=u.getContainerElement();this.container=t;this.renderer=u;this.commands=new j(l.isMac?"mac":"win",i);this.textInput=new b(u.getTextAreaContainer(),this);this.renderer.textarea=this.textInput.getElement();this.keyBinding=new f(this);this.$mouseHandler=new p(this);new d(this);this.$blockScrolling=0;this.$search=new g().set({wrap:true});this.$historyTracker=this.$historyTracker.bind(this);this.commands.on("exec",this.$historyTracker);this.$initOperationListeners();this._$emitInputEvent=s.delayedCall(function(){this._signal("input",{});this.session.bgTokenizer&&this.session.bgTokenizer.scheduleStart()}.bind(this));this.on("change",function(x,w){w._$emitInputEvent.schedule(31)});this.setSession(v||new a(""));q.resetOptions(this);q._emit("editor",this)};(function(){n.implement(this,e);this.$initOperationListeners=function(){function t(u){return u[u.length-1]}this.selections=[];this.commands.on("exec",function(v){this.startOperation(v);var w=v.command;if(w.aceCommandGroup=="fileJump"){var u=this.prevOp;if(!u||u.command.aceCommandGroup!="fileJump"){this.lastFileJumpPos=t(this.selections)}}else{this.lastFileJumpPos=null}}.bind(this),true);this.commands.on("afterExec",function(u){var v=u.command;if(v.aceCommandGroup=="fileJump"){if(this.lastFileJumpPos&&!this.curOp.selectionChanged){this.selection.fromJSON(this.lastFileJumpPos)}}this.endOperation(u)}.bind(this),true);this.$opResetTimer=s.delayedCall(this.endOperation.bind(this));this.on("change",function(){this.curOp||this.startOperation();this.curOp.docChanged=true}.bind(this),true);this.on("changeSelection",function(){this.curOp||this.startOperation();this.curOp.selectionChanged=true}.bind(this),true)};this.curOp=null;this.prevOp={};this.startOperation=function(u){if(this.curOp){if(!u||this.curOp.command){return}this.prevOp=this.curOp}if(!u){this.previousCommand=null;u={}}this.$opResetTimer.schedule();this.curOp={command:u.command||{},args:u.args,scrollTop:this.renderer.scrollTop};var t=this.curOp.command;if(t&&t.scrollIntoView){this.$blockScrolling++}this.selections.push(this.selection.toJSON())};this.endOperation=function(){if(this.curOp){var v=this.curOp.command;if(v&&v.scrollIntoView){this.$blockScrolling--;switch(v.scrollIntoView){case"center":this.renderer.scrollCursorIntoView(null,0.5);break;case"animate":case"cursor":this.renderer.scrollCursorIntoView();break;case"selectionPart":var t=this.selection.getRange();var u=this.renderer.layerConfig;if(t.start.row>=u.lastRow||t.end.row<=u.firstRow){this.renderer.scrollSelectionIntoView(this.selection.anchor,this.selection.lead)}break;default:break}if(v.scrollIntoView=="animate"){this.renderer.animateScrolling(this.curOp.scrollTop)}}this.prevOp=this.curOp;this.curOp=null}};this.$historyTracker=function(v){if(!this.$mergeUndoDeltas){return}var u=this.prevOp;var t=["backspace","del","insertstring"];var x=u.command&&(v.command.name==u.command.name);if(v.command.name=="insertstring"){var w=v.args;if(this.mergeNextCommand===undefined){this.mergeNextCommand=true}x=x&&this.mergeNextCommand&&(!/\s/.test(w)||/\s/.test(u.args));this.mergeNextCommand=true}else{x=x&&t.indexOf(v.command.name)!==-1}if(this.$mergeUndoDeltas!="always"&&Date.now()-this.sequenceStartTime>2000){x=false}if(x){this.session.mergeUndoDeltas=true}else{if(t.indexOf(v.command.name)!==-1){this.sequenceStartTime=Date.now()}}};this.setKeyboardHandler=function(u){if(!u){this.keyBinding.setKeyboardHandler(null)}else{if(typeof u==="string"){this.$keybindingId=u;var t=this;q.loadModule(["keybinding",u],function(v){if(t.$keybindingId==u){t.keyBinding.setKeyboardHandler(v&&v.handler)}})}else{this.$keybindingId=null;this.keyBinding.setKeyboardHandler(u)}}};this.getKeyboardHandler=function(){return this.keyBinding.getKeyboardHandler()};this.setSession=function(v){if(this.session==v){return}if(this.session){var u=this.session;this.session.removeEventListener("change",this.$onDocumentChange);this.session.removeEventListener("changeMode",this.$onChangeMode);this.session.removeEventListener("tokenizerUpdate",this.$onTokenizerUpdate);this.session.removeEventListener("changeTabSize",this.$onChangeTabSize);this.session.removeEventListener("changeWrapLimit",this.$onChangeWrapLimit);this.session.removeEventListener("changeWrapMode",this.$onChangeWrapMode);this.session.removeEventListener("onChangeFold",this.$onChangeFold);this.session.removeEventListener("changeFrontMarker",this.$onChangeFrontMarker);this.session.removeEventListener("changeBackMarker",this.$onChangeBackMarker);this.session.removeEventListener("changeBreakpoint",this.$onChangeBreakpoint);this.session.removeEventListener("changeAnnotation",this.$onChangeAnnotation);this.session.removeEventListener("changeOverwrite",this.$onCursorChange);this.session.removeEventListener("changeScrollTop",this.$onScrollTopChange);this.session.removeEventListener("changeScrollLeft",this.$onScrollLeftChange);var t=this.session.getSelection();t.removeEventListener("changeCursor",this.$onCursorChange);t.removeEventListener("changeSelection",this.$onSelectionChange)}this.session=v;this.$onDocumentChange=this.onDocumentChange.bind(this);v.addEventListener("change",this.$onDocumentChange);this.renderer.setSession(v);this.$onChangeMode=this.onChangeMode.bind(this);v.addEventListener("changeMode",this.$onChangeMode);this.$onTokenizerUpdate=this.onTokenizerUpdate.bind(this);v.addEventListener("tokenizerUpdate",this.$onTokenizerUpdate);this.$onChangeTabSize=this.renderer.onChangeTabSize.bind(this.renderer);v.addEventListener("changeTabSize",this.$onChangeTabSize);this.$onChangeWrapLimit=this.onChangeWrapLimit.bind(this);v.addEventListener("changeWrapLimit",this.$onChangeWrapLimit);this.$onChangeWrapMode=this.onChangeWrapMode.bind(this);v.addEventListener("changeWrapMode",this.$onChangeWrapMode);this.$onChangeFold=this.onChangeFold.bind(this);v.addEventListener("changeFold",this.$onChangeFold);this.$onChangeFrontMarker=this.onChangeFrontMarker.bind(this);this.session.addEventListener("changeFrontMarker",this.$onChangeFrontMarker);this.$onChangeBackMarker=this.onChangeBackMarker.bind(this);this.session.addEventListener("changeBackMarker",this.$onChangeBackMarker);this.$onChangeBreakpoint=this.onChangeBreakpoint.bind(this);this.session.addEventListener("changeBreakpoint",this.$onChangeBreakpoint);this.$onChangeAnnotation=this.onChangeAnnotation.bind(this);this.session.addEventListener("changeAnnotation",this.$onChangeAnnotation);this.$onCursorChange=this.onCursorChange.bind(this);this.session.addEventListener("changeOverwrite",this.$onCursorChange);this.$onScrollTopChange=this.onScrollTopChange.bind(this);this.session.addEventListener("changeScrollTop",this.$onScrollTopChange);this.$onScrollLeftChange=this.onScrollLeftChange.bind(this);this.session.addEventListener("changeScrollLeft",this.$onScrollLeftChange);this.selection=v.getSelection();this.selection.addEventListener("changeCursor",this.$onCursorChange);this.$onSelectionChange=this.onSelectionChange.bind(this);this.selection.addEventListener("changeSelection",this.$onSelectionChange);this.onChangeMode();this.$blockScrolling+=1;this.onCursorChange();this.$blockScrolling-=1;this.onScrollTopChange();this.onScrollLeftChange();this.onSelectionChange();this.onChangeFrontMarker();this.onChangeBackMarker();this.onChangeBreakpoint();this.onChangeAnnotation();this.session.getUseWrapMode()&&this.renderer.adjustWrapLimit();this.renderer.updateFull();this._emit("changeSession",{session:v,oldSession:u})};this.getSession=function(){return this.session};this.setValue=function(t,u){this.session.doc.setValue(t);if(!u){this.selectAll()}else{if(u==1){this.navigateFileEnd()}else{if(u==-1){this.navigateFileStart()}}}return t};this.getValue=function(){return this.session.getValue()};this.getSelection=function(){return this.selection};this.resize=function(t){this.renderer.onResize(t)};this.setTheme=function(t){this.renderer.setTheme(t)};this.getTheme=function(){return this.renderer.getTheme()};this.setStyle=function(t){this.renderer.setStyle(t)};this.unsetStyle=function(t){this.renderer.unsetStyle(t)};this.getFontSize=function(){return this.getOption("fontSize")||m.computedStyle(this.container,"fontSize")};this.setFontSize=function(t){this.setOption("fontSize",t)};this.$highlightBrackets=function(){if(this.session.$bracketHighlight){this.session.removeMarker(this.session.$bracketHighlight);this.session.$bracketHighlight=null}if(this.$highlightPending){return}var t=this;this.$highlightPending=true;setTimeout(function(){t.$highlightPending=false;var v=t.session.findMatchingBracket(t.getCursorPosition());if(v){var u=new o(v.row,v.column,v.row,v.column+1)}else{if(t.session.$mode.getMatching){var u=t.session.$mode.getMatching(t.session)}}if(u){t.session.$bracketHighlight=t.session.addMarker(u,"ace_bracket","text")}},50)};this.focus=function(){var t=this;setTimeout(function(){t.textInput.focus()});this.textInput.focus()};this.isFocused=function(){return this.textInput.isFocused()};this.blur=function(){this.textInput.blur()};this.onFocus=function(){if(this.$isFocused){return}this.$isFocused=true;this.renderer.showCursor();this.renderer.visualizeFocus();this._emit("focus")};this.onBlur=function(){if(!this.$isFocused){return}this.$isFocused=false;this.renderer.hideCursor();this.renderer.visualizeBlur();this._emit("blur")};this.$cursorChange=function(){this.renderer.updateCursor()};this.onDocumentChange=function(v){var w=v.data;var t=w.range;var u;if(t.start.row==t.end.row&&w.action!="insertLines"&&w.action!="removeLines"){u=t.end.row}else{u=Infinity}this.renderer.updateLines(t.start.row,u);this._emit("change",v);this.$cursorChange()};this.onTokenizerUpdate=function(u){var t=u.data;this.renderer.updateLines(t.first,t.last)};this.onScrollTopChange=function(){this.renderer.scrollToY(this.session.getScrollTop())};this.onScrollLeftChange=function(){this.renderer.scrollToX(this.session.getScrollLeft())};this.onCursorChange=function(){this.$cursorChange();if(!this.$blockScrolling){this.renderer.scrollCursorIntoView()}this.$highlightBrackets();this.$updateHighlightActiveLine();this._emit("changeSelection")};this.$updateHighlightActiveLine=function(){var v=this.getSession();var u;if(this.$highlightActiveLine){if((this.$selectionStyle!="line"||!this.selection.isMultiLine())){u=this.getCursorPosition()}if(this.renderer.$maxLines&&this.session.getLength()===1){u=false}}if(v.$highlightLineMarker&&!u){v.removeMarker(v.$highlightLineMarker.id);v.$highlightLineMarker=null}else{if(!v.$highlightLineMarker&&u){var t=new o(u.row,u.column,u.row,Infinity);t.id=v.addMarker(t,"ace_active-line","screenLine");v.$highlightLineMarker=t}else{if(u){v.$highlightLineMarker.start.row=u.row;v.$highlightLineMarker.end.row=u.row;v.$highlightLineMarker.start.column=u.column;v._emit("changeBackMarker")}}}};this.onSelectionChange=function(x){var w=this.session;if(w.$selectionMarker){w.removeMarker(w.$selectionMarker)}w.$selectionMarker=null;if(!this.selection.isEmpty()){var t=this.selection.getRange();var v=this.getSelectionStyle();w.$selectionMarker=w.addMarker(t,"ace_selection",v)}else{this.$updateHighlightActiveLine()}var u=this.$highlightSelectedWord&&this.$getSelectionHighLightRegexp();this.session.highlight(u);this._emit("changeSelection")};this.$getSelectionHighLightRegexp=function(){var z=this.session;var w=this.getSelectionRange();if(w.isEmpty()||w.isMultiLine()){return}var A=w.start.column-1;var y=w.end.column+1;var u=z.getLine(w.start.row);var t=u.length;var x=u.substring(Math.max(A,0),Math.min(y,t));if((A>=0&&/^[\w\d]/.test(x))||(y<=t&&/[\w\d]$/.test(x))){return}x=u.substring(w.start.column,w.end.column);if(!/^[\w\d]+$/.test(x)){return}var v=this.$search.$assembleRegExp({wholeWord:true,caseSensitive:true,needle:x});return v};this.onChangeFrontMarker=function(){this.renderer.updateFrontMarkers()};this.onChangeBackMarker=function(){this.renderer.updateBackMarkers()};this.onChangeBreakpoint=function(){this.renderer.updateBreakpoints()};this.onChangeAnnotation=function(){this.renderer.setAnnotations(this.session.getAnnotations())};this.onChangeMode=function(t){this.renderer.updateText();this._emit("changeMode",t)};this.onChangeWrapLimit=function(){this.renderer.updateFull()};this.onChangeWrapMode=function(){this.renderer.onResize(true)};this.onChangeFold=function(){this.$updateHighlightActiveLine();this.renderer.updateFull()};this.getSelectedText=function(){return this.session.getTextRange(this.getSelectionRange())};this.getCopyText=function(){var t=this.getSelectedText();this._signal("copy",t);return t};this.onCopy=function(){this.commands.exec("copy",this)};this.onCut=function(){this.commands.exec("cut",this)};this.onPaste=function(t){if(this.$readOnly){return}this._emit("paste",t);this.insert(t)};this.execCommand=function(u,t){this.commands.exec(u,this,t)};this.insert=function(C){var B=this.session;var z=B.getMode();var D=this.getCursorPosition();if(this.getBehavioursEnabled()){var v=z.transformAction(B.getState(D.row),"insertion",this,B,C);if(v){if(C!==v.text){this.session.mergeUndoDeltas=false;this.$mergeNextCommand=false}C=v.text}}if(C=="\t"){C=this.session.getTabString()}if(!this.selection.isEmpty()){var y=this.getSelectionRange();D=this.session.remove(y);this.clearSelection()}else{if(this.session.getOverwrite()){var y=new o.fromPoints(D,D);y.end.column+=C.length;this.session.remove(y)}}if(C=="\n"||C=="\r\n"){var F=B.getLine(D.row);if(D.column>F.search(/\S|$/)){var A=F.substr(D.column).search(/\S|$/);B.doc.removeInLine(D.row,D.column,D.column+A)}}this.clearSelection();var u=D.column;var x=B.getState(D.row);var F=B.getLine(D.row);var E=z.checkOutdent(x,F,C);var w=B.insert(D,C);if(v&&v.selection){if(v.selection.length==2){this.selection.setSelectionRange(new o(D.row,u+v.selection[0],D.row,u+v.selection[1]))}else{this.selection.setSelectionRange(new o(D.row+v.selection[0],v.selection[1],D.row+v.selection[2],v.selection[3]))}}if(B.getDocument().isNewLine(C)){var t=z.getNextLineIndent(x,F.slice(0,D.column),B.getTabString());B.insert({row:D.row+1,column:0},t)}if(E){z.autoOutdent(x,B,D.row)}};this.onTextInput=function(t){this.keyBinding.onTextInput(t)};this.onCommandKey=function(v,t,u){this.keyBinding.onCommandKey(v,t,u)};this.setOverwrite=function(t){this.session.setOverwrite(t)};this.getOverwrite=function(){return this.session.getOverwrite()};this.toggleOverwrite=function(){this.session.toggleOverwrite()};this.setScrollSpeed=function(t){this.setOption("scrollSpeed",t)};this.getScrollSpeed=function(){return this.getOption("scrollSpeed")};this.setDragDelay=function(t){this.setOption("dragDelay",t)};this.getDragDelay=function(){return this.getOption("dragDelay")};this.setSelectionStyle=function(t){this.setOption("selectionStyle",t)};this.getSelectionStyle=function(){return this.getOption("selectionStyle")};this.setHighlightActiveLine=function(t){this.setOption("highlightActiveLine",t)};this.getHighlightActiveLine=function(){return this.getOption("highlightActiveLine")};this.setHighlightGutterLine=function(t){this.setOption("highlightGutterLine",t)};this.getHighlightGutterLine=function(){return this.getOption("highlightGutterLine")};this.setHighlightSelectedWord=function(t){this.setOption("highlightSelectedWord",t)};this.getHighlightSelectedWord=function(){return this.$highlightSelectedWord};this.setAnimatedScroll=function(t){this.renderer.setAnimatedScroll(t)};this.getAnimatedScroll=function(){return this.renderer.getAnimatedScroll()};this.setShowInvisibles=function(t){this.renderer.setShowInvisibles(t)};this.getShowInvisibles=function(){return this.renderer.getShowInvisibles()};this.setDisplayIndentGuides=function(t){this.renderer.setDisplayIndentGuides(t)};this.getDisplayIndentGuides=function(){return this.renderer.getDisplayIndentGuides()};this.setShowPrintMargin=function(t){this.renderer.setShowPrintMargin(t)};this.getShowPrintMargin=function(){return this.renderer.getShowPrintMargin()};this.setPrintMarginColumn=function(t){this.renderer.setPrintMarginColumn(t)};this.getPrintMarginColumn=function(){return this.renderer.getPrintMarginColumn()};this.setReadOnly=function(t){this.setOption("readOnly",t)};this.getReadOnly=function(){return this.getOption("readOnly")};this.setBehavioursEnabled=function(t){this.setOption("behavioursEnabled",t)};this.getBehavioursEnabled=function(){return this.getOption("behavioursEnabled")};this.setWrapBehavioursEnabled=function(t){this.setOption("wrapBehavioursEnabled",t)};this.getWrapBehavioursEnabled=function(){return this.getOption("wrapBehavioursEnabled")};this.setShowFoldWidgets=function(t){this.setOption("showFoldWidgets",t)};this.getShowFoldWidgets=function(){return this.getOption("showFoldWidgets")};this.setFadeFoldWidgets=function(t){this.setOption("fadeFoldWidgets",t)};this.getFadeFoldWidgets=function(){return this.getOption("fadeFoldWidgets")};this.remove=function(v){if(this.selection.isEmpty()){if(v=="left"){this.selection.selectLeft()}else{this.selection.selectRight()}}var u=this.getSelectionRange();if(this.getBehavioursEnabled()){var x=this.session;var w=x.getState(u.start.row);var z=x.getMode().transformAction(w,"deletion",this,x,u);if(u.end.column===0){var y=x.getTextRange(u);if(y[y.length-1]=="\n"){var t=x.getLine(u.end.row);if(/^\s+$/.test(t)){u.end.column=t.length}}}if(z){u=z}}this.session.remove(u);this.clearSelection()};this.removeWordRight=function(){if(this.selection.isEmpty()){this.selection.selectWordRight()}this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeWordLeft=function(){if(this.selection.isEmpty()){this.selection.selectWordLeft()}this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeToLineStart=function(){if(this.selection.isEmpty()){this.selection.selectLineStart()}this.session.remove(this.getSelectionRange());this.clearSelection()};this.removeToLineEnd=function(){if(this.selection.isEmpty()){this.selection.selectLineEnd()}var t=this.getSelectionRange();if(t.start.column==t.end.column&&t.start.row==t.end.row){t.end.column=0;t.end.row++}this.session.remove(t);this.clearSelection()};this.splitLine=function(){if(!this.selection.isEmpty()){this.session.remove(this.getSelectionRange());this.clearSelection()}var t=this.getCursorPosition();this.insert("\n");this.moveCursorToPosition(t)};this.transposeLetters=function(){if(!this.selection.isEmpty()){return}var x=this.getCursorPosition();var v=x.column;if(v===0){return}var t=this.session.getLine(x.row);var w,u;if(v<t.length){w=t.charAt(v)+t.charAt(v-1);u=new o(x.row,v-1,x.row,v+1)}else{w=t.charAt(v-1)+t.charAt(v-2);u=new o(x.row,v-2,x.row,v)}this.session.replace(u,w)};this.toLowerCase=function(){var u=this.getSelectionRange();if(this.selection.isEmpty()){this.selection.selectWord()}var t=this.getSelectionRange();var v=this.session.getTextRange(t);this.session.replace(t,v.toLowerCase());this.selection.setSelectionRange(u)};this.toUpperCase=function(){var u=this.getSelectionRange();if(this.selection.isEmpty()){this.selection.selectWord()}var t=this.getSelectionRange();var v=this.session.getTextRange(t);this.session.replace(t,v.toUpperCase());this.selection.setSelectionRange(u)};this.indent=function(){var x=this.session;var u=this.getSelectionRange();if(u.start.row<u.end.row){var A=this.$getSelectedRows();x.indentRows(A.first,A.last,"\t");return}else{if(u.start.column<u.end.column){var z=x.getTextRange(u);if(!/^\s+$/.test(z)){var A=this.$getSelectedRows();x.indentRows(A.first,A.last,"\t");return}}}var C=x.getLine(u.start.row);var v=u.start;var B=x.getTabSize();var t=x.documentToScreenColumn(v.row,v.column);if(this.session.getUseSoftTabs()){var w=(B-t%B);var y=s.stringRepeat(" ",w)}else{var w=t%B;while(C[u.start.column]==" "&&w){u.start.column--;w--}this.selection.setSelectionRange(u);y="\t"}return this.insert(y)};this.blockIndent=function(){var t=this.$getSelectedRows();this.session.indentRows(t.first,t.last,"\t")};this.blockOutdent=function(){var t=this.session.getSelection();this.session.outdentRows(t.getRange())};this.sortLines=function(){var x=this.$getSelectedRows();var y=this.session;var v=[];for(w=x.first;w<=x.last;w++){v.push(y.getLine(w))}v.sort(function(A,z){if(A.toLowerCase()<z.toLowerCase()){return -1}if(A.toLowerCase()>z.toLowerCase()){return 1}return 0});var u=new o(0,0,0,0);for(var w=x.first;w<=x.last;w++){var t=y.getLine(w);u.start.row=w;u.end.row=w;u.end.column=t.length;y.replace(u,v[w-x.first])}};this.toggleCommentLines=function(){var u=this.session.getState(this.getCursorPosition().row);var t=this.$getSelectedRows();this.session.getMode().toggleCommentLines(u,this.session,t.first,t.last)};this.toggleBlockComment=function(){var v=this.getCursorPosition();var u=this.session.getState(v.row);var t=this.getSelectionRange();this.session.getMode().toggleBlockComment(u,this.session,t,v)};this.getNumberAt=function(y,w){var u=/[\-]?[0-9]+(?:\.[0-9]+)?/g;u.lastIndex=0;var v=this.session.getLine(y);while(u.lastIndex<w){var t=u.exec(v);if(t.index<=w&&t.index+t[0].length>=w){var x={value:t[0],start:t.index,end:t.index+t[0].length};return x}}return null};this.modifyNumber=function(w){var E=this.selection.getCursor().row;var v=this.selection.getCursor().column;var D=new o(E,v-1,E,v);var z=this.session.getTextRange(D);if(!isNaN(parseFloat(z))&&isFinite(z)){var A=this.getNumberAt(E,v);if(A){var x=A.value.indexOf(".")>=0?A.start+A.value.indexOf(".")+1:A.end;var u=A.start+A.value.length-x;var C=parseFloat(A.value);C*=Math.pow(10,u);if(x!==A.end&&v<x){w*=Math.pow(10,A.end-v-1)}else{w*=Math.pow(10,A.end-v)}C+=w;C/=Math.pow(10,u);var y=C.toFixed(u);var B=new o(E,A.start,E,A.end);this.session.replace(B,y);this.moveCursorTo(E,Math.max(A.start+1,v+y.length-A.value.length))}}};this.removeLines=function(){var u=this.$getSelectedRows();var t;if(u.first===0||u.last+1<this.session.getLength()){t=new o(u.first,0,u.last+1,0)}else{t=new o(u.first-1,this.session.getLine(u.first-1).length,u.last,this.session.getLine(u.last).length)}this.session.remove(t);this.clearSelection()};this.duplicateSelection=function(){var x=this.selection;var y=this.session;var u=x.getRange();var v=x.isBackwards();if(u.isEmpty()){var z=u.start.row;y.duplicateLines(z,z)}else{var t=v?u.start:u.end;var w=y.insert(t,y.getTextRange(u),false);u.start=t;u.end=w;x.setSelectionRange(u,v)}};this.moveLinesDown=function(){this.$moveLines(function(u,t){return this.session.moveLinesDown(u,t)})};this.moveLinesUp=function(){this.$moveLines(function(u,t){return this.session.moveLinesUp(u,t)})};this.moveText=function(t,u,v){return this.session.moveText(t,u,v)};this.copyLinesUp=function(){this.$moveLines(function(u,t){this.session.duplicateLines(u,t);return 0})};this.copyLinesDown=function(){this.$moveLines(function(u,t){return this.session.duplicateLines(u,t)})};this.$moveLines=function(u){var A=this.selection;if(!A.inMultiSelectMode||this.inVirtualSelectionMode){var y=A.toOrientedRange();var C=this.$getSelectedRows(y);var z=u.call(this,C.first,C.last);y.moveBy(z,0);A.fromOrientedRange(y)}else{var t=A.rangeList.ranges;A.rangeList.detach(this.session);for(var w=t.length;w--;){var v=w;var C=t[w].collapseRows();var B=C.end.row;var x=C.start.row;while(w--){C=t[w].collapseRows();if(x-C.end.row<=1){x=C.end.row}else{break}}w++;var z=u.call(this,x,B);while(v>=w){t[v].moveBy(z,0);v--}}A.fromOrientedRange(A.ranges[0]);A.rangeList.attach(this.session)}};this.$getSelectedRows=function(){var t=this.getSelectionRange().collapseRows();return{first:this.session.getRowFoldStart(t.start.row),last:this.session.getRowFoldEnd(t.end.row)}};this.onCompositionStart=function(t){this.renderer.showComposition(this.getCursorPosition())};this.onCompositionUpdate=function(t){this.renderer.setCompositionText(t)};this.onCompositionEnd=function(){this.renderer.hideComposition()};this.getFirstVisibleRow=function(){return this.renderer.getFirstVisibleRow()};this.getLastVisibleRow=function(){return this.renderer.getLastVisibleRow()};this.isRowVisible=function(t){return(t>=this.getFirstVisibleRow()&&t<=this.getLastVisibleRow())};this.isRowFullyVisible=function(t){return(t>=this.renderer.getFirstFullyVisibleRow()&&t<=this.renderer.getLastFullyVisibleRow())};this.$getVisibleRowCount=function(){return this.renderer.getScrollBottomRow()-this.renderer.getScrollTopRow()+1};this.$moveByPage=function(v,t){var x=this.renderer;var u=this.renderer.layerConfig;var w=v*Math.floor(u.height/u.lineHeight);this.$blockScrolling++;if(t===true){this.selection.$moveSelection(function(){this.moveCursorBy(w,0)})}else{if(t===false){this.selection.moveCursorBy(w,0);this.selection.clearSelection()}}this.$blockScrolling--;var y=x.scrollTop;x.scrollBy(0,w*u.lineHeight);if(t!=null){x.scrollCursorIntoView(null,0.5)}x.animateScrolling(y)};this.selectPageDown=function(){this.$moveByPage(1,true)};this.selectPageUp=function(){this.$moveByPage(-1,true)};this.gotoPageDown=function(){this.$moveByPage(1,false)};this.gotoPageUp=function(){this.$moveByPage(-1,false)};this.scrollPageDown=function(){this.$moveByPage(1)};this.scrollPageUp=function(){this.$moveByPage(-1)};this.scrollToRow=function(t){this.renderer.scrollToRow(t)};this.scrollToLine=function(u,t,v,w){this.renderer.scrollToLine(u,t,v,w)};this.centerSelection=function(){var t=this.getSelectionRange();var u={row:Math.floor(t.start.row+(t.end.row-t.start.row)/2),column:Math.floor(t.start.column+(t.end.column-t.start.column)/2)};this.renderer.alignCursor(u,0.5)};this.getCursorPosition=function(){return this.selection.getCursor()};this.getCursorPositionScreen=function(){return this.session.documentToScreenPosition(this.getCursorPosition())};this.getSelectionRange=function(){return this.selection.getRange()};this.selectAll=function(){this.$blockScrolling+=1;this.selection.selectAll();this.$blockScrolling-=1};this.clearSelection=function(){this.selection.clearSelection()};this.moveCursorTo=function(u,t){this.selection.moveCursorTo(u,t)};this.moveCursorToPosition=function(t){this.selection.moveCursorToPosition(t)};this.jumpToMatching=function(t){var v=this.getCursorPosition();var u=this.session.getBracketRange(v);if(!u){u=this.find({needle:/[{}()\[\]]/g,preventScroll:true,start:{row:v.row,column:v.column-1}});if(!u){return}var w=u.start;if(w.row==v.row&&Math.abs(w.column-v.column)<2){u=this.session.getBracketRange(w)}}w=u&&u.cursor||w;if(w){if(t){if(u&&u.isEqual(this.getSelectionRange())){this.clearSelection()}else{this.selection.selectTo(w.row,w.column)}}else{this.clearSelection();this.moveCursorTo(w.row,w.column)}}};this.gotoLine=function(t,v,u){this.selection.clearSelection();this.session.unfold({row:t-1,column:v||0});this.$blockScrolling+=1;this.exitMultiSelectMode&&this.exitMultiSelectMode();this.moveCursorTo(t-1,v||0);this.$blockScrolling-=1;if(!this.isRowFullyVisible(t-1)){this.scrollToLine(t-1,true,u)}};this.navigateTo=function(u,t){this.clearSelection();this.moveCursorTo(u,t)};this.navigateUp=function(u){if(this.selection.isMultiLine()&&!this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection();u=u||1;this.selection.moveCursorBy(-u,0)};this.navigateDown=function(u){if(this.selection.isMultiLine()&&this.selection.isBackwards()){var t=this.selection.anchor.getPosition();return this.moveCursorToPosition(t)}this.selection.clearSelection();u=u||1;this.selection.moveCursorBy(u,0)};this.navigateLeft=function(u){if(!this.selection.isEmpty()){var t=this.getSelectionRange().start;this.moveCursorToPosition(t)}else{u=u||1;while(u--){this.selection.moveCursorLeft()}}this.clearSelection()};this.navigateRight=function(u){if(!this.selection.isEmpty()){var t=this.getSelectionRange().end;this.moveCursorToPosition(t)}else{u=u||1;while(u--){this.selection.moveCursorRight()}}this.clearSelection()};this.navigateLineStart=function(){this.selection.moveCursorLineStart();this.clearSelection()};this.navigateLineEnd=function(){this.selection.moveCursorLineEnd();this.clearSelection()};this.navigateFileEnd=function(){this.selection.moveCursorFileEnd();this.clearSelection()};this.navigateFileStart=function(){this.selection.moveCursorFileStart();this.clearSelection()};this.navigateWordRight=function(){this.selection.moveCursorWordRight();this.clearSelection()};this.navigateWordLeft=function(){this.selection.moveCursorWordLeft();this.clearSelection()};this.replace=function(v,u){if(u){this.$search.set(u)}var t=this.$search.find(this.session);var w=0;if(!t){return w}if(this.$tryReplace(t,v)){w=1}if(t!==null){this.selection.setSelectionRange(t);this.renderer.scrollSelectionIntoView(t.start,t.end)}return w};this.replaceAll=function(x,u){if(u){this.$search.set(u)}var t=this.$search.findAll(this.session);var y=0;if(!t.length){return y}this.$blockScrolling+=1;var w=this.getSelectionRange();this.clearSelection();this.selection.moveCursorTo(0,0);for(var v=t.length-1;v>=0;--v){if(this.$tryReplace(t[v],x)){y++}}this.selection.setSelectionRange(w);this.$blockScrolling-=1;return y};this.$tryReplace=function(u,v){var t=this.session.getTextRange(u);v=this.$search.replace(t,v);if(v!==null){u.end=this.session.replace(u,v);return u}else{return null}};this.getLastSearchOptions=function(){return this.$search.getOptions()};this.find=function(x,w,u){if(!w){w={}}if(typeof x=="string"||x instanceof RegExp){w.needle=x}else{if(typeof x=="object"){n.mixin(w,x)}}var t=this.selection.getRange();if(w.needle==null){x=this.session.getTextRange(t)||this.$search.$options.needle;if(!x){t=this.session.getWordRange(t.start.row,t.start.column);x=this.session.getTextRange(t)}this.$search.set({needle:x})}this.$search.set(w);if(!w.start){this.$search.set({start:t})}var v=this.$search.find(this.session);if(w.preventScroll){return v}if(v){this.revealRange(v,u);return v}if(w.backwards){t.start=t.end}else{t.end=t.start}this.selection.setRange(t)};this.findNext=function(u,t){this.find({skipCurrent:true,backwards:false},u,t)};this.findPrevious=function(u,t){this.find(u,{skipCurrent:true,backwards:true},t)};this.revealRange=function(u,t){this.$blockScrolling+=1;this.session.unfold(u);this.selection.setSelectionRange(u);this.$blockScrolling-=1;var v=this.renderer.scrollTop;this.renderer.scrollSelectionIntoView(u.start,u.end,0.5);if(t!==false){this.renderer.animateScrolling(v)}};this.undo=function(){this.$blockScrolling++;this.session.getUndoManager().undo();this.$blockScrolling--;this.renderer.scrollCursorIntoView(null,0.5)};this.redo=function(){this.$blockScrolling++;this.session.getUndoManager().redo();this.$blockScrolling--;this.renderer.scrollCursorIntoView(null,0.5)};this.destroy=function(){this.renderer.destroy();this._emit("destroy",this)};this.setAutoScrollEditorIntoView=function(v){if(v===false){return}var x;var t=this;var w=false;if(!this.$scrollAnchor){this.$scrollAnchor=document.createElement("div")}var z=this.$scrollAnchor;z.style.cssText="position:absolute";this.container.insertBefore(z,this.container.firstChild);var A=this.on("changeSelection",function(){w=true});var y=this.renderer.on("beforeRender",function(){if(w){x=t.renderer.container.getBoundingClientRect()}});var u=this.renderer.on("afterRender",function(){if(w&&x&&t.isFocused()){var C=t.renderer;var E=C.$cursorLayer.$pixelPos;var B=C.layerConfig;var D=E.top-B.offset;if(E.top>=0&&D+x.top<0){w=true}else{if(E.top<B.height&&E.top+x.top+B.lineHeight>window.innerHeight){w=false}else{w=null}}if(w!=null){z.style.top=D+"px";z.style.left=E.left+"px";z.style.height=B.lineHeight+"px";z.scrollIntoView(w)}w=x=null}});this.setAutoScrollEditorIntoView=function(B){if(B===true){return}delete this.setAutoScrollEditorIntoView;this.removeEventListener("changeSelection",A);this.renderer.removeEventListener("afterRender",u);this.renderer.removeEventListener("beforeRender",y)}};this.$resetCursorStyle=function(){var t=this.$cursorStyle||"ace";var u=this.renderer.$cursorLayer;if(!u){return}u.setSmoothBlinking(t=="smooth");u.isBlinking=!this.$readOnly&&t!="wide"}}).call(k.prototype);q.defineOptions(k.prototype,"editor",{selectionStyle:{set:function(t){this.onSelectionChange();this._emit("changeSelectionStyle",{data:t})},initialValue:"line"},highlightActiveLine:{set:function(){this.$updateHighlightActiveLine()},initialValue:true},highlightSelectedWord:{set:function(t){this.$onSelectionChange()},initialValue:true},readOnly:{set:function(t){this.textInput.setReadOnly(t);this.$resetCursorStyle()},initialValue:false},cursorStyle:{set:function(t){this.$resetCursorStyle()},values:["ace","slim","smooth","wide"],initialValue:"ace"},mergeUndoDeltas:{values:[false,true,"always"],initialValue:true},behavioursEnabled:{initialValue:true},wrapBehavioursEnabled:{initialValue:true},hScrollBarAlwaysVisible:"renderer",vScrollBarAlwaysVisible:"renderer",highlightGutterLine:"renderer",animatedScroll:"renderer",showInvisibles:"renderer",showPrintMargin:"renderer",printMarginColumn:"renderer",printMargin:"renderer",fadeFoldWidgets:"renderer",showFoldWidgets:"renderer",showGutter:"renderer",displayIndentGuides:"renderer",fontSize:"renderer",fontFamily:"renderer",maxLines:"renderer",minLines:"renderer",scrollPastEnd:"renderer",fixedWidthGutter:"renderer",theme:"renderer",scrollSpeed:"$mouseHandler",dragDelay:"$mouseHandler",dragEnabled:"$mouseHandler",focusTimout:"$mouseHandler",firstLineNumber:"session",overwrite:"session",newLineMode:"session",useWorker:"session",useSoftTabs:"session",tabSize:"session",wrap:"session",foldStyle:"session",mode:"session"});r.Editor=k});