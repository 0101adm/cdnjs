define(function(c,b,d){var f=c("./range").Range;var e=f.comparePoints;var a=function(){this.ranges=[]};(function(){this.comparePoints=e;this.pointIndex=function(o,j,n){var l=this.ranges;for(var k=n||0;k<l.length;k++){var h=l[k];var m=e(o,h.end);if(m>0){continue}var g=e(o,h.start);if(m===0){return j&&g!==0?-k-2:k}if(g>0||(g===0&&!j)){return k}return -k-1}return -k-1};this.add=function(h){var g=!h.isEmpty();var j=this.pointIndex(h.start,g);if(j<0){j=-j-1}var i=this.pointIndex(h.end,g,j);if(i<0){i=-i-1}else{i++}return this.ranges.splice(j,i-j,h)};this.addList=function(h){var j=[];for(var g=h.length;g--;){j.push.call(j,this.add(h[g]))}return j};this.substractPoint=function(h){var g=this.pointIndex(h);if(g>=0){return this.ranges.splice(g,1)}};this.merge=function(){var m=[];var l=this.ranges;l=l.sort(function(n,i){return e(n.start,i.start)});var j=l[0],g;for(var h=1;h<l.length;h++){g=j;j=l[h];var k=e(g.end,j.start);if(k<0){continue}if(k==0&&!g.isEmpty()&&!j.isEmpty()){continue}if(e(g.end,j.end)<0){g.end.row=j.end.row;g.end.column=j.end.column}l.splice(h,1);m.push(j);j=g;h--}this.ranges=l;return m};this.contains=function(h,g){return this.pointIndex({row:h,column:g})>=0};this.containsPoint=function(g){return this.pointIndex(g)>=0};this.rangeAtPoint=function(h){var g=this.pointIndex(h);if(g>=0){return this.ranges[g]}};this.clipRows=function(j,h){var m=this.ranges;if(m[0].start.row>h||m[m.length-1].start.row<j){return[]}var n=this.pointIndex({row:j,column:0});if(n<0){n=-n-1}var l=this.pointIndex({row:h,column:0},n);if(l<0){l=-l-1}var g=[];for(var k=n;k<l;k++){g.push(m[k])}return g};this.removeAll=function(){return this.ranges.splice(0,this.ranges.length)};this.attach=function(g){if(this.session){this.detach()}this.session=g;this.onChange=this.$onChange.bind(this);this.session.on("change",this.onChange)};this.detach=function(){if(!this.session){return}this.session.removeListener("change",this.onChange);this.session=null};this.$onChange=function(s){var l=s.data.range;if(s.data.action[0]=="i"){var j=l.start;var m=l.end}else{var m=l.start;var j=l.end}var u=j.row;var o=m.row;var t=o-u;var q=-j.column+m.column;var h=this.ranges;for(var p=0,k=h.length;p<k;p++){var g=h[p];if(g.end.row<u){continue}if(g.start.row>u){break}if(g.start.row==u&&g.start.column>=j.column){if(g.start.column==j.column&&this.$insertRight){}else{g.start.column+=q;g.start.row+=t}}if(g.end.row==u&&g.end.column>=j.column){if(g.end.column==j.column&&this.$insertRight){continue}if(g.end.column==j.column&&q>0&&p<k-1){if(g.end.column>g.start.column&&g.end.column==h[p+1].start.column){g.end.column-=q}}g.end.column+=q;g.end.row+=t}}if(t!=0&&p<k){for(;p<k;p++){var g=h[p];g.start.row+=t;g.end.row+=t}}}}).call(a.prototype);b.RangeList=a});