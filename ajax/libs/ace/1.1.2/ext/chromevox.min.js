define(function(ah,H,au){var x={};x.SpeechProperty;x.Cursor;x.Token;x.Annotation;var O={rate:0.8,pitch:0.4,volume:0.9};var Q={rate:1,pitch:0.5,volume:0.9};var p={rate:0.8,pitch:0.8,volume:0.9};var r={rate:0.8,pitch:0.3,volume:0.9};var c={rate:0.8,pitch:0.7,volume:0.9};var ao={rate:0.8,pitch:0.8,volume:0.9};var ax={punctuationEcho:"none",relativePitch:-0.6};var am="ALERT_NONMODAL";var u="ALERT_MODAL";var d="INVALID_KEYPRESS";var ac="insertMode";var J="start";var ad=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}];var o={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"};var aq="CONTROL + SHIFT ";x.editor=null;var Y=null;var a={};var V=false;var M=false;var ay=false;var B=null;var ap={};var X={};var al=function(az){return aq+String.fromCharCode(az)};var m=function(){var az=x.editor.keyBinding.getKeyboardHandler();return az.$id==="ace/keyboard/vim"};var aw=function(az){return x.editor.getSession().getTokenAt(az.row,az.column+1)};var aj=function(az){return x.editor.getSession().getLine(az.row)};var U=function(az){if(a[az.row]){cvox.Api.playEarcon(am)}if(V){cvox.Api.stop();q(az);Z(aw(az));D(az.row,1)}else{D(az.row,0)}};var K=function(aD){var az=aj(aD);var aA=az.substr(aD.column-1);if(aD.column===0){aA=" "+az}var aB=/^\W(\w+)/;var aC=aB.exec(aA);return aC!==null};var l={constant:{prop:O},entity:{prop:p},keyword:{prop:r},storage:{prop:c},variable:{prop:ao},meta:{prop:Q,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}};var i={prop:i};var S=function(aD,aB){var aE=aD;for(var aA=0;aA<aB.length;aA++){var az=aB[aA];var aC=new RegExp(az.substr,"g");aE=aE.replace(aC,az.newSubstr)}return aE};var s=function(aC,aD,az){var aB={};aB.value="";aB.type=aC[aD].type;for(var aA=aD;aA<az;aA++){aB.value+=aC[aA].value}return aB};var g=function(aA){if(aA.length<=1){return aA}var aC=[];var aB=0;for(var az=1;az<aA.length;az++){var aE=aA[aB];var aD=aA[az];if(y(aE)!==y(aD)){aC.push(s(aA,aB,az));aB=az}}aC.push(s(aA,aB,aA.length));return aC};var k=function(aB){var az=x.editor.getSession().getLine(aB);var aA=/^\s*$/;return aA.exec(az)!==null};var D=function(aC,az){var aB=x.editor.getSession().getTokens(aC);if(aB.length===0||k(aC)){cvox.Api.playEarcon("EDITABLE_TEXT");return}aB=g(aB);var aA=aB[0];aB=aB.filter(function(aD){return aD!==aA});R(aA,az);aB.forEach(Z)};var G=function(az){R(az,0)};var Z=function(az){R(az,1)};var y=function(aA){if(!aA||!aA.type){return}var az=aA.type.split(".");if(az.length===0){return}var aB=az[0];var aC=l[aB];if(!aC){return i}return aC};var R=function(aA,az){var aC=y(aA);var aB=S(aA.value,ad);if(aC.replace){aB=S(aB,aC.replace)}cvox.Api.speak(aB,az,aC.prop)};var q=function(aA){var az=aj(aA);cvox.Api.speak(az[aA.column],1)};var ai=function(aC,aA){var az=aj(aA);var aB=az.substring(aC.column,aA.column);aB=aB.replace(/ /g," space ");cvox.Api.speak(aB)};var N=function(aB,aA){if(Math.abs(aB.column-aA.column)!==1){var az=aj(aA).length;if(aA.column===0||aA.column===az){D(aA.row,0);return}if(K(aA)){cvox.Api.stop();Z(aw(aA));return}}q(aA)};var P=function(aA,az){if(!x.editor.selection.isEmpty()){ai(aA,az);cvox.Api.speak("selected",1)}else{if(M){ai(aA,az)}else{N(aA,az)}}};var I=function(az){if(ay){ay=false;return}var aA=x.editor.selection.getCursor();if(aA.row!==Y.row){U(aA)}else{P(Y,aA)}Y=aA};var j=function(az){if(x.editor.selection.isEmpty()){cvox.Api.speak("unselected")}};var ak=function(az){var aA=az.data;switch(aA.action){case"removeText":cvox.Api.speak(aA.text,0,ax);ay=true;break;case"insertText":cvox.Api.speak(aA.text,0);ay=true;break}};var f=function(aA){var aB=aA.row;var az=aA.column;return !a[aB]||!a[aB][az]};var ab=function(aC){a={};for(var aB=0;aB<aC.length;aB++){var az=aC[aB];var aD=az.row;var aA=az.column;if(!a[aD]){a[aD]={}}a[aD][aA]=az}};var e=function(az){var aB=x.editor.getSession().getAnnotations();var aA=aB.filter(f);if(aA.length>0){cvox.Api.playEarcon(am)}ab(aB)};var E=function(aA){var az=aA.type+" "+aA.text+" on "+W(aA.row,aA.column);az=az.replace(";","semicolon");cvox.Api.speak(az,1)};var ae=function(aB){var aA=a[aB];for(var az in aA){E(aA[az])}};var W=function(aA,az){return"row "+(aA+1)+" column "+(az+1)};var n=function(){cvox.Api.speak(W(Y.row,Y.column))};var at=function(){for(var az in a){ae(az)}};var ag=function(){if(!m()){return}switch(x.editor.keyBinding.$data.state){case ac:cvox.Api.speak("Insert mode");break;case J:cvox.Api.speak("Command mode");break}};var h=function(){V=!V;if(V){cvox.Api.speak("Speak location on row change enabled.")}else{cvox.Api.speak("Speak location on row change disabled.")}};var aa=function(){M=!M;if(M){cvox.Api.speak("Speak displacement on column changes.")}else{cvox.Api.speak("Speak current character or word on column changes.")}};var w=function(aA){if(aA.ctrlKey&&aA.shiftKey){var az=ap[aA.keyCode];if(az){az.func()}}};var t=function(az,aA){if(!m()){return}var aB=aA.keyBinding.$data.state;if(aB===B){return}switch(aB){case ac:cvox.Api.playEarcon(u);cvox.Api.setKeyEcho(true);break;case J:cvox.Api.playEarcon(u);cvox.Api.setKeyEcho(false);break}B=aB};var b=function(aA){var aB=aA.detail.customCommand;var az=X[aB];if(az){az.func();x.editor.focus()}};var z=function(){var aA=C.map(function(aB){return{desc:aB.desc+al(aB.keyCode),cmd:aB.cmd}});var az=document.querySelector("body");az.setAttribute("contextMenuActions",JSON.stringify(aA));az.addEventListener("ATCustomEvent",b,true)};var F=function(az){if(az.match){D(Y.row,0)}else{cvox.Api.playEarcon(d)}};var av=function(){x.editor.focus()};var C=[{keyCode:49,func:function(){ae(Y.row)},cmd:o.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:at,cmd:o.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:ag,cmd:o.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:h,cmd:o.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:n,cmd:o.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:aa,cmd:o.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:av,cmd:o.FOCUS_TEXT,desc:"Focus text"}];var A=function(){x.editor=editor;editor.getSession().selection.on("changeCursor",I);editor.getSession().selection.on("changeSelection",j);editor.getSession().on("change",ak);editor.getSession().on("changeAnnotation",e);editor.on("changeStatus",t);editor.on("findSearchBox",F);editor.container.addEventListener("keydown",w);Y=editor.selection.getCursor()};var T=function(az){A();C.forEach(function(aA){ap[aA.keyCode]=aA;X[aA.cmd]=aA});az.on("focus",A);if(m()){cvox.Api.setKeyEcho(false)}z()};function v(){return(typeof(cvox)!=="undefined")&&cvox&&cvox.Api}var af=0;var ar=15;function an(az){if(v()){T(az)}else{af++;if(af>=ar){return}window.setTimeout(an,500,az)}}var L=ah("../editor").Editor;ah("../config").defineOptions(L.prototype,"editor",{enableChromevoxEnhancements:{set:function(az){if(az){an(this)}},value:true}})});