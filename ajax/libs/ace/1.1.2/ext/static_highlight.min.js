define(function(f,h,b){var a=f("../edit_session").EditSession;var c=f("../layer/text").Text;var i=f("../requirejs/text!./static.css");var d=f("../config");var g=f("../lib/dom");var e=function(n,k,u){var o=n.className.match(/lang-(\w+)/);var s=k.mode||o&&("ace/mode/"+o[1]);if(!s){return false}var q=k.theme||"ace/theme/textmate";var r="";var l=[];if(n.firstElementChild){var t=0;for(var p=0;p<n.childNodes.length;p++){var j=n.childNodes[p];if(j.nodeType==3){t+=j.data.length;r+=j.data}else{l.push(t,j)}}}else{r=g.getInnerText(n);if(k.trim){r=r.trim()}}e.render(r,s,q,k.firstLineNumber,!k.showGutter,function(y){g.importCssString(y.css,"ace_highlight");n.innerHTML=y.html;var m=n.firstChild.firstChild;for(var v=0;v<l.length;v+=2){var z=y.session.doc.indexToPosition(l[v]);var x=l[v+1];var w=m.children[z.row];w&&w.appendChild(x)}u&&u()})};e.render=function(p,n,m,o,j,q){var r=0;var l=a.prototype.$modes;if(typeof m=="string"){r++;d.loadModule(["theme",m],function(s){m=s;--r||k()})}if(typeof n=="string"){r++;d.loadModule(["mode",n],function(s){if(!l[n]){l[n]=new s.Mode()}n=l[n];--r||k()})}function k(){var s=e.renderSync(p,n,m,o,j);return q?q(s):s}return r||k()};e.renderSync=function(t,q,o,r,m){r=parseInt(r||1,10);var s=new a("");s.setUseWorker(false);s.setMode(q);var j=new c(document.createElement("div"));j.setSession(s);j.config={characterWidth:10,lineHeight:20};s.setValue(t);var k=[];var l=s.getLength();for(var n=0;n<l;n++){k.push("<div class='ace_line'>");if(!m){k.push("<span class='ace_gutter ace_gutter-cell' unselectable='on'></span>")}j.$renderLine(k,n,true,false);k.push("\n</div>")}var p="<div class='"+o.cssClass+"'><div class='ace_static_highlight' style='counter-reset:ace_line "+(r-1)+"'>"+k.join("")+"</div></div>";j.destroy();return{css:i+o.cssText,html:p,session:s}};b.exports=e;b.exports.highlight=e});