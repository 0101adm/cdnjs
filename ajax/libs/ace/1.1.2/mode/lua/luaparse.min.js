define(function(b,a,c){(function(d,f,e){e(a)}(this,"luaparse",function(S){S.version="0.1.4";var a1,ad,m;var az=S.defaultOptions={wait:false,comments:true,scope:false,locations:false,ranges:false};var am=1,a0=2,r=4,ai=8,aP=16,s=32,M=64,ak=128,z=256;S.tokenTypes={EOF:am,StringLiteral:a0,Keyword:r,Identifier:ai,NumericLiteral:aP,Punctuator:s,BooleanLiteral:M,NilLiteral:ak,VarargLiteral:z};var aq=S.errors={unexpected:"Unexpected %1 '%2' near '%3'",expected:"'%1' expected near '%2'",expectedToken:"%1 expected near '%2'",unfinishedString:"unfinished string near '%1'",malformedNumber:"malformed number near '%1'"};var aw=S.ast={labelStatement:function(a3){return{type:"LabelStatement",label:a3}},breakStatement:function(){return{type:"BreakStatement"}},gotoStatement:function(a3){return{type:"GotoStatement",label:a3}},returnStatement:function(a3){return{type:"ReturnStatement","arguments":a3}},ifStatement:function(a3){return{type:"IfStatement",clauses:a3}},ifClause:function(a4,a3){return{type:"IfClause",condition:a4,body:a3}},elseifClause:function(a4,a3){return{type:"ElseifClause",condition:a4,body:a3}},elseClause:function(a3){return{type:"ElseClause",body:a3}},whileStatement:function(a4,a3){return{type:"WhileStatement",condition:a4,body:a3}},doStatement:function(a3){return{type:"DoStatement",body:a3}},repeatStatement:function(a4,a3){return{type:"RepeatStatement",condition:a4,body:a3}},localStatement:function(a4,a3){return{type:"LocalStatement",variables:a4,init:a3}},assignmentStatement:function(a4,a3){return{type:"AssignmentStatement",variables:a4,init:a3}},callStatement:function(a3){return{type:"CallStatement",expression:a3}},functionStatement:function(a4,a6,a5,a3){return{type:"FunctionDeclaration",identifier:a4,isLocal:a5,parameters:a6,body:a3}},forNumericStatement:function(a5,a7,a4,a6,a3){return{type:"ForNumericStatement",variable:a5,start:a7,end:a4,step:a6,body:a3}},forGenericStatement:function(a5,a4,a3){return{type:"ForGenericStatement",variables:a5,iterators:a4,body:a3}},chunk:function(a3){return{type:"Chunk",body:a3}},identifier:function(a3){return{type:"Identifier",name:a3}},literal:function(a4,a5,a3){a4=(a4===a0)?"StringLiteral":(a4===aP)?"NumericLiteral":(a4===M)?"BooleanLiteral":(a4===ak)?"NilLiteral":"VarargLiteral";return{type:a4,value:a5,raw:a3}},tableKey:function(a3,a4){return{type:"TableKey",key:a3,value:a4}},tableKeyString:function(a3,a4){return{type:"TableKeyString",key:a3,value:a4}},tableValue:function(a3){return{type:"TableValue",value:a3}},tableConstructorExpression:function(a3){return{type:"TableConstructorExpression",fields:a3}},binaryExpression:function(a3,a6,a4){var a5=("and"===a3||"or"===a3)?"LogicalExpression":"BinaryExpression";return{type:a5,operator:a3,left:a6,right:a4}},unaryExpression:function(a3,a4){return{type:"UnaryExpression",operator:a3,argument:a4}},memberExpression:function(a5,a4,a3){return{type:"MemberExpression",indexer:a4,identifier:a3,base:a5}},indexExpression:function(a4,a3){return{type:"IndexExpression",base:a4,index:a3}},callExpression:function(a4,a3){return{type:"CallExpression",base:a4,"arguments":a3}},tableCallExpression:function(a4,a3){return{type:"TableCallExpression",base:a4,"arguments":a3}},stringCallExpression:function(a4,a3){return{type:"StringCallExpression",base:a4,argument:a3}},comment:function(a4,a3){return{type:"Comment",value:a4,raw:a3}}};function aO(a4){if(J){var a3=aK.pop();a3.complete();if(ad.locations){a4.loc=a3.loc}if(ad.ranges){a4.range=a3.range}}return a4}var w=Array.prototype.slice,av=Object.prototype.toString,o=function o(a6,a4){for(var a3=0,a5=a6.length;a3<a5;a3++){if(a6[a3]===a4){return a3}}return -1};function L(a7,a6,a4){for(var a3=0,a5=a7.length;a3<a5;a3++){if(a7[a3][a6]===a4){return a3}}return -1}function I(a4){var a3=w.call(arguments,1);a4=a4.replace(/%(\d)/g,function(a6,a5){return""+a3[a5-1]||""});return a4}function ag(){var a4=w.call(arguments),a3={},a7,a8;for(var a5=0,a6=a4.length;a5<a6;a5++){a7=a4[a5];for(a8 in a7){if(a7.hasOwnProperty(a8)){a3[a8]=a7[a8]}}}return a3}function Y(a5){var a6=I.apply(null,w.call(arguments,1)),a4,a3;if("undefined"!==typeof a5.line){a3=a5.range[0]-a5.lineStart;a4=new SyntaxError(I("[%1:%2] %3",a5.line,a3,a6));a4.line=a5.line;a4.index=a5.range[0];a4.column=a3}else{a3=aV-aZ+1;a4=new SyntaxError(I("[%1:%2] %3",q,a3,a6));a4.index=aV;a4.line=q;a4.column=a3}throw a4}function a2(a4,a3){Y(a3,aq.expectedToken,a4,a3.value)}function ap(a5,a4){if("undefined"===typeof a4){a4=D.value}if("undefined"!==typeof a5.type){var a3;switch(a5.type){case a0:a3="string";break;case r:a3="keyword";break;case ai:a3="identifier";break;case aP:a3="number";break;case s:a3="symbol";break;case M:a3="boolean";break;case ak:return Y(a5,aq.unexpected,"symbol","nil",a4)}return Y(a5,aq.unexpected,a3,a5.value,a4)}return Y(a5,aq.unexpected,"symbol",a5,a4)}var aV,aB,aC,D,al,aj,q,aZ;S.lex=ac;function ac(){aD();while(45===a1.charCodeAt(aV)&&45===a1.charCodeAt(aV+1)){ae();aD()}if(aV>=m){return{type:am,value:"<eof>",line:q,lineStart:aZ,range:[aV,aV]}}var a3=a1.charCodeAt(aV),a4=a1.charCodeAt(aV+1);aj=aV;if(v(a3)){return aT()}switch(a3){case 39:case 34:return ab();case 48:case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return l();case 46:if(au(a4)){return l()}if(46===a4){if(46===a1.charCodeAt(aV+2)){return aR()}return F("..")}return F(".");case 61:if(61===a4){return F("==")}return F("=");case 62:if(61===a4){return F(">=")}return F(">");case 60:if(61===a4){return F("<=")}return F("<");case 126:if(61===a4){return F("~=")}return Y({},aq.expected,"=","~");case 58:if(58===a4){return F("::")}return F(":");case 91:if(91===a4||61===a4){return V()}return F("[");case 42:case 47:case 94:case 37:case 44:case 123:case 125:case 93:case 40:case 41:case 59:case 35:case 45:case 43:return F(a1.charAt(aV))}return ap(a1.charAt(aV))}function aD(){while(aV<m){var a3=a1.charCodeAt(aV);if(aX(a3)){aV++}else{if(aW(a3)){q++;aZ=++aV}else{break}}}}function aT(){var a4,a3;while(aY(a1.charCodeAt(++aV))){}a4=a1.slice(aj,aV);if(g(a4)){a3=r}else{if("true"===a4||"false"===a4){a3=M;a4=("true"===a4)}else{if("nil"===a4){a3=ak;a4=null}else{a3=ai}}}return{type:a3,value:a4,line:q,lineStart:aZ,range:[aj,aV]}}function F(a3){aV+=a3.length;return{type:s,value:a3,line:q,lineStart:aZ,range:[aj,aV]}}function aR(){aV+=3;return{type:z,value:"...",line:q,lineStart:aZ,range:[aj,aV]}}function ab(){var a4=a1.charCodeAt(aV++),a6=aV,a5="",a3;while(aV<m){a3=a1.charCodeAt(aV++);if(a4===a3){break}if(92===a3){a5+=a1.slice(a6,aV-1)+E();a6=aV}else{if(aV>=m||aW(a3)){a5+=a1.slice(a6,aV-1);Y({},aq.unfinishedString,a5+String.fromCharCode(a3))}}}a5+=a1.slice(a6,aV-1);return{type:a0,value:a5,line:q,lineStart:aZ,range:[aj,aV]}}function V(){var a3=aI();if(false===a3){Y(aB,aq.expected,"[",aB.value)}return{type:a0,value:a3,line:q,lineStart:aZ,range:[aj,aV]}}function l(){var a5=a1.charAt(aV),a3=a1.charAt(aV+1);var a4=("0"===a5&&"xX".indexOf(a3||null)>=0)?K():U();return{type:aP,value:a4,line:q,lineStart:aZ,range:[aj,aV]}}function K(){var a5=0,a4=1,a7=1,a9,a3,a8,a6;a6=aV+=2;if(!aF(a1.charCodeAt(aV))){Y({},aq.malformedNumber,a1.slice(aj,aV))}while(aF(a1.charCodeAt(aV))){aV++}a9=parseInt(a1.slice(a6,aV),16);if("."===a1.charAt(aV)){a3=++aV;while(aF(a1.charCodeAt(aV))){aV++}a5=a1.slice(a3,aV);a5=(a3===aV)?0:parseInt(a5,16)/Math.pow(16,aV-a3)}if("pP".indexOf(a1.charAt(aV)||null)>=0){aV++;if("+-".indexOf(a1.charAt(aV)||null)>=0){a7=("+"===a1.charAt(aV++))?1:-1}a8=aV;if(!au(a1.charCodeAt(aV))){Y({},aq.malformedNumber,a1.slice(aj,aV))}while(au(a1.charCodeAt(aV))){aV++}a4=a1.slice(a8,aV);a4=Math.pow(2,a4*a7)}return(a9+a5)*a4}function U(){while(au(a1.charCodeAt(aV))){aV++}if("."===a1.charAt(aV)){aV++;while(au(a1.charCodeAt(aV))){aV++}}if("eE".indexOf(a1.charAt(aV)||null)>=0){aV++;if("+-".indexOf(a1.charAt(aV)||null)>=0){aV++}if(!au(a1.charCodeAt(aV))){Y({},aq.malformedNumber,a1.slice(aj,aV))}while(au(a1.charCodeAt(aV))){aV++}}return parseFloat(a1.slice(aj,aV))}function E(){var a3=aV;switch(a1.charAt(aV)){case"n":aV++;return"\n";case"r":aV++;return"\r";case"t":aV++;return"\t";case"v":aV++;return"\x0B";case"b":aV++;return"\b";case"f":aV++;return"\f";case"z":aV++;aD();return"";case"x":if(aF(a1.charCodeAt(aV+1))&&aF(a1.charCodeAt(aV+2))){aV+=3;return"\\"+a1.slice(a3,aV)}return"\\"+a1.charAt(aV++);default:if(au(a1.charCodeAt(aV))){while(au(a1.charCodeAt(++aV))){}return"\\"+a1.slice(a3,aV)}return a1.charAt(aV++)}}function ae(){aj=aV;aV+=2;var a6=a1.charAt(aV),a5="",a8=false,a9=aV,a3=aZ,a7=q;if("["===a6){a5=aI();if(false===a5){a5=a6}else{a8=true}}if(!a8){while(aV<m){if(aW(a1.charCodeAt(aV))){break}aV++}if(ad.comments){a5=a1.slice(a9,aV)}}if(ad.comments){var a4=aw.comment(a5,a1.slice(aj,aV));if(ad.locations){a4.loc={start:{line:a7,column:aj-a3},end:{line:q,column:aV-aZ}}}if(ad.ranges){a4.range=[aj,aV]}al.push(a4)}}function aI(){var a8=0,a6="",a3=false,a7,a4;aV++;while("="===a1.charAt(aV+a8)){a8++}if("["!==a1.charAt(aV+a8)){return false}aV+=a8+1;if(aW(a1.charCodeAt(aV))){q++;aZ=aV++}a4=aV;while(aV<m){a7=a1.charAt(aV++);if(aW(a7.charCodeAt(0))){q++;aZ=aV}if("]"===a7){a3=true;for(var a5=0;a5<a8;a5++){if("="!==a1.charAt(aV+a5)){a3=false}}if("]"!==a1.charAt(aV+a8)){a3=false}}if(a3){break}}a6+=a1.slice(a4,aV-1);aV+=a8+1;return a6}function ah(){aC=aB;aB=D;D=ac()}function f(a3){if(a3===aB.value){ah();return true}return false}function t(a3){if(a3===aB.value){ah()}else{Y(aB,aq.expected,a3,aB.value)}}function aX(a3){return 9===a3||32===a3||11===a3||12===a3}function aW(a3){return 10===a3||13===a3}function au(a3){return a3>=48&&a3<=57}function aF(a3){return(a3>=48&&a3<=57)||(a3>=97&&a3<=102)||(a3>=65&&a3<=70)}function v(a3){return(a3>=65&&a3<=90)||(a3>=97&&a3<=122)||95===a3}function aY(a3){return(a3>=65&&a3<=90)||(a3>=97&&a3<=122)||95===a3||(a3>=48&&a3<=57)}function g(a3){switch(a3.length){case 2:return"do"===a3||"if"===a3||"in"===a3||"or"===a3;case 3:return"and"===a3||"end"===a3||"for"===a3||"not"===a3;case 4:return"else"===a3||"goto"===a3||"then"===a3;case 5:return"break"===a3||"local"===a3||"until"===a3||"while"===a3;case 6:return"elseif"===a3||"repeat"===a3||"return"===a3;case 8:return"function"===a3}return false}function aU(a3){if(s===a3.type){return"#-".indexOf(a3.value)>=0}if(r===a3.type){return"not"===a3.value}return false}function aS(a3){switch(a3.type){case"CallExpression":case"TableCallExpression":case"StringCallExpression":return true}return false}function k(a3){if(am===a3.type){return true}if(r!==a3.type){return false}switch(a3.value){case"else":case"elseif":case"end":case"until":return true;default:return false}}var at,aH,aN;function aL(){at.push(Array.apply(null,at[aH++]))}function P(){at.pop();aH--}function Z(a3){if(-1!==o(at[aH],a3)){return}at[aH].push(a3)}function T(a3){Z(a3.name);af(a3,true)}function af(a4,a3){if(!a3&&-1===L(aN,"name",a4.name)){aN.push(a4)}a4.isLocal=a3}function H(a3){return(-1!==o(at[aH],a3))}var aK=[],J;function ay(){return new G(aB)}function G(a3){if(ad.locations){this.loc={start:{line:a3.line,column:a3.range[0]-a3.lineStart},end:{line:0,column:0}}}if(ad.ranges){this.range=[a3.range[0],0]}}G.prototype.complete=function(){if(ad.locations){this.loc.end.line=aC.line;this.loc.end.column=aC.range[1]-aC.lineStart}if(ad.ranges){this.range[1]=aC.range[1]}};function aJ(){if(J){aK.push(ay())}}function X(a3){if(J){aK.push(a3)}}function p(){ah();aJ();var a3=O();if(am!==aB.type){ap(aB)}if(J&&!a3.length){aC=aB}return aO(aw.chunk(a3))}function O(a3){var a5=[],a4;if(ad.scope){aL()}while(!k(aB)){if("return"===aB.value){a5.push(N());break}a4=N();if(a4){a5.push(a4)}}if(ad.scope){P()}return a5}function N(){aJ();if(r===aB.type){switch(aB.value){case"local":ah();return i();case"if":ah();return u();case"return":ah();return ax();case"function":ah();var a3=A();return aa(a3);case"while":ah();return B();case"for":ah();return aM();case"repeat":ah();return aA();case"break":ah();return e();case"do":ah();return j();case"goto":ah();return C()}}if(s===aB.type){if(f("::")){return an()}}if(J){aK.pop()}if(f(";")){return}return W()}function an(){var a4=aB.value,a3=x();if(ad.scope){Z("::"+a4+"::");af(a3,true)}t("::");return aO(aw.labelStatement(a3))}function e(){return aO(aw.breakStatement())}function C(){var a4=aB.value,a3=x();if(ad.scope){a3.isLabel=H("::"+a4+"::")}return aO(aw.gotoStatement(a3))}function j(){var a3=O();t("end");return aO(aw.doStatement(a3))}function B(){var a4=ar();t("do");var a3=O();t("end");return aO(aw.whileStatement(a4,a3))}function aA(){var a3=O();t("until");var a4=ar();return aO(aw.repeatStatement(a4,a3))}function ax(){var a3=[];if("end"!==aB.value){var a4=R();if(null!=a4){a3.push(a4)}while(f(",")){a4=ar();a3.push(a4)}f(";")}return aO(aw.returnStatement(a3))}function u(){var a5=[],a6,a3,a4;if(J){a4=aK[aK.length-1];aK.push(a4)}a6=ar();t("then");a3=O();a5.push(aO(aw.ifClause(a6,a3)));if(J){a4=ay()}while(f("elseif")){X(a4);a6=ar();t("then");a3=O();a5.push(aO(aw.elseifClause(a6,a3)));if(J){a4=ay()}}if(f("else")){if(J){a4=new G(aC);aK.push(a4)}a3=O();a5.push(aO(aw.elseClause(a3)))}t("end");return aO(aw.ifStatement(a5))}function aM(){var a5=x(),a3;if(ad.scope){T(a5)}if(f("=")){var ba=ar();t(",");var a4=ar();var a7=f(",")?ar():null;t("do");a3=O();t("end");return aO(aw.forNumericStatement(a5,ba,a4,a7,a3))}else{var a9=[a5];while(f(",")){a5=x();if(ad.scope){T(a5)}a9.push(a5)}t("in");var a6=[];do{var a8=ar();a6.push(a8)}while(f(","));t("do");a3=O();t("end");return aO(aw.forGenericStatement(a9,a6,a3))}}function i(){var a4;if(ai===aB.type){var a8=[],a7=[];do{a4=x();a8.push(a4)}while(f(","));if(f("=")){do{var a6=ar();a7.push(a6)}while(f(","))}if(ad.scope){for(var a5=0,a3=a8.length;a5<a3;a5++){T(a8[a5])}}return aO(aw.localStatement(a8,a7))}if(f("function")){a4=x();if(ad.scope){T(a4)}return aa(a4,true)}else{a2("<name>",aB)}}function W(){var a4=aB,a7,a3;if(J){a3=ay()}a7=h();if(null==a7){return ap(aB)}if(",=".indexOf(aB.value)>=0){var a8=[a7],a6=[],a5;while(f(",")){a5=h();if(null==a5){a2("<expression>",aB)}a8.push(a5)}t("=");do{a5=ar();a6.push(a5)}while(f(","));X(a3);return aO(aw.assignmentStatement(a8,a6))}if(aS(a7)){X(a3);return aO(aw.callStatement(a7))}return ap(a4)}function x(){aJ();var a3=aB.value;if(ai!==aB.type){a2("<name>",aB)}ah();return aO(aw.identifier(a3))}function aa(a4,a6){var a5=[];t("(");if(!f(")")){while(true){if(ai===aB.type){var a7=x();if(ad.scope){T(a7)}a5.push(a7);if(f(",")){continue}else{if(f(")")){break}}}else{if(z===aB.type){a5.push(d());t(")");break}else{a2("<name> or '...'",aB)}}}}var a3=O();t("end");a6=a6||false;return aO(aw.functionStatement(a4,a5,a6,a3))}function A(){var a5,a4,a3;if(J){a3=ay()}a5=x();if(ad.scope){af(a5,false)}while(f(".")){X(a3);a4=x();if(ad.scope){af(a4,false)}a5=aO(aw.memberExpression(a5,".",a4))}if(f(":")){X(a3);a4=x();if(ad.scope){af(a4,false)}a5=aO(aw.memberExpression(a5,":",a4))}return a5}function y(){var a3=[],a4,a5;while(true){aJ();if(s===aB.type&&f("[")){a4=ar();t("]");t("=");a5=ar();a3.push(aO(aw.tableKey(a4,a5)))}else{if(ai===aB.type){a4=ar();if(f("=")){a5=ar();a3.push(aO(aw.tableKeyString(a4,a5)))}else{a3.push(aO(aw.tableValue(a4)))}}else{if(null==(a5=R())){aK.pop();break}a3.push(aO(aw.tableValue(a5)))}}if(",;".indexOf(aB.value)>=0){ah();continue}if("}"===aB.value){break}}t("}");return aO(aw.tableConstructorExpression(a3))}function R(){var a3=aE(0);return a3}function ar(){var a3=R();if(null==a3){a2("<expression>",aB)}else{return a3}}function aG(a4){var a3=a4.charCodeAt(0),a5=a4.length;if(1===a5){switch(a3){case 94:return 10;case 42:case 47:case 37:return 7;case 43:case 45:return 6;case 60:case 62:return 3}}else{if(2===a5){switch(a3){case 46:return 5;case 60:case 62:case 61:case 126:return 3;case 111:return 1}}else{if(97===a3&&"and"===a4){return 2}}}return 0}function aE(a9){var a5=aB.value,a8,a4;if(J){a4=ay()}if(aU(aB)){aJ();ah();var a7=aE(8);if(a7==null){a2("<expression>",aB)}a8=aO(aw.unaryExpression(a5,a7))}if(null==a8){a8=d();if(null==a8){a8=h()}}if(null==a8){return null}var a3;while(true){a5=aB.value;a3=(s===aB.type||r===aB.type)?aG(a5):0;if(a3===0||a3<=a9){break}if("^"===a5||".."===a5){a3--}ah();var a6=aE(a3);if(null==a6){a2("<expression>",aB)}if(J){aK.push(a4)}a8=aO(aw.binaryExpression(a5,a8,a6))}return a8}function h(){var a7,a5,a3,a6;if(J){a3=ay()}if(ai===aB.type){a5=aB.value;a7=x();if(ad.scope){af(a7,a6=H(a5))}}else{if(f("(")){a7=ar();t(")");if(ad.scope){a6=a7.isLocal}}else{return null}}var a8,a4;while(true){if(s===aB.type){switch(aB.value){case"[":X(a3);ah();a8=ar();a7=aO(aw.indexExpression(a7,a8));t("]");break;case".":X(a3);ah();a4=x();if(ad.scope){af(a4,a6)}a7=aO(aw.memberExpression(a7,".",a4));break;case":":X(a3);ah();a4=x();if(ad.scope){af(a4,a6)}a7=aO(aw.memberExpression(a7,":",a4));X(a3);a7=n(a7);break;case"(":case"{":X(a3);a7=n(a7);break;default:return a7}}else{if(a0===aB.type){X(a3);a7=n(a7)}else{break}}}return a7}function n(a5){if(s===aB.type){switch(aB.value){case"(":ah();var a4=[];var a6=R();if(null!=a6){a4.push(a6)}while(f(",")){a6=ar();a4.push(a6)}t(")");return aO(aw.callExpression(a5,a4));case"{":aJ();ah();var a3=y();return aO(aw.tableCallExpression(a5,a3))}}else{if(a0===aB.type){return aO(aw.stringCallExpression(a5,d()))}}a2("function arguments",aB)}function d(){var a7=a0|aP|M|ak|z,a6=aB.value,a5=aB.type,a3;if(J){a3=ay()}if(a5&a7){X(a3);var a4=a1.slice(aB.range[0],aB.range[1]);ah();return aO(aw.literal(a5,a6,a4))}else{if(r===a5&&"function"===a6){X(a3);ah();return aa(null)}else{if(f("{")){X(a3);return y()}}}}S.parse=ao;function ao(a4,a3){if("undefined"===typeof a3&&"object"===typeof a4){a3=a4;a4=undefined}if(!a3){a3={}}a1=a4||"";ad=ag(az,a3);aV=0;q=1;aZ=0;m=a1.length;at=[[]];aH=0;aN=[];aK=[];if(ad.comments){al=[]}if(!ad.wait){return Q()}return S}S.write=aQ;function aQ(a3){a1+=String(a3);m=a1.length;return S}S.end=Q;function Q(a4){if("undefined"!==typeof a4){aQ(a4)}m=a1.length;J=ad.locations||ad.ranges;D=ac();var a3=p();if(ad.comments){a3.comments=al}if(ad.scope){a3.globals=aN}if(aK.length>0){throw new Error("Location tracking failed. This is most likely a bug in luaparse")}return a3}}))});