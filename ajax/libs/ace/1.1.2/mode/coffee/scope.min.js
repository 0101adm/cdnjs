define(function(c,b,d){var a,g,e,f;f=c("./helpers"),g=f.extend,e=f.last;b.Scope=a=(function(){h.root=null;function h(i,j,k){this.parent=i;this.expressions=j;this.method=k;this.variables=[{name:"arguments",type:"arguments"}];this.positions={};if(!this.parent){h.root=this}}h.prototype.add=function(j,k,i){if(this.shared&&!i){return this.parent.add(j,k,i)}if(Object.prototype.hasOwnProperty.call(this.positions,j)){return this.variables[this.positions[j]].type=k}else{return this.positions[j]=this.variables.push({name:j,type:k})-1}};h.prototype.namedMethod=function(){var i;if(((i=this.method)!=null?i.name:void 0)||!this.parent){return this.method}return this.parent.namedMethod()};h.prototype.find=function(i){if(this.check(i)){return true}this.add(i,"var");return false};h.prototype.parameter=function(i){if(this.shared&&this.parent.check(i,true)){return}return this.add(i,"param")};h.prototype.check=function(j){var i;return !!(this.type(j)||((i=this.parent)!=null?i.check(j):void 0))};h.prototype.temporary=function(j,i){if(j.length>1){return"_"+j+(i>1?i-1:"")}else{return"_"+(i+parseInt(j,36)).toString(36).replace(/\d/g,"a")}};h.prototype.type=function(l){var k,m,j,i;i=this.variables;for(m=0,j=i.length;m<j;m++){k=i[m];if(k.name===l){return k.type}}return null};h.prototype.freeVariable=function(l,j){var k,i;if(j==null){j=true}k=0;while(this.check((i=this.temporary(l,k)))){k++}if(j){this.add(i,"var",true)}return i};h.prototype.assign=function(i,j){this.add(i,{value:j,assigned:true},true);return this.hasAssignments=true};h.prototype.hasDeclarations=function(){return !!this.declaredVariables().length};h.prototype.declaredVariables=function(){var m,n,k,l,j,i;m=[];n=[];i=this.variables;for(l=0,j=i.length;l<j;l++){k=i[l];if(k.type==="var"){(k.name.charAt(0)==="_"?n:m).push(k.name)}}return m.sort().concat(n.sort())};h.prototype.assignedVariables=function(){var l,m,k,i,j;i=this.variables;j=[];for(m=0,k=i.length;m<k;m++){l=i[m];if(l.type.assigned){j.push(""+l.name+" = "+l.type.value)}}return j};return h})()});