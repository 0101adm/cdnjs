define(function(b,e,a){var m=b("./XQueryTokenizer").XQueryTokenizer;var k=function(p){var o=p;this.tokens=[];this.reset=function(q){o=o;this.tokens=[]};this.startNonterminal=function(q,r){};this.endNonterminal=function(r,q){};this.terminal=function(r,s,q){this.tokens.push({name:r,value:o.substring(s,q)})};this.whitespace=function(r,q){this.tokens.push({name:"WS",value:o.substring(r,q)})}};var n="after|ancestor|ancestor-or-self|and|as|ascending|attribute|before|case|cast|castable|child|collation|comment|copy|count|declare|default|delete|descendant|descendant-or-self|descending|div|document|document-node|element|else|empty|empty-sequence|end|eq|every|except|first|following|following-sibling|for|function|ge|group|gt|idiv|if|import|insert|instance|intersect|into|is|item|last|le|let|lt|mod|modify|module|namespace|namespace-node|ne|node|only|or|order|ordered|parent|preceding|preceding-sibling|processing-instruction|rename|replace|return|satisfies|schema-attribute|schema-element|self|some|stable|start|switch|text|to|treat|try|typeswitch|union|unordered|validate|where|with|xquery|contains|paragraphs|sentences|times|words|by|collectionreturn|variable|version|option|when|encoding|toswitch|catch|tumbling|sliding|window|at|using|stemming|collection|schema|while|on|nodes|index|external|then|in|updating|value|of|containsbreak|loop|continue|exit|returning|append|json|position|strict".split("|");var g=n.map(function(o){return{name:"'"+o+"'",token:"keyword"}});var i=n.map(function(o){return{name:"'"+o+"'",token:"text",next:function(p){p.pop()}}});var l="constant.language";var c="constant";var h="comment";var f="xml-pe";var d="constant.buildin";var j={start:[{name:"'(#'",token:d,next:function(o){o.push("Pragma")}},{name:"'(:'",token:"comment",next:function(o){o.push("Comment")}},{name:"'(:~'",token:"comment.doc",next:function(o){o.push("CommentDoc")}},{name:"'<!--'",token:h,next:function(o){o.push("XMLComment")}},{name:"'<?'",token:f,next:function(o){o.push("PI")}},{name:"''''",token:"string",next:function(o){o.push("AposString")}},{name:"'\"'",token:"string",next:function(o){o.push("QuotString")}},{name:"Annotation",token:"support.function"},{name:"ModuleDecl",token:"keyword",next:function(o){o.push("Prefix")}},{name:"OptionDecl",token:"keyword",next:function(o){o.push("_EQName")}},{name:"AttrTest",token:"support.type"},{name:"Variable",token:"variable"},{name:"'<![CDATA['",token:l,next:function(o){o.push("CData")}},{name:"IntegerLiteral",token:c},{name:"DecimalLiteral",token:c},{name:"DoubleLiteral",token:c},{name:"Operator",token:"keyword.operator"},{name:"EQName",token:function(o){return n.indexOf(o)!==-1?"keyword":"support.function"}},{name:"'('",token:"lparen"},{name:"')'",token:"rparen"},{name:"Tag",token:"meta.tag",next:function(o){o.push("StartTag")}},{name:"'}'",token:"text",next:function(o){if(o.length>1){o.pop()}}},{name:"'{'",token:"text",next:function(o){o.push("start")}}].concat(g),_EQName:[{name:"EQName",token:"text",next:function(o){o.pop()}}].concat(i),Prefix:[{name:"NCName",token:"text",next:function(o){o.pop()}}].concat(i),StartTag:[{name:"'>'",token:"meta.tag",next:function(o){o.push("TagContent")}},{name:"QName",token:"entity.other.attribute-name"},{name:"'='",token:"text"},{name:"''''",token:"string",next:function(o){o.push("AposAttr")}},{name:"'\"'",token:"string",next:function(o){o.push("QuotAttr")}},{name:"'/>'",token:"meta.tag.r",next:function(o){o.pop()}}],TagContent:[{name:"ElementContentChar",token:"text"},{name:"'<![CDATA['",token:l,next:function(o){o.push("CData")}},{name:"'<!--'",token:h,next:function(o){o.push("XMLComment")}},{name:"Tag",token:"meta.tag",next:function(o){o.push("StartTag")}},{name:"PredefinedEntityRef",token:"constant.language.escape"},{name:"CharRef",token:"constant.language.escape"},{name:"'{{'",token:"text"},{name:"'}}'",token:"text"},{name:"'{'",token:"text",next:function(o){o.push("start")}},{name:"EndTag",token:"meta.tag",next:function(o){o.pop();o.pop()}}],AposAttr:[{name:"''''",token:"string",next:function(o){o.pop()}},{name:"EscapeApos",token:"constant.language.escape"},{name:"AposAttrContentChar",token:"string"},{name:"PredefinedEntityRef",token:"constant.language.escape"},{name:"CharRef",token:"constant.language.escape"},{name:"'{{'",token:"string"},{name:"'}}'",token:"string"},{name:"'{'",token:"text",next:function(o){o.push("start")}}],QuotAttr:[{name:"'\"'",token:"string",next:function(o){o.pop()}},{name:"EscapeQuot",token:"constant.language.escape"},{name:"QuotAttrContentChar",token:"string"},{name:"PredefinedEntityRef",token:"constant.language.escape"},{name:"CharRef",token:"constant.language.escape"},{name:"'{{'",token:"string"},{name:"'}}'",token:"string"},{name:"'{'",token:"text",next:function(o){o.push("start")}}],Pragma:[{name:"PragmaContents",token:d},{name:"'#'",token:d},{name:"'#)'",token:d,next:function(o){o.pop()}}],Comment:[{name:"CommentContents",token:"comment"},{name:"'(:'",token:"comment",next:function(o){o.push("Comment")}},{name:"':)'",token:"comment",next:function(o){o.pop()}}],CommentDoc:[{name:"DocCommentContents",token:"comment.doc"},{name:"DocTag",token:"comment.doc.tag"},{name:"'(:'",token:"comment.doc",next:function(o){o.push("CommentDoc")}},{name:"':)'",token:"comment.doc",next:function(o){o.pop()}}],XMLComment:[{name:"DirCommentContents",token:h},{name:"'-->'",token:h,next:function(o){o.pop()}}],CData:[{name:"CDataSectionContents",token:l},{name:"']]>'",token:l,next:function(o){o.pop()}}],PI:[{name:"DirPIContents",token:f},{name:"'?'",token:f},{name:"'?>'",token:f,next:function(o){o.pop()}}],AposString:[{name:"''''",token:"string",next:function(o){o.pop()}},{name:"PredefinedEntityRef",token:"constant.language.escape"},{name:"CharRef",token:"constant.language.escape"},{name:"EscapeApos",token:"constant.language.escape"},{name:"AposChar",token:"string"}],QuotString:[{name:"'\"'",token:"string",next:function(o){o.pop()}},{name:"PredefinedEntityRef",token:"constant.language.escape"},{name:"CharRef",token:"constant.language.escape"},{name:"EscapeQuot",token:"constant.language.escape"},{name:"QuotChar",token:"string"}]};e.XQueryLexer=function(){this.tokens=[];this.getLineTokens=function(y,q,s){q=(q==="start"||!q)?'["start"]':q;var t=JSON.parse(q);var H=new k(y);var C=new m(y,H);var A=[];while(true){var L=t[t.length-1];try{H.tokens=[];C["parse_"+L]();var J=null;if(H.tokens.length>1&&H.tokens[0].name==="WS"){A.push({type:"text",value:H.tokens[0].value});H.tokens.splice(0,1)}var w=H.tokens[0];var x=j[L];for(var E=0;E<x.length;E++){var u=j[L][E];if((typeof(u.name)==="function"&&u.name(w))||u.name===w.name){J=u;break}}if(w.name==="EOF"){break}if(w.value===""){throw"Encountered empty string lexical rule."}A.push({type:J===null?"text":(typeof(J.token)==="function"?J.token(w.value):J.token),value:w.value});if(J&&J.next){J.next(t)}}catch(I){if(I instanceof C.ParseException){var v=0;for(var G=0;G<A.length;G++){v+=A[G].value.length}A.push({type:"text",value:y.substring(v)});return{tokens:A,state:JSON.stringify(["start"])}}else{throw I}}}if(this.tokens[s]!==undefined){var p=this.lines[s];var K=o([y,p]);var z=p.length-y.length;var B=0;var r=0;for(var G=0;G<A.length;G++){var w=A[G];for(var F=0;F<this.tokens[s].length;F++){var D=this.tokens[s][F];if(((r+w.value.length)<=K.length&&D.sc===r&&D.ec===(r+w.value.length))||(D.sc===(r+z)&&D.ec===(r+w.value.length+z))){B=G;A[G].type=D.type}}r+=w.value.length}}return{tokens:A,state:JSON.stringify(t)}};function o(p){var t,r,q,p=p.slice(0).sort();t=p[0];q=t.length;r=p.pop();while(q&&r.indexOf(t)==-1){t=t.substring(0,--q)}return t}}});