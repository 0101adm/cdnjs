define(function(b,a,c){var d=a.JSONParseTreeHandler=function(h){var l=["OrExpr","AndExpr","ComparisonExpr","StringConcatExpr","RangeExpr","UnionExpr","IntersectExceptExpr","InstanceofExpr","TreatExpr","CastableExpr","CastExpr","UnaryExpr","ValueExpr","FTContainsExpr","SimpleMapExpr","PathExpr","RelativePathExpr","PostfixExpr","StepExpr"];var f=null;var e=null;var m=h;var p=0;var n=0;var q=0;var i=0;function o(r){return{name:r,children:[],getParent:null,pos:{sl:0,sc:0,el:0,ec:0}}}function g(r,s){var t=o(r);if(f===null){f=t;e=t}else{t.getParent=e;e.children.push(t);e=e.children[e.children.length-1]}}function k(){if(e.children.length>0){var t=e.children[0];var v=null;for(var r=e.children.length-1;r>=0;r--){v=e.children[r];if(v.pos.el!==0||v.pos.ec!==0){break}}e.pos.sl=t.pos.sl;e.pos.sc=t.pos.sc;e.pos.el=v.pos.el;e.pos.ec=v.pos.ec}if(e.name==="FunctionName"){e.name="EQName"}if(e.name==="EQName"&&e.value===undefined){e.value=e.children[0].value;e.children.pop()}if(e.getParent!==null){e=e.getParent}else{}if(e.children.length>0){var u=e.children[e.children.length-1];if(u.children.length===1&&l.indexOf(u.name)!==-1){e.children[e.children.length-1]=u.children[0]}}}this.closeParseTree=function(){while(e.getParent!==null){k()}k()};this.peek=function(){return e};this.getParseTree=function(){return f};this.reset=function(r){};this.startNonterminal=function(r,s){g(r,s)};this.endNonterminal=function(s,r){k()};this.terminal=function(s,t,r){s=(s.substring(0,1)==="'"&&s.substring(s.length-1)==="'")?"TOKEN":s;g(s,t);j(e,t,r);k()};this.whitespace=function(t,r){var s="WS";g(s,t);j(e,t,r);k()};function j(t,s,v){var x=v-p;e.value=m.substring(0,x);m=m.substring(x);p=v;var u=q;var y=n;var r=u+e.value.split("\n").length-1;var z=e.value.lastIndexOf("\n");var w=z===-1?y+e.value.length:e.value.substring(z+1).length;q=r;n=w;e.pos.sl=u;e.pos.sc=y;e.pos.el=r;e.pos.ec=w}}});