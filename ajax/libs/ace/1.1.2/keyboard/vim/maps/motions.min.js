define(function(g,h,c){var i=g("./util");var b=function(q,p){var r=q.renderer.getScrollTopRow();var t=q.getCursorPosition().row;var s=t-r;p&&p.call(q);q.renderer.scrollToRow(q.getCursorPosition().row-s)};function d(p){if(typeof p=="function"){var q=p;p=this}else{var q=p.getPos}p.nav=function(t,s,u,v){var r=q(t,s,u,v,false);if(!r){return}t.clearSelection();t.moveCursorTo(r.row,r.column)};p.sel=function(t,s,u,v){var r=q(t,s,u,v,true);if(!r){return}t.selection.selectTo(r.row,r.column)};return p}var j=/[\s.\/\\()\"'-:,.;<>~!@#$%^&*|+=\[\]{}`~?]/;var n=/[.\/\\()\"'-:,.;<>~!@#$%^&*|+=\[\]{}`~?]/;var a=/\s/;var l=function(q,s){var r=q.selection;this.range=r.getRange();s=s||r.selectionLead;this.row=s.row;this.col=s.column;var p=q.session.getLine(this.row);var t=q.session.getLength();this.ch=p[this.col]||"\n";this.skippedLines=0;this.next=function(){this.ch=p[++this.col]||this.handleNewLine(1);return this.ch};this.prev=function(){this.ch=p[--this.col]||this.handleNewLine(-1);return this.ch};this.peek=function(u){var v=p[this.col+u];if(v){return v}if(u==-1){return"\n"}if(this.col==p.length-1){return"\n"}return q.session.getLine(this.row+1)[0]||"\n"};this.handleNewLine=function(u){if(u==1){if(this.col==p.length){return"\n"}if(this.row==t-1){return""}this.col=0;this.row++;p=q.session.getLine(this.row);this.skippedLines++;return p[0]||"\n"}if(u==-1){if(this.row===0){return""}this.row--;p=q.session.getLine(this.row);this.col=p.length;this.skippedLines--;return"\n"}};this.debug=function(){console.log(p.substring(0,this.col)+"|"+this.ch+"'"+this.col+"'"+p.substr(this.col+1))}};var f=g("../../../search").Search;var o=new f();function k(q,r,p){o.$options.needle=r;o.$options.backwards=p==-1;return o.find(q.session)}var e=g("../../../range").Range;var m={};c.exports={w:new d(function(p){var q=new l(p);if(q.ch&&n.test(q.ch)){while(q.ch&&n.test(q.ch)){q.next()}}else{while(q.ch&&!j.test(q.ch)){q.next()}}while(q.ch&&a.test(q.ch)&&q.skippedLines<2){q.next()}q.skippedLines==2&&q.prev();return{column:q.col,row:q.row}}),W:new d(function(p){var q=new l(p);while(q.ch&&!(a.test(q.ch)&&!a.test(q.peek(1)))&&q.skippedLines<2){q.next()}if(q.skippedLines==2){q.prev()}else{q.next()}return{column:q.col,row:q.row}}),b:new d(function(p){var q=new l(p);q.prev();while(q.ch&&a.test(q.ch)&&q.skippedLines>-2){q.prev()}if(q.ch&&n.test(q.ch)){while(q.ch&&n.test(q.ch)){q.prev()}}else{while(q.ch&&!j.test(q.ch)){q.prev()}}q.ch&&q.next();return{column:q.col,row:q.row}}),B:new d(function(p){var q=new l(p);q.prev();while(q.ch&&!(!a.test(q.ch)&&a.test(q.peek(-1)))&&q.skippedLines>-2){q.prev()}if(q.skippedLines==-2){q.next()}return{column:q.col,row:q.row}}),e:new d(function(p){var q=new l(p);q.next();while(q.ch&&a.test(q.ch)){q.next()}if(q.ch&&n.test(q.ch)){while(q.ch&&n.test(q.ch)){q.next()}}else{while(q.ch&&!j.test(q.ch)){q.next()}}q.ch&&q.prev();return{column:q.col,row:q.row}}),E:new d(function(p){var q=new l(p);q.next();while(q.ch&&!(!a.test(q.ch)&&a.test(q.peek(1)))){q.next()}return{column:q.col,row:q.row}}),l:{nav:function(q){var s=q.getCursorPosition();var p=s.column;var r=q.session.getLine(s.row).length;if(r&&p!==r){q.navigateRight()}},sel:function(q){var s=q.getCursorPosition();var p=s.column;var r=q.session.getLine(s.row).length;if(r&&p!==r){q.selection.selectRight()}}},h:{nav:function(p){var q=p.getCursorPosition();if(q.column>0){p.navigateLeft()}},sel:function(p){var q=p.getCursorPosition();if(q.column>0){p.selection.selectLeft()}}},H:{nav:function(p){var q=p.renderer.getScrollTopRow();p.moveCursorTo(q)},sel:function(p){var q=p.renderer.getScrollTopRow();p.selection.selectTo(q)}},M:{nav:function(q){var p=q.renderer.getScrollTopRow();var s=q.renderer.getScrollBottomRow();var r=p+((s-p)/2);q.moveCursorTo(r)},sel:function(q){var p=q.renderer.getScrollTopRow();var s=q.renderer.getScrollBottomRow();var r=p+((s-p)/2);q.selection.selectTo(r)}},L:{nav:function(p){var q=p.renderer.getScrollBottomRow();p.moveCursorTo(q)},sel:function(p){var q=p.renderer.getScrollBottomRow();p.selection.selectTo(q)}},k:{nav:function(p){p.navigateUp()},sel:function(p){p.selection.selectUp()}},j:{nav:function(p){p.navigateDown()},sel:function(p){p.selection.selectDown()}},i:{param:true,sel:function(r,q,s,u){switch(u){case"w":r.selection.selectWord();break;case"W":r.selection.selectAWord();break;case"(":case"{":case"[":var t=r.getCursorPosition();var p=r.session.$findClosingBracket(u,t,/paren/);if(!p){return}var v=r.session.$findOpeningBracket(r.session.$brackets[u],t,/paren/);if(!v){return}v.column++;r.selection.setSelectionRange(e.fromPoints(v,p));break;case"'":case'"':case"/":var p=k(r,u,1);if(!p){return}var v=k(r,u,-1);if(!v){return}r.selection.setSelectionRange(e.fromPoints(v.end,p.start));break}}},a:{param:true,sel:function(r,q,s,u){switch(u){case"w":r.selection.selectAWord();break;case"W":r.selection.selectAWord();break;case"(":case"{":case"[":var t=r.getCursorPosition();var p=r.session.$findClosingBracket(u,t,/paren/);if(!p){return}var v=r.session.$findOpeningBracket(r.session.$brackets[u],t,/paren/);if(!v){return}p.column++;r.selection.setSelectionRange(e.fromPoints(v,p));break;case"'":case'"':case"/":var p=k(r,u,1);if(!p){return}var v=k(r,u,-1);if(!v){return}p.column++;r.selection.setSelectionRange(e.fromPoints(v.start,p.end));break}}},f:new d({param:true,handlesCount:true,getPos:function(t,q,u,w,p,r){if(!r){m={ch:"f",param:w}}var v=t.getCursorPosition();var s=i.getRightNthChar(t,v,w,u||1);if(typeof s==="number"){v.column+=s+(p?2:1);return v}}}),F:new d({param:true,handlesCount:true,getPos:function(t,q,u,w,p,r){if(!r){m={ch:"F",param:w}}var v=t.getCursorPosition();var s=i.getLeftNthChar(t,v,w,u||1);if(typeof s==="number"){v.column-=s+1;return v}}}),t:new d({param:true,handlesCount:true,getPos:function(t,q,u,w,p,r){if(!r){m={ch:"t",param:w}}var v=t.getCursorPosition();var s=i.getRightNthChar(t,v,w,u||1);if(r&&s==0&&!(u>1)){var s=i.getRightNthChar(t,v,w,2)}if(typeof s==="number"){v.column+=s+(p?1:0);return v}}}),T:new d({param:true,handlesCount:true,getPos:function(t,q,u,w,p,r){if(!r){m={ch:"T",param:w}}var v=t.getCursorPosition();var s=i.getLeftNthChar(t,v,w,u||1);if(r&&s==0&&!(u>1)){var s=i.getLeftNthChar(t,v,w,2)}if(typeof s==="number"){v.column-=s;return v}}}),";":new d({handlesCount:true,getPos:function(s,q,t,u,p){var r=m.ch;if(!r){return}return c.exports[r].getPos(s,q,t,m.param,p,true)}}),",":new d({handlesCount:true,getPos:function(t,r,u,v,q){var s=m.ch;if(!s){return}var p=s.toUpperCase();s=s===p?s.toLowerCase():p;return c.exports[s].getPos(t,r,u,m.param,q,true)}}),"^":{nav:function(p){p.navigateLineStart()},sel:function(p){p.selection.selectLineStart()}},"$":{nav:function(p){p.navigateLineEnd()},sel:function(p){p.selection.selectLineEnd()}},"0":new d(function(p){return{row:p.selection.lead.row,column:0}}),G:{nav:function(q,p,r,s){if(!r&&r!==0){r=q.session.getLength()}q.gotoLine(r)},sel:function(q,p,r,s){if(!r&&r!==0){r=q.session.getLength()}q.selection.selectTo(r,0)}},g:{param:true,nav:function(q,p,r,s){switch(s){case"m":console.log("Middle line");break;case"e":console.log("End of prev word");break;case"g":q.gotoLine(r||0);case"u":q.gotoLine(r||0);case"U":q.gotoLine(r||0)}},sel:function(q,p,r,s){switch(s){case"m":console.log("Middle line");break;case"e":console.log("End of prev word");break;case"g":q.selection.selectTo(r||0,0)}}},o:{nav:function(q,p,s,t){s=s||1;var r="";while(0<s--){r+="\n"}if(r.length){q.navigateLineEnd();q.insert(r);i.insertMode(q)}}},O:{nav:function(q,p,s,u){var t=q.getCursorPosition().row;s=s||1;var r="";while(0<s--){r+="\n"}if(r.length){if(t>0){q.navigateUp();q.navigateLineEnd();q.insert(r)}else{q.session.insert({row:0,column:0},r);q.navigateUp()}i.insertMode(q)}}},"%":new d(function(t){var s=/[\[\]{}()]/g;var u=t.getCursorPosition();var r=t.session.getLine(u.row)[u.column];if(!s.test(r)){var p=k(t,s);if(!p){return}u=p.start}var q=t.session.findMatchingBracket({row:u.row,column:u.column+1});return q}),"{":new d(function(p){var q=p.session;var r=q.selection.lead.row;while(r>0&&!/\S/.test(q.getLine(r))){r--}while(/\S/.test(q.getLine(r))){r--}return{column:0,row:r}}),"}":new d(function(q){var r=q.session;var p=r.getLength();var s=r.selection.lead.row;while(s<p&&!/\S/.test(r.getLine(s))){s++}while(/\S/.test(r.getLine(s))){s++}return{column:0,row:s}}),"ctrl-d":{nav:function(q,p,r,s){q.selection.clearSelection();b(q,q.gotoPageDown)},sel:function(q,p,r,s){b(q,q.selectPageDown)}},"ctrl-u":{nav:function(q,p,r,s){q.selection.clearSelection();b(q,q.gotoPageUp)},sel:function(q,p,r,s){b(q,q.selectPageUp)}},"`":new d({param:true,handlesCount:true,getPos:function(u,r,v,w,q){var t=u.session;var p=t.vimMarkers&&t.vimMarkers[w];if(p){return p.getPosition()}}}),"'":new d({param:true,handlesCount:true,getPos:function(v,t,u,q,p){var y=v.session;var r=y.vimMarkers&&y.vimMarkers[q];if(r){var w=r.getPosition();var x=v.session.getLine(w.row);w.column=x.search(/\S/);if(w.column==-1){w.column=x.length}return w}}})};c.exports.backspace=c.exports.left=c.exports.h;c.exports.space=c.exports["return"]=c.exports.right=c.exports.l;c.exports.up=c.exports.k;c.exports.down=c.exports.j;c.exports.pagedown=c.exports["ctrl-d"];c.exports.pageup=c.exports["ctrl-u"]});