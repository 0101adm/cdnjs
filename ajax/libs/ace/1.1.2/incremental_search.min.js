define(function(d,h,b){var k=d("./lib/oop");var c=d("./range").Range;var e=d("./search").Search;var l=d("./search_highlight").SearchHighlight;var m=d("./commands/incremental_search_commands");var j=m.IncrementalSearchKeyboardHandler;function g(){this.$options={wrap:false,skipCurrent:false};this.$keyboardHandler=new j(this)}k.inherits(g,e);(function(){this.activate=function(o,n){this.$editor=o;this.$startPos=this.$currentPos=o.getCursorPosition();this.$options.needle="";this.$options.backwards=n;o.keyBinding.addKeyboardHandler(this.$keyboardHandler);this.$mousedownHandler=o.addEventListener("mousedown",this.onMouseDown.bind(this));this.selectionFix(o);this.statusMessage(true)};this.deactivate=function(n){this.cancelSearch(n);this.$editor.keyBinding.removeKeyboardHandler(this.$keyboardHandler);if(this.$mousedownHandler){this.$editor.removeEventListener("mousedown",this.$mousedownHandler);delete this.$mousedownHandler}this.message("")};this.selectionFix=function(n){if(n.selection.isEmpty()&&!n.session.$emacsMark){n.clearSelection()}};this.highlight=function(p){var o=this.$editor.session,n=o.$isearchHighlight=o.$isearchHighlight||o.addDynamicMarker(new l(null,"ace_isearch-result","text"));n.setRegexp(p);o._emit("changeBackMarker")};this.cancelSearch=function(n){var o=this.$editor;this.$prevNeedle=this.$options.needle;this.$options.needle="";if(n){o.moveCursorToPosition(this.$startPos);this.$currentPos=this.$startPos}else{o.pushEmacsMark&&o.pushEmacsMark(this.$startPos,false)}this.highlight(null);return c.fromPoints(this.$currentPos,this.$currentPos)};this.highlightAndFindWithNeedle=function(p,n){if(!this.$editor){return null}var o=this.$options;if(n){o.needle=n.call(this,o.needle||"")||""}if(o.needle.length===0){this.statusMessage(true);return this.cancelSearch(true)}o.start=this.$currentPos;var r=this.$editor.session,q=this.find(r);if(q){if(o.backwards){q=c.fromPoints(q.end,q.start)}this.$editor.moveCursorToPosition(q.end);if(p){this.$currentPos=q.end}this.highlight(o.re)}this.statusMessage(q);return q};this.addChar=function(n){return this.highlightAndFindWithNeedle(false,function(o){return o+n})};this.removeChar=function(n){return this.highlightAndFindWithNeedle(false,function(o){return o.length>0?o.substring(0,o.length-1):o})};this.next=function(n){n=n||{};this.$options.backwards=!!n.backwards;this.$currentPos=this.$editor.getCursorPosition();return this.highlightAndFindWithNeedle(true,function(o){return n.useCurrentOrPrevSearch&&o.length===0?this.$prevNeedle||"":o})};this.onMouseDown=function(n){this.deactivate();return true};this.statusMessage=function(o){var n=this.$options,p="";p+=n.backwards?"reverse-":"";p+="isearch: "+n.needle;p+=o?"":" (not found)";this.message(p)};this.message=function(n){if(this.$editor.showCommandLine){this.$editor.showCommandLine(n);this.$editor.focus()}else{console.log(n)}}}).call(g.prototype);h.IncrementalSearch=g;var f=d("./lib/dom");f.importCssString&&f.importCssString(".ace_marker-layer .ace_isearch-result {  position: absolute;  z-index: 6;  -moz-box-sizing: border-box;  -webkit-box-sizing: border-box;  box-sizing: border-box;}div.ace_isearch-result {  border-radius: 4px;  background-color: rgba(255, 200, 0, 0.5);  box-shadow: 0 0 4px rgb(255, 200, 0);}.ace_dark div.ace_isearch-result {  background-color: rgb(100, 110, 160);  box-shadow: 0 0 4px rgb(80, 90, 140);}","incremental-search-highlighting");var a=d("./commands/command_manager");(function(){this.setupIncrementalSearch=function(n,p){if(this.usesIncrementalSearch==p){return}this.usesIncrementalSearch=p;var o=m.iSearchStartCommands;var q=p?"addCommands":"removeCommands";this[q](o)}}).call(a.CommandManager.prototype);var i=d("./editor").Editor;d("./config").defineOptions(i.prototype,"editor",{useIncrementalSearch:{set:function(n){this.keyBinding.$handlers.forEach(function(o){if(o.setupIncrementalSearch){o.setupIncrementalSearch(this,n)}});this._emit("incrementalSearchSettingChanged",{isEnabled:n})}}})});