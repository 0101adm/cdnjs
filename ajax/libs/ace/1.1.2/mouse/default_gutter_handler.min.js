define(function(c,b,d){var f=c("../lib/dom");var e=c("../lib/event");function a(m){var j=m.editor;var h=j.renderer.$gutterLayer;m.editor.setDefaultHandler("guttermousedown",function(s){if(!j.isFocused()||s.getButton()!=0){return}var u=h.getRegion(s);if(u=="foldWidgets"){return}var t=s.getDocumentPosition().row;var r=j.session.selection;if(s.getShiftKey()){r.selectTo(t,0)}else{if(s.domEvent.detail==2){j.selectAll();return s.preventDefault()}m.$clickSelection=j.selection.getLineRange(t)}m.setState("selectByLines");m.captureMouse(s);return s.preventDefault()});var p,g,q,i;function n(){q=f.createElement("div");q.className="ace_gutter-tooltip";q.style.display="none";j.container.appendChild(q)}function o(){if(!q){n()}var t=g.getDocumentPosition().row;var r=h.$annotations[t];if(!r){return l()}var v=j.session.getLength();if(t==v){var s=j.renderer.pixelToScreenCoordinates(0,g.y).row;var u=g.$pos;if(s>j.session.documentToScreenRow(u.row,u.column)){return l()}}if(i==r){return}i=r.text.join("<br/>");q.style.display="block";q.innerHTML=i;j.on("mousewheel",l);k(g)}function l(){if(p){p=clearTimeout(p)}if(i){q.style.display="none";i=null;j.removeEventListener("mousewheel",l)}}function k(t){var r=j.renderer.$gutter.getBoundingClientRect();q.style.left=t.x+15+"px";if(t.y+3*j.renderer.lineHeight+15<r.bottom){q.style.bottom="";q.style.top=t.y+15+"px"}else{q.style.top="";var s=window.innerHeight||document.documentElement.clientHeight;q.style.bottom=s-t.y+5+"px"}}m.editor.setDefaultHandler("guttermousemove",function(s){var r=s.domEvent.target||s.domEvent.srcElement;if(f.hasCssClass(r,"ace_fold-widget")){return l()}if(i){k(s)}g=s;if(p){return}p=setTimeout(function(){p=null;if(g&&!m.isMousePressed){o()}else{l()}},50)});e.addListener(j.renderer.$gutter,"mouseout",function(r){g=null;if(!i||p){return}p=setTimeout(function(){p=null;l()},50)});j.on("changeSession",l)}b.GutterHandler=a});