define(function(e,g,c){var f=e("../lib/dom");var a=e("../lib/event");var d=e("../lib/useragent");var j=0;function i(m){m.$clickSelection=null;var l=m.editor;l.setDefaultHandler("mousedown",this.onMouseDown.bind(m));l.setDefaultHandler("dblclick",this.onDoubleClick.bind(m));l.setDefaultHandler("tripleclick",this.onTripleClick.bind(m));l.setDefaultHandler("quadclick",this.onQuadClick.bind(m));l.setDefaultHandler("mousewheel",this.onMouseWheel.bind(m));var k=["select","startSelect","selectEnd","selectAllEnd","selectByWordsEnd","selectByLinesEnd","dragWait","dragWaitEnd","focusWait"];k.forEach(function(n){m[n]=this[n]},this);m.selectByLines=this.extendSelectionBy.bind(m,"getLineRange");m.selectByWords=this.extendSelectionBy.bind(m,"getWordRange")}(function(){this.onMouseDown=function(o){var m=o.inSelection();var q=o.getDocumentPosition();this.mousedownEvent=o;var n=this.editor;var l=o.getButton();if(l!==0){var p=n.getSelectionRange();var k=p.isEmpty();if(k){n.moveCursorToPosition(q);n.selection.clearSelection()}n.textInput.onContextMenu(o.domEvent);return}if(m&&!n.isFocused()){n.focus();if(this.$focusTimout&&!this.$clickSelection&&!n.inMultiSelectMode){this.mousedownEvent.time=Date.now();this.setState("focusWait");this.captureMouse(o);return}}if(!m||this.$clickSelection||o.getShiftKey()||n.inMultiSelectMode){this.startSelect(q)}else{if(m){this.mousedownEvent.time=Date.now();this.startSelect(q)}}this.captureMouse(o);return o.preventDefault()};this.startSelect=function(m){m=m||this.editor.renderer.screenToTextCoordinates(this.x,this.y);var k=this.editor;var l=this.mousedownEvent.getShiftKey();if(l){k.selection.selectToPosition(m)}else{if(!this.$clickSelection){k.moveCursorToPosition(m);k.selection.clearSelection()}}if(k.renderer.scroller.setCapture){k.renderer.scroller.setCapture()}k.setStyle("ace_selecting");this.setState("select")};this.select=function(){var k,l=this.editor;var o=l.renderer.screenToTextCoordinates(this.x,this.y);if(this.$clickSelection){var m=this.$clickSelection.comparePoint(o);if(m==-1){k=this.$clickSelection.end}else{if(m==1){k=this.$clickSelection.start}else{var n=h(this.$clickSelection,o);o=n.cursor;k=n.anchor}}l.selection.setSelectionAnchor(k.row,k.column)}l.selection.selectToPosition(o);l.renderer.scrollCursorIntoView()};this.extendSelectionBy=function(l){var n,o=this.editor;var r=o.renderer.screenToTextCoordinates(this.x,this.y);var m=o.selection[l](r.row,r.column);if(this.$clickSelection){var k=this.$clickSelection.comparePoint(m.start);var q=this.$clickSelection.comparePoint(m.end);if(k==-1&&q<=0){n=this.$clickSelection.end;if(m.end.row!=r.row||m.end.column!=r.column){r=m.start}}else{if(q==1&&k>=0){n=this.$clickSelection.start;if(m.start.row!=r.row||m.start.column!=r.column){r=m.end}}else{if(k==-1&&q==1){r=m.end;n=m.start}else{var p=h(this.$clickSelection,r);r=p.cursor;n=p.anchor}}}o.selection.setSelectionAnchor(n.row,n.column)}o.selection.selectToPosition(r);o.renderer.scrollCursorIntoView()};this.selectEnd=this.selectAllEnd=this.selectByWordsEnd=this.selectByLinesEnd=function(){this.editor.unsetStyle("ace_selecting");if(this.editor.renderer.scroller.releaseCapture){this.editor.renderer.scroller.releaseCapture()}};this.focusWait=function(){var l=b(this.mousedownEvent.x,this.mousedownEvent.y,this.x,this.y);var k=Date.now();if(l>j||k-this.mousedownEvent.time>this.$focusTimout){this.startSelect(this.mousedownEvent.getDocumentPosition())}};this.onDoubleClick=function(m){var o=m.getDocumentPosition();var l=this.editor;var n=l.session;var k=n.getBracketRange(o);if(k){if(k.isEmpty()){k.start.column--;k.end.column++}this.setState("select")}else{k=l.selection.getWordRange(o.row,o.column);this.setState("selectByWords")}this.$clickSelection=k;this[this.state]&&this[this.state](m)};this.onTripleClick=function(l){var m=l.getDocumentPosition();var k=this.editor;this.setState("selectByLines");this.$clickSelection=k.selection.getLineRange(m.row);this[this.state]&&this[this.state](l)};this.onQuadClick=function(l){var k=this.editor;k.selectAll();this.$clickSelection=k.getSelectionRange();this.setState("selectAll")};this.onMouseWheel=function(o){if(o.getShiftKey()||o.getAccelKey()){return}var l=o.domEvent.timeStamp;var n=l-(this.$lastScrollTime||0);var m=this.editor;var k=m.renderer.isScrollableBy(o.wheelX*o.speed,o.wheelY*o.speed);if(k||n<200){this.$lastScrollTime=l;m.renderer.scrollBy(o.wheelX*o.speed,o.wheelY*o.speed);return o.stop()}}}).call(i.prototype);g.DefaultHandlers=i;function b(l,k,n,m){return Math.sqrt(Math.pow(n-l,2)+Math.pow(m-k,2))}function h(k,m){if(k.start.row==k.end.row){var l=2*m.column-k.start.column-k.end.column}else{if(k.start.row==k.end.row-1&&!k.start.column&&!k.end.column){var l=m.column-4}else{var l=2*m.row-k.start.row-k.end.row}}if(l<0){return{cursor:k.start,anchor:k.end}}else{return{cursor:k.end,anchor:k.start}}}});