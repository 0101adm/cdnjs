if(typeof process!=="undefined"){require("amd-loader");require("./test/mockdom")}define(function(g,i,e){var d=g("./lib/lang");var b=g("./edit_session").EditSession;var k=g("./editor").Editor;var c=g("./undomanager").UndoManager;var j=g("./test/mockrenderer").MockRenderer;var f=g("./range").Range;var a=g("./test/assertions");var l=g("./mode/javascript").Mode;function m(){var n=["function foo(items) {","    for (var i=0; i<items.length; i++) {",'        alert(items[i] + "juhu");',"    }    // Real Tab.","}"];var o=new b(n.join("\n"));o.setUndoManager(new c());o.addFold("args...",new f(0,13,0,18));o.addFold("foo...",new f(1,10,2,10));o.addFold("bar...",new f(2,20,2,25));return o}function h(o,n){a.equal(o+"",n+"");a.ok(o.length==n.length);for(var p=0;p<o.length;p++){a.equal(o[p],n[p])}}e.exports={"test: find matching opening bracket in Text mode":function(){var n=new b(["(()(","())))"]);a.position(n.findMatchingBracket({row:0,column:3}),0,1);a.position(n.findMatchingBracket({row:1,column:2}),1,0);a.position(n.findMatchingBracket({row:1,column:3}),0,3);a.position(n.findMatchingBracket({row:1,column:4}),0,0);a.equal(n.findMatchingBracket({row:1,column:5}),null)},"test: find matching closing bracket in Text mode":function(){var n=new b(["(()(","())))"]);a.position(n.findMatchingBracket({row:1,column:1}),1,1);a.position(n.findMatchingBracket({row:1,column:1}),1,1);a.position(n.findMatchingBracket({row:0,column:4}),1,2);a.position(n.findMatchingBracket({row:0,column:2}),0,2);a.position(n.findMatchingBracket({row:0,column:1}),1,3);a.equal(n.findMatchingBracket({row:0,column:0}),null)},"test: find matching opening bracket in JavaScript mode":function(){var n=["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str (a string) to the console","        console.log(str);","    }",'    str += " bar() }";',"}"];var o=new b(n.join("\n"),new l());a.position(o.findMatchingBracket({row:0,column:14}),0,12);a.position(o.findMatchingBracket({row:7,column:1}),0,15);a.position(o.findMatchingBracket({row:6,column:20}),1,15);a.position(o.findMatchingBracket({row:1,column:22}),1,20);a.position(o.findMatchingBracket({row:3,column:31}),3,21);a.position(o.findMatchingBracket({row:4,column:24}),4,19);a.equal(o.findMatchingBracket({row:0,column:1}),null)},"test: find matching closing bracket in JavaScript mode":function(){var n=["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str (a string) to the console","        console.log(str);","    }",'    str += " bar() }";',"}"];var o=new b(n.join("\n"),new l());a.position(o.findMatchingBracket({row:0,column:13}),0,13);a.position(o.findMatchingBracket({row:0,column:16}),7,0);a.position(o.findMatchingBracket({row:1,column:16}),6,19);a.position(o.findMatchingBracket({row:1,column:21}),1,21);a.position(o.findMatchingBracket({row:3,column:22}),3,30);a.position(o.findMatchingBracket({row:4,column:20}),4,23)},"test: handle unbalanced brackets in JavaScript mode":function(){var n=["function foo() {",'    var str = "{ foo()";',"    if (debug) {","        // write str a string) to the console","        console.log(str);","    ",'    str += " bar() ";',"}"];var o=new b(n.join("\n"),new l());a.equal(o.findMatchingBracket({row:0,column:16}),null);a.equal(o.findMatchingBracket({row:3,column:30}),null);a.equal(o.findMatchingBracket({row:1,column:16}),null)},"test: match different bracket types":function(){var n=new b(["({[",")]}"]);a.position(n.findMatchingBracket({row:0,column:1}),1,0);a.position(n.findMatchingBracket({row:0,column:2}),1,2);a.position(n.findMatchingBracket({row:0,column:3}),1,1);a.position(n.findMatchingBracket({row:1,column:1}),0,0);a.position(n.findMatchingBracket({row:1,column:2}),0,2);a.position(n.findMatchingBracket({row:1,column:3}),0,1)},"test: move lines down":function(){var n=new b(["a1","a2","a3","a4"]);n.moveLinesDown(0,1);a.equal(n.getValue(),["a3","a1","a2","a4"].join("\n"));n.moveLinesDown(1,2);a.equal(n.getValue(),["a3","a4","a1","a2"].join("\n"));n.moveLinesDown(2,3);a.equal(n.getValue(),["a3","a4","a1","a2"].join("\n"));n.moveLinesDown(2,2);a.equal(n.getValue(),["a3","a4","a2","a1"].join("\n"))},"test: move lines up":function(){var n=new b(["a1","a2","a3","a4"]);n.moveLinesUp(2,3);a.equal(n.getValue(),["a1","a3","a4","a2"].join("\n"));n.moveLinesUp(1,2);a.equal(n.getValue(),["a3","a4","a1","a2"].join("\n"));n.moveLinesUp(0,1);a.equal(n.getValue(),["a3","a4","a1","a2"].join("\n"));n.moveLinesUp(2,2);a.equal(n.getValue(),["a3","a1","a4","a2"].join("\n"))},"test: duplicate lines":function(){var n=new b(["1","2","3","4"]);n.duplicateLines(1,2);a.equal(n.getValue(),["1","2","3","2","3","4"].join("\n"))},"test: duplicate last line":function(){var n=new b(["1","2","3"]);n.duplicateLines(2,2);a.equal(n.getValue(),["1","2","3","3"].join("\n"))},"test: duplicate first line":function(){var n=new b(["1","2","3"]);n.duplicateLines(0,0);a.equal(n.getValue(),["1","1","2","3"].join("\n"))},"test: getScreenLastRowColumn":function(){var n=new b(["juhu","12\t\t34","ぁぁa"]);a.equal(n.getScreenLastRowColumn(0),4);a.equal(n.getScreenLastRowColumn(1),10);a.equal(n.getScreenLastRowColumn(2),5)},"test: convert document to screen coordinates":function(){var n=new b("01234\t567890\t1234");n.setTabSize(4);a.equal(n.documentToScreenColumn(0,0),0);a.equal(n.documentToScreenColumn(0,4),4);a.equal(n.documentToScreenColumn(0,5),5);a.equal(n.documentToScreenColumn(0,6),8);a.equal(n.documentToScreenColumn(0,12),14);a.equal(n.documentToScreenColumn(0,13),16);n.setTabSize(2);a.equal(n.documentToScreenColumn(0,0),0);a.equal(n.documentToScreenColumn(0,4),4);a.equal(n.documentToScreenColumn(0,5),5);a.equal(n.documentToScreenColumn(0,6),6);a.equal(n.documentToScreenColumn(0,7),7);a.equal(n.documentToScreenColumn(0,12),12);a.equal(n.documentToScreenColumn(0,13),14)},"test: convert document to screen coordinates with leading tabs":function(){var n=new b("\t\t123");n.setTabSize(4);a.equal(n.documentToScreenColumn(0,0),0);a.equal(n.documentToScreenColumn(0,1),4);a.equal(n.documentToScreenColumn(0,2),8);a.equal(n.documentToScreenColumn(0,3),9)},"test: documentToScreen without soft wrap":function(){var n=new b(["juhu","12\t\t34","ぁぁa"]);a.position(n.documentToScreenPosition(0,3),0,3);a.position(n.documentToScreenPosition(1,3),1,4);a.position(n.documentToScreenPosition(1,4),1,8);a.position(n.documentToScreenPosition(2,2),2,4)},"test: documentToScreen with soft wrap":function(){var n=new b(["foo bar foo bar"]);n.setUseWrapMode(true);n.setWrapLimitRange(12,12);n.adjustWrapLimit(80);a.position(n.documentToScreenPosition(0,11),0,11);a.position(n.documentToScreenPosition(0,12),1,0)},"test: documentToScreen with soft wrap and multibyte characters":function(){var n=new b(["ぁぁa"]);n.setUseWrapMode(true);n.setWrapLimitRange(2,2);n.adjustWrapLimit(80);a.position(n.documentToScreenPosition(0,1),1,0);a.position(n.documentToScreenPosition(0,2),2,0);a.position(n.documentToScreenPosition(0,4),2,1)},"test: documentToScreen should clip position to the document boundaries":function(){var n=new b("foo bar\njuhu kinners");a.position(n.documentToScreenPosition(-1,4),0,0);a.position(n.documentToScreenPosition(3,0),1,12)},"test: convert screen to document coordinates":function(){var n=new b("01234\t567890\t1234");n.setTabSize(4);a.equal(n.screenToDocumentColumn(0,0),0);a.equal(n.screenToDocumentColumn(0,4),4);a.equal(n.screenToDocumentColumn(0,5),5);a.equal(n.screenToDocumentColumn(0,6),5);a.equal(n.screenToDocumentColumn(0,7),5);a.equal(n.screenToDocumentColumn(0,8),6);a.equal(n.screenToDocumentColumn(0,9),7);a.equal(n.screenToDocumentColumn(0,15),12);a.equal(n.screenToDocumentColumn(0,19),16);n.setTabSize(2);a.equal(n.screenToDocumentColumn(0,0),0);a.equal(n.screenToDocumentColumn(0,4),4);a.equal(n.screenToDocumentColumn(0,5),5);a.equal(n.screenToDocumentColumn(0,6),6);a.equal(n.screenToDocumentColumn(0,12),12);a.equal(n.screenToDocumentColumn(0,13),12);a.equal(n.screenToDocumentColumn(0,14),13)},"test: screenToDocument with soft wrap":function(){var n=new b(["foo bar foo bar"]);n.setUseWrapMode(true);n.setWrapLimitRange(12,12);n.adjustWrapLimit(80);a.position(n.screenToDocumentPosition(1,0),0,12);a.position(n.screenToDocumentPosition(0,11),0,11);a.position(n.screenToDocumentPosition(0,12),0,11);a.position(n.screenToDocumentPosition(0,20),0,11)},"test: screenToDocument with soft wrap and multi byte characters":function(){var n=new b(["ぁ a"]);n.setUseWrapMode(true);n.adjustWrapLimit(80);a.position(n.screenToDocumentPosition(0,1),0,0);a.position(n.screenToDocumentPosition(0,2),0,1);a.position(n.screenToDocumentPosition(0,3),0,2);a.position(n.screenToDocumentPosition(0,4),0,3);a.position(n.screenToDocumentPosition(0,5),0,3)},"test: screenToDocument should clip position to the document boundaries":function(){var n=new b("foo bar\njuhu kinners");a.position(n.screenToDocumentPosition(-1,4),0,0);a.position(n.screenToDocumentPosition(0,-1),0,0);a.position(n.screenToDocumentPosition(0,30),0,7);a.position(n.screenToDocumentPosition(2,4),1,12);a.position(n.screenToDocumentPosition(1,30),1,12);a.position(n.screenToDocumentPosition(20,50),1,12);a.position(n.screenToDocumentPosition(20,5),1,12);n.addFold("...",new f(0,1,1,3));a.position(n.screenToDocumentPosition(1,2),1,12);n.setUseWrapMode(true);n.setWrapLimitRange(5,5);a.position(n.screenToDocumentPosition(4,1),1,12)},"test: wrapLine split function":function(){function n(o,q,p,u){p=p||12;u=u||4;o=d.stringTrimRight(o);var t=b.prototype.$getDisplayTokens(o);var s=b.prototype.$computeWrapSplits(t,p,u);a.ok(s.length==q.length);for(var r=0;r<s.length;r++){a.ok(s[r]==q[r])}}b.prototype.$wrapAsCode=true;n("foo bar foo bar",[12]);n("foo bar f   bar",[12]);n("foo bar f     r",[12]);n("foo bar foo bar foo bara foo",[12,25]);n("foo foo foo \t \t",[]);n("foooooooooooooo",[12]);n("fooooooooooooooooooooooooooo",[12,24]);n("foo bar fooooooooooobooooooo",[8,20]);n("foo \t\tbar",[6]);n("foo \t \tbar",[7]);n("foo \t \t   \t \t bar",[7]);n("ぁぁ",[1],2);n(" ぁぁ",[1,2],2);n(" ぁ\tぁ",[1,3],2);n(" ぁぁ\tぁ",[1,4],4);n(" ab.c;ef++",[1,3,5,7,8],2);n(" a.b",[1,2,3],1);n("#>>",[1,2],1);b.prototype.$wrapAsCode=false;n("ab cde, Juhu kinners",[3,8,13,19],6)},"test get longest line":function(){var n=new b(["12"]);n.setTabSize(4);a.equal(n.getScreenWidth(),2);n.doc.insertNewLine({row:0,column:Infinity});n.doc.insertLines(1,["123"]);a.equal(n.getScreenWidth(),3);n.doc.insertNewLine({row:0,column:Infinity});n.doc.insertLines(1,["\t\t"]);a.equal(n.getScreenWidth(),8);n.setTabSize(2);a.equal(n.getScreenWidth(),4)},"test getDisplayString":function(){var n=new b(["12"]);n.setTabSize(4);a.equal(n.$getDisplayTokens("\t").length,4);a.equal(n.$getDisplayTokens("abc").length,3);a.equal(n.$getDisplayTokens("abc\t").length,4)},"test issue 83":function(){var p=new b("");var o=new k(new j(),p);var n=p.getDocument();p.setUseWrapMode(true);n.insertLines(0,["a","b"]);n.insertLines(2,["c","d"]);n.removeLines(1,2)},"test wrapMode init has to create wrapData array":function(){var p=new b("foo bar\nfoo bar");var o=new k(new j(),p);var n=p.getDocument();p.setUseWrapMode(true);p.setWrapLimitRange(3,3);p.adjustWrapLimit(80);a.equal(p.$wrapData.length,2);a.equal(p.$wrapData[0].length,1);a.equal(p.$wrapData[1].length,1)},"test first line blank with wrap":function(){var n=new b("\nfoo");n.setUseWrapMode(true);a.equal(n.doc.getValue(),["","foo"].join("\n"))},"test first line blank with wrap 2":function(){var n=new b("");n.setUseWrapMode(true);n.setValue("\nfoo");a.equal(n.doc.getValue(),["","foo"].join("\n"))},"test fold getFoldDisplayLine":function(){var o=m();function n(r,q){var p=o.getLine(r.end.row);var s=o.getFoldDisplayLine(r,r.end.row,p.length);a.equal(s,q)}n(o.$foldData[0],"function foo(args...) {");n(o.$foldData[1],'    for (vfoo...ert(items[bar..."juhu");')},"test foldLine idxToPosition":function(){var o=m();function n(q,p,t,r){var s=o.$foldData[q];a.position(s.idxToPosition(p),t,r)}n(0,12,0,12);n(0,13,0,13);n(0,14,0,13);n(0,19,0,13);n(0,20,0,18);n(1,10,1,10);n(1,11,1,10);n(1,15,1,10);n(1,16,2,10);n(1,26,2,20);n(1,27,2,20);n(1,32,2,25)},"test fold documentToScreen":function(){var o=m();function n(p,r,q,s){a.position(o.documentToScreenPosition(p,r),q,s)}n(0,0,0,0);n(0,13,0,13);n(0,14,0,13);n(0,17,0,13);n(0,18,0,20);n(1,0,1,0);n(1,10,1,10);n(1,11,1,10);n(1,99,1,10);n(2,0,1,10);n(2,9,1,10);n(2,10,1,16);n(2,11,1,17);n(2,19,1,25);n(2,20,1,26);n(2,21,1,26);n(2,24,1,26);n(2,25,1,32);n(2,26,1,33);n(2,99,1,40);n(3,0,2,0)},"test fold screenToDocument":function(){var n=m();function o(p,r,q,s){a.position(n.screenToDocumentPosition(q,s),p,r)}o(0,0,0,0);o(0,13,0,13);o(0,13,0,14);o(0,18,0,20);o(0,19,0,21);o(1,0,1,0);o(1,10,1,10);o(1,10,1,11);o(1,10,1,15);o(2,10,1,16);o(2,11,1,17);o(2,19,1,25);o(2,20,1,26);o(2,20,1,27);o(2,20,1,31);o(2,25,1,32);o(2,26,1,33);o(2,33,1,99);o(3,0,2,0)},"test getFoldsInRange()":function(){var p=m();var n=p.$foldData;var o=n[0].folds.concat(n[1].folds);function q(t,v,z,s,x){var w=new f(t,v,z,s);var y=p.getFoldsInRange(w);a.ok(y.length==x.length);for(var u=0;u<y.length;u++){a.equal(y[u].range+"",x[u].range+"")}}q(0,0,0,13,[]);q(0,0,0,14,[o[0]]);q(0,0,0,18,[o[0]]);q(0,0,1,10,[o[0]]);q(0,0,1,11,[o[0],o[1]]);q(0,18,1,11,[o[1]]);q(2,0,2,13,[o[1]]);q(2,10,2,20,[]);q(2,10,2,11,[]);q(2,19,2,20,[])},"test fold one-line text insert":function(){var s=m();var r=s.getUndoManager();var o=s.$foldData;function p(w,u,v){s.insert({row:w,column:u},v);s.$syncInformUndoManager()}var t,n,q;t=s.$foldData[0];n=t.folds[0];p(0,0,"0");a.range(t.range,0,14,0,19);a.range(n.range,0,14,0,19);p(0,14,"1");a.range(t.range,0,15,0,20);a.range(n.range,0,15,0,20);p(0,20,"2");a.range(t.range,0,15,0,20);a.range(n.range,0,15,0,20);t=s.$foldData[1];q=t.folds;p(1,0,"3");a.range(t.range,1,11,2,25);a.range(q[0].range,1,11,2,10);a.range(q[1].range,2,20,2,25);p(1,11,"4");a.range(t.range,1,12,2,25);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,20,2,25);p(2,10,"5");a.range(t.range,1,12,2,26);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,21,2,26);p(2,21,"6");a.range(t.range,1,12,2,27);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,22,2,27);p(2,27,"7");a.range(t.range,1,12,2,27);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,22,2,27);r.undo();a.range(t.range,1,12,2,27);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,22,2,27);r.undo();a.range(t.range,1,12,2,26);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,21,2,26);r.undo();a.range(t.range,1,12,2,25);a.range(q[0].range,1,12,2,10);a.range(q[1].range,2,20,2,25);r.undo();a.range(t.range,1,11,2,25);a.range(q[0].range,1,11,2,10);a.range(q[1].range,2,20,2,25);r.undo();a.equal(o.length,2);a.range(o[0].range,0,15,0,20);a.range(o[1].range,1,10,2,25);t=s.$foldData[0];n=t.folds[0];r.undo();a.range(t.range,0,15,0,20);a.range(n.range,0,15,0,20);r.undo();a.range(t.range,0,14,0,19);a.range(n.range,0,14,0,19);r.undo();a.range(t.range,0,13,0,18);a.range(n.range,0,13,0,18)},"test fold multi-line insert/remove":function(){var s=m(),r=s.getUndoManager(),o=s.$foldData;function p(w,u,v){s.insert({row:w,column:u},v);s.$syncInformUndoManager()}var o=s.$foldData,t,n,q;p(0,0,"\nfo0");a.equal(o.length,2);a.range(o[0].range,1,16,1,21);a.range(o[1].range,2,10,3,25);p(2,0,"\nba1");a.equal(o.length,2);a.range(o[0].range,1,16,1,21);a.range(o[1].range,3,13,4,25);p(3,10,"\nfo2");a.equal(o.length,2);a.range(o[0].range,1,16,1,21);a.range(o[1].range,4,6,5,25);p(5,10,"\nba3");a.equal(o.length,3);a.range(o[0].range,1,16,1,21);a.range(o[1].range,4,6,5,10);a.range(o[2].range,6,13,6,18);p(6,18,"\nfo4");a.equal(o.length,3);a.range(o[0].range,1,16,1,21);a.range(o[1].range,4,6,5,10);a.range(o[2].range,6,13,6,18);r.undo();a.equal(o.length,3);a.range(o[0].range,1,16,1,21);a.range(o[1].range,4,6,5,10);a.range(o[2].range,6,13,6,18);r.undo();a.equal(o.length,2);a.range(o[0].range,1,16,1,21);a.range(o[1].range,4,6,5,25);r.undo();a.equal(o.length,2);a.range(o[0].range,1,16,1,21);a.range(o[1].range,3,13,4,25);r.undo();a.equal(o.length,2);a.range(o[0].range,1,16,1,21);a.range(o[1].range,2,10,3,25);r.undo();a.equal(o.length,2);a.range(o[0].range,0,13,0,18);a.range(o[1].range,1,10,2,25)},"test fold wrap data compution":function(){function q(u,t,s){u&&h(n[0],u);t&&h(n[1],t);s&&h(n[2],s)}function p(u,w,v,t,s){r.removeFold(r.getFoldAt(u,w));q(v,t,s)}var o=["foo bar foo bar","foo bar foo bar","foo bar foo bar"];var r=new b(o.join("\n"));r.setUseWrapMode(true);r.$wrapLimit=7;r.$updateWrapData(0,2);var n=r.$wrapData;q([8],[8],[8]);r.addFold("woot",new f(0,4,0,15));q([4],[8],[8]);p(0,4,[8],[8],[8]);r.addFold("woot",new f(0,6,0,9));q([6,13],[8],[8]);p(0,6,[8],[8],[8]);r.addFold("woot",new f(0,3,0,15));q([],[8],[8]);p(0,4,[8],[8],[8]);r.addFold("woot",new f(0,8,0,15));q([8],[8],[8]);p(0,8,[8],[8],[8]);r.addFold("woot0123456789",new f(0,8,0,15));q([8],[8],[8]);p(0,8,[8],[8],[8]);r.addFold("woot0123456789",new f(0,6,0,8));q([6,20],[8],[8]);p(0,8,[8],[8],[8]);r.addFold("woot0123456789",new f(0,6,0,8));r.addFold("woot0123456789",new f(0,8,0,10));q([6,20,34],[8],[8]);r.removeFold(r.getFoldAt(0,7));p(0,8,[8],[8],[8]);r.addFold("woot0123456789",new f(0,7,0,9));r.addFold("woot0123456789",new f(0,13,0,15));q([7,21,25],[8],[8]);r.removeFold(r.getFoldAt(0,7));p(0,14,[8],[8],[8]);r.addFold("woot",new f(0,8,1,15));q([8],[8],[8]);p(0,8,[8],[8],[8]);r.addFold("woot",new f(0,9,1,11));q([8,14],[8],[8]);p(0,9,[8],[8],[8]);r.addFold("woot",new f(0,9,1,15));q([8],[8],[8]);p(0,9,[8],[8],[8]);return r},"test delete fold with wrap enabled":function(){var n=new b("");n.setValue(["This is some placeholder text that will be folded inline.","This is some placeholder text that will be folded inline.","More text.","<p>The cursor in this paragraph text will be offset by 1 row.<p>","<p>Everything after this will be offset as well due to the folds in the row before too.</p>"].join("\n"));n.addFold("...",new f(0,8,0,42));n.addFold("...",new f(1,8,1,42));n.addFold("...",new f(3,7,3,51));n.setOption("wrap",40);n.remove(new f(0,0,2,5));n.adjustWrapLimit(80);a.equal(n.$wrapData+"",[[],[],[40,76]]+"")},"test add fold":function(){var p=m();var n;function o(u,s,q){var r=false;try{n=p.addFold(u,s)}catch(t){r=true}if(r!=q){throw new Error("Expected to get an exception")}}o("foo",new f(0,13,0,17),false);o("foo",new f(0,14,0,18),true);o("foo",new f(0,13,0,18),false);a.equal(p.$foldData[0].folds.length,1);o("f",new f(0,13,0,18),false);o("foo",new f(0,18,0,21),false);a.equal(p.$foldData[0].folds.length,2);p.removeFold(n);o("foo",new f(0,18,0,22),false);o("foo",new f(0,18,0,19),true);o("foo",new f(0,22,1,10),false)},"test add subfolds":function(){var q=m();var n,p;var o=q.$foldData;p=o[0].folds[0];n=q.addFold("fold0",new f(0,10,0,21));a.equal(o[0].folds.length,1);a.equal(n.subFolds.length,1);a.equal(n.subFolds[0],p);q.expandFold(n);a.equal(o[0].folds.length,1);a.equal(o[0].folds[0],p);a.equal(n.subFolds.length,0);n=q.addFold("fold0",new f(0,13,2,10));a.equal(o.length,1);a.equal(n.subFolds.length,2);a.equal(n.subFolds[0],p);q.expandFold(n);a.equal(o.length,2);a.equal(o[0].folds.length,1);a.equal(o[0].folds[0],p);a.equal(n.subFolds.length,0);q.unfold(null,true);n=q.addFold("fold0",new f(0,0,0,21));q.addFold("fold0",new f(0,1,0,5));q.addFold("fold0",new f(0,6,0,8));a.equal(n.subFolds.length,2)},"test row cache":function(){var n=m();n.screenToDocumentPosition(2,3);h(n.$docRowCache,[1,3]);h(n.$screenRowCache,[1,2]);n.screenToDocumentPosition(5,3);h(n.$docRowCache,[1,3,4]);h(n.$screenRowCache,[1,2,3]);n.screenToDocumentPosition(0,3);h(n.$docRowCache,[1,3,4]);h(n.$screenRowCache,[1,2,3]);var o=n.screenToDocumentPosition(0,0);a.equal(o.row,0);h(n.$docRowCache,[1,3,4]);h(n.$screenRowCache,[1,2,3]);n.screenToDocumentPosition(1,0);h(n.$docRowCache,[1,3,4]);h(n.$screenRowCache,[1,2,3]);n.$resetRowCache();h(n.$docRowCache,[]);h(n.$screenRowCache,[]);n.screenToDocumentPosition(1,3);h(n.$docRowCache,[1]);h(n.$screenRowCache,[1]);n.screenToDocumentPosition(5,3);h(n.$docRowCache,[1,3,4]);h(n.$screenRowCache,[1,2,3]);n=new b(new Array(30).join("\n"));n.documentToScreenPosition(2,0);n.documentToScreenPosition(2,0);h(n.$docRowCache,[1,2]);h(n.$screenRowCache,[1,2])},"test annotations":function(){var o=new b([]),n={row:0,type:"info",text:"This is a test."};o.clearAnnotations();h(o.getAnnotations(),[]);o.setAnnotations([n]);h(o.getAnnotations(),[n])},"test: mode loading":function(n){if(!g.undef){console.log("Skipping test: This test only runs in the browser");n();return}var o=new b([]);o.setMode("ace/mode/javascript");a.equal(o.$modeid,"ace/mode/javascript");o.on("changeMode",function(){a.equal(o.$modeid,"ace/mode/javascript")});o.setMode("ace/mode/sh",function(p){a.ok(!p)});setTimeout(function(){o.setMode("ace/mode/javascript",function(p){o.setMode("ace/mode/javascript");a.equal(o.$modeid,"ace/mode/javascript");n()})},0)}}});if(typeof module!=="undefined"&&module===require.main){require("asyncjs").test.testcase(module.exports).exec()};